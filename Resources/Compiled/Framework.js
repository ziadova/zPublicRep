/*
	
	Copyright (c) 2013, Latitude Geographics Group Ltd.
	All rights reserved.
	       
	Redistribution is not permitted. 
	
	Use in binary form, without modification, is permitted provided that neither 
	the name of the organization nor the names of its contributors may be used 
	to endorse or promote products derived from this software without specific 
	prior written permission.
	       
	THIS SOFTWARE IS PROVIDED BY COPYRIGHT HOLDER ''AS IS'' AND ANY
	EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
	WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
	DISCLAIMED. IN NO EVENT SHALL LATITUDE GEOGRAPHICS GROUP LTD. BE LIABLE FOR ANY
	DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
	(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
	LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
	ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
	(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
	SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/

var geocortex;
(function(d){(function(b){var d=function(){function b(e,a){this.dojoConnects=[];this.observableBindings=[];this.eventSubscriptions=[];this.commandHandlers=[];this.app=e;this.libraryId=a}b.prototype.auto=function(b,a,c){if(arguments.length===3&&typeof a==="string")this.dojoConnects.push(dojo.connect(b,a,c));else if(arguments.length===2&&a instanceof Function){var g=b.bind(b,a);this.observableBindings.push({obj:b,token:g})}else arguments.length===3&&c instanceof Function&&(g=b.bind(a,c),this.observableBindings.push({obj:b,
token:g}))};b.prototype.trackSubscription=function(b,a){this.eventSubscriptions.push({event:b,token:a})};b.prototype.trackCommandHandler=function(b,a){this.commandHandlers.push({command:b,token:a})};b.prototype.onDestroy=function(){};b.prototype.destroy=function(){for(var b=0;b<this.dojoConnects.length;++b)dojo.disconnect(this.dojoConnects[b]);this.dojoConnects=[];for(b=0;b<this.observableBindings.length;++b){var a=this.observableBindings[b].token;this.observableBindings[b].obj.unbind(a)}this.observableBindings=
[];for(b=0;b<this.eventSubscriptions.length;++b){var c=this.eventSubscriptions[b].event,a=this.eventSubscriptions[b].token;c.unsubscribe(a)}this.eventSubscriptions=[];for(b=0;b<this.commandHandlers.length;++b)c=this.commandHandlers[b].command,a=this.commandHandlers[b].token,c.unregister(a);this.commandHandlers=[];this.onDestroy()};b.prototype.getResource=function(b,a){return this.app.getResource(this.libraryId,b,a)};return b}();b.FrameworkObject=d})(d.framework||(d.framework={}))})(geocortex||(geocortex=
{}));(function(d){(function(b){(function(b){var d=function(){return function(){this.sender=null;this.type="append";this.rangeEnd=this.rangeStart=0}}();b.CollectionChangedArgs=d})(b.events||(b.events={}))})(d.framework||(d.framework={}))})(geocortex||(geocortex={}));if(!String.prototype.format)String.prototype.format=function(){var d=arguments;return this.replace(/{(\d+)}/g,function(b,f){return d[f]})};
String.format=function(d){for(var b=[],f=0;f<arguments.length-1;f++)b[f]=arguments[f+1];return d.format.apply(d,b)};String.quickHashCode=function(d){var b=0,f,h;if(d.length==0)return b;for(f=0;f<d.length;f++)h=d.charCodeAt(f),b=(b<<5)-b+h,b&=b;return b};String.escapeHtml=function(d){return d.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")};
String.escapeHtmlEncode=function(d){var b=document.createElement("div");b.appendChild(document.createTextNode(d));return b.innerHTML};String.isNullOrEmpty=function(d){return typeof d==="undefined"||d===null||d.length===0};String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")};String.prototype.ltrim=function(){return this.replace(/^\s+/,"")};String.prototype.rtrim=function(){return this.replace(/\s+$/,"")};String.prototype.startsWith=function(d){return this.indexOf(d)==0};
(function(d){(function(b){(function(b){b.base64keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";b.makeUrlAbsolute=function(b){if(b.indexOf("http")===0)return b;var e="{0}//{1}{2}".format(window.location.protocol,window.location.host,window.location.pathname);if(e.charAt(e.length-1)!="/"||e.charAt(e.length-1)!="\\")e=e.split("/"),--e.length,e=e.join("/"),e+="/";return b=b.charAt(0)==="/"||b.charAt(0)==="\\"?window.location.protocol+"//"+window.location.host+"/"+b.substring(1):
e+b};b.alphaNumericToken=function(b){for(var b=b||8,e="",a=0;a<b;a++){var c=Math.floor(Math.random()*61);e+="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz".substring(c,c+1)}return e};b.base64Encode=function(b){for(var e="",a,c,g,j,i,k,d=0,b=this.utf8Encode(b);d<b.length;)a=b.charCodeAt(d++),c=b.charCodeAt(d++),g=b.charCodeAt(d++),j=a>>2,a=(a&3)<<4|c>>4,i=(c&15)<<2|g>>6,k=g&63,isNaN(c)?i=k=64:isNaN(g)&&(k=64),e=e+this.base64keyStr.charAt(j)+this.base64keyStr.charAt(a)+this.base64keyStr.charAt(i)+
this.base64keyStr.charAt(k);return e};b.base64Decode=function(b){var e="";if(!b||b==="")return e;var a,c,g,j,i,k=0;if(/[^A-Za-z0-9\+\/\=]/g.exec(b))throw Error("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding.");b=b.replace(/[^A-Za-z0-9\+\/\=]/g,"");do a=this.base64keyStr.indexOf(b.charAt(k++)),c=this.base64keyStr.indexOf(b.charAt(k++)),j=this.base64keyStr.indexOf(b.charAt(k++)),i=this.base64keyStr.indexOf(b.charAt(k++)),
a=a<<2|c>>4,c=(c&15)<<4|j>>2,g=(j&3)<<6|i,e+=String.fromCharCode(a),j!=64&&(e+=String.fromCharCode(c)),i!=64&&(e+=String.fromCharCode(g));while(k<b.length);return e};b.utf8Encode=function(b){for(var b=b.replace(/\r\n/g,"\n"),e="",a=0;a<b.length;a++){var c=b.charCodeAt(a);c<128?e+=String.fromCharCode(c):(c>127&&c<2048?e+=String.fromCharCode(c>>6|192):(e+=String.fromCharCode(c>>12|224),e+=String.fromCharCode(c>>6&63|128)),e+=String.fromCharCode(c&63|128))}return e}})(b.utils||(b.utils={}))})(d.framework||
(d.framework={}))})(geocortex||(geocortex={}));
(function(d){(function(b){(function(b){var h=function(){return function(a,c){this.handler=a;this.scope=c}}();b.EventSubscription=h;var e=function(){function a(c){this.subscriptions={};this.isPublishing=false;this.name=c}a.prototype.getSubscriptionHandlerByToken=function(c){return this.subscriptions.hasOwnProperty(c)?this.subscriptions[c].handler:null};a.prototype.subscribe=function(c,g){if(g===null||g===void 0)throw Error("Event handler cannot be null or undefined");for(var a=d.framework.utils.alphaNumericToken();this.getSubscriptionHandlerByToken[a];)a=
d.framework.utils.alphaNumericToken();var i=new h(g,c);this.subscriptions[a]=i;c&&c instanceof d.framework.FrameworkObject&&c.trackSubscription(this,a);return a};a.prototype.unsubscribe=function(c){if(!this.subscriptions.hasOwnProperty(c))return false;delete this.subscriptions[c];return true};a.prototype.clear=function(){this.subscriptions={}};a.prototype.publish=function(){for(var c=0;c<arguments.length-0;c++);this.isPublishing=true;for(var g in this.subscriptions)this.subscriptions.hasOwnProperty(g)&&
(c=this.subscriptions[g],c.handler.apply(c.scope,arguments));this.isPublishing=false};return a}();b.Event=e})(b.events||(b.events={}))})(d.framework||(d.framework={}))})(geocortex||(geocortex={}));
var Observable=function(){function d(b){this.bindingEvent=new geocortex.framework.events.Event("__anonymous");this.isObservable=true;this._syncSource=this._syncToken=null;this.value=b}d.prototype.set=function(b){this.value=b;this.bindingEvent.publish(b)};d.prototype.get=function(){return this.value};d.prototype.equals=function(b){var d=b;b&&b.get&&typeof b.get==="function"&&(d=b.get());if(this.value instanceof Array&&d instanceof Array){if(this.value.length!==d.length)return false;for(;0<this.value.length;)return this.value[0]!==
d[0]?false:true}return this.get()===d};d.makeBindableProxy=function(b){if(!b)return null;var f=[];if(b.___clonedObject)return b.___clonedObject;var h=function(){throw Error("Can't make method calls on a bindable proxy.");},e=function(c,g,a){for(var i=0;i<f.length;++i)if(g===f[i])return f[i];f.push(g);if(!g||typeof g==="string"||typeof g==="number"||typeof g==="boolean"){var b=new d(g);(function(){b.set=function(g){a[c]=g;b.set(g)};b.get=function(){return a[c]}})();return b}else if(g instanceof Array){for(var t=
new ObservableCollection,i=0;i<g.length;++i){var l={},l=e(i,g[i],g);t.addItem(l)}return t}else if(g instanceof Object){if(g.isObservable)return g;l={};for(t in g)g.hasOwnProperty(t)&&(l[t]=e(t,g[t],g));return l}else return g instanceof Function?h:g},a=e("root",{root:b},b);b.___clonedObject=a.root;return b instanceof Array?a.root:new d(a.root)};d.prototype.bind=function(b,d){return this.bindingEvent.subscribe(b,d)};d.prototype.unbind=function(b){return this.bindingEvent.unsubscribe(b)};d.prototype.once=
function(b,d){var h=this,e=this.bind(b,function(){h.unbind(e);d.apply(b,arguments)});return e};d.prototype.sync=function(b){if(this._syncToken&&this._syncSource)this._syncSource.unbind(this._syncToken),this._syncSource=this._syncToken=null;if(b)this.set(b.get()),this._syncSource=b,this._syncToken=b.bindingEvent.subscribe(this,function(b){this.set(b)})};d.prototype.syncTransform=function(b,d){if(this._syncToken&&this._syncSource)this._syncSource.unbind(this._syncToken),this._syncSource=this._syncToken=
null;if(b)this.set(d(b.get())),this._syncSource=b,this._syncToken=b.bindingEvent.subscribe(this,function(b){this.set(d(b))})};d.prototype.pulse=function(){this.set(this.get())};return d}(),ObservableCollection=function(){function d(b){this.bindingEvent=new geocortex.framework.events.Event("__anonymous");this.isObservableCollection=this.isObservable=true;this.useThrottling=false;this._syncSource=null;this.value=b||[]}d.prototype.isEmpty=function(){return this.value.length===0};d.prototype.length=function(){return this.value.length};
d.prototype.contains=function(b){return Array.contains(this.value,b)};d.prototype.getAt=function(b){return this.value[b]};d.prototype.getRange=function(b,d){return d===void 0?this.value.slice(b):this.value.slice(b,d+1)};d.prototype.indexOf=function(b){return this.value.indexOf(b)};d.prototype.get=function(){return this.value};d.prototype.getItems=function(){return this.value};d.prototype.getLength=function(){return this.value.length};d.prototype.addItems=function(b){if(b&&!(b.length<1)){var d=new geocortex.framework.events.CollectionChangedArgs;
d.type="append";d.rangeStart=this.value.length;this.value=this.value.concat(b);d.rangeEnd=d.rangeStart+b.length-1;d.sender=this;this.bindingEvent.publish(d)}};d.prototype.addItem=function(b){var d=new geocortex.framework.events.CollectionChangedArgs;d.type="append";d.rangeStart=this.value.length;d.rangeEnd=this.value.length;this.value.push(b);d.sender=this;this.bindingEvent.publish(d)};d.prototype.insertItems=function(b,d){if(d.length!=0)if(b>=this.value.length)this.addItems(d);else{var h=new geocortex.framework.events.CollectionChangedArgs;
h.type="insert";h.rangeStart=b;h.rangeEnd=b+d.length-1;h.sender=this;for(var e=0;e<d.length;++e)this.value.splice(b+e,0,d[e]);this.bindingEvent.publish(h)}};d.prototype.insertItem=function(b,d){if(b>=this.value.length)this.addItem(d);else{var h=new geocortex.framework.events.CollectionChangedArgs;h.type="insert";h.rangeStart=b;h.rangeEnd=b;h.sender=this;this.value.splice(b,0,d);this.bindingEvent.publish(h)}};d.prototype.removeItem=function(b){for(var d;(d=Array.pos(this.value,b))>-1;){var h=new geocortex.framework.events.CollectionChangedArgs;
h.type="remove";h.rangeStart=d;h.rangeEnd=d;h.sender=this;this.bindingEvent.publish(h);Array.remove(this.value,d,d)}};d.prototype.removeAt=function(b){if(0<=b&&b<this.getLength()){var d=new geocortex.framework.events.CollectionChangedArgs;d.type="remove";d.rangeStart=b;d.rangeEnd=b;d.sender=this;this.bindingEvent.publish(d);Array.remove(this.value,b,b)}};d.prototype.removeRange=function(b,d){if(!d)d=this.value.length;var h=new geocortex.framework.events.CollectionChangedArgs;h.type="remove";h.rangeStart=
b;h.rangeEnd=Math.min(d,this.value.length);h.sender=this;this.bindingEvent.publish(h);Array.remove(this.value,b,d)};d.prototype.clear=function(){if(this.value&&this.value.length!=0){var b=new geocortex.framework.events.CollectionChangedArgs;b.type="clear";b.rangeStart=0;b.rangeEnd=this.value.length-1;b.sender=this;this.bindingEvent.publish(b);this.value.length=0}};d.prototype.set=function(b){this.clear();b&&this.addItems(b)};d.prototype.pulse=function(){var b=new geocortex.framework.events.CollectionChangedArgs;
b.type="clear";b.rangeStart=0;b.rangeEnd=this.value.length-1;b.sender=this;this.bindingEvent.publish(b);b=new geocortex.framework.events.CollectionChangedArgs;b.type="append";b.rangeStart=0;b.rangeEnd=this.value.length-1;b.sender=this;this.bindingEvent.publish(b)};d.prototype.bind=function(b,d){return this.bindingEvent.subscribe(b,d)};d.prototype.unbind=function(b){return this.bindingEvent.unsubscribe(b)};d.prototype.once=function(b,d){var h=this,e=h.bind(b,function(){h.unbind(e);d.apply(b,arguments)});
return e};d.prototype.sync=function(b){if(b.value&&b.bindingEvent)this.clear(),this.value=b.value,b.bindingEvent.subscribe(this,function(d){this.value=b.value;var h=dojo.mixin({},d);h.sender=this;this.bindingEvent.publish(h);if(d.type==="clear")this.value=[]})};d.prototype.equals=function(b){var d=b;b&&b.isObservableCollection&&(d=b.get());if(!d.hasOwnProperty("length"))throw Error("Type mismatch");if(this.get().length!==d.length)return false;for(b=0;b<this.get().length;b++)if(this.value[b]!==d[b])return false;
return true};return d}();
(function(d){(function(b){(function(b){(function(b){b.remove=function(b,a,c){c=b.slice((c||a)+1||b.length);b.length=a<0?b.length+a:a;return b.push.apply(b,c)};b.removeItem=function(d,a){var c=b.pos(d,a);return c==-1?null:b.remove(d,c,c)};b.contains=function(b,a){for(var c=b.length;c--;)if(b[c]===a)return true;return false};b.pos=function(b,a){for(var c=b.length;c--;)if(b[c]===a)return c;return-1};if(!Array.prototype.indexOf)Array.prototype.indexOf=function(b){if(this==null)throw new TypeError;var a=
Object(this),c=a.length>>>0;if(c===0)return-1;var g=0;arguments.length>1&&(g=Number(arguments[1]),g!=g?g=0:g!=0&&g!=Infinity&&g!=-Infinity&&(g=(g>0||-1)*Math.floor(Math.abs(g))));if(g>=c)return-1;for(g=g>=0?g:Math.max(c-Math.abs(g),0);g<c;g++)if(g in a&&a[g]===b)return g;return-1};if(!Array.prototype.lastIndexOf)Array.prototype.lastIndexOf=function(b){if(this==null)throw new TypeError;var a=Object(this),c=a.length>>>0;if(c===0)return-1;var g=c;arguments.length>1&&(g=Number(arguments[1]),g!=g?g=0:
g!=0&&g!=1/0&&g!=-(1/0)&&(g=(g>0||-1)*Math.floor(Math.abs(g))));for(c=g>=0?Math.min(g,c-1):c-Math.abs(g);c>=0;c--)if(c in a&&a[c]===b)return c;return-1};if(!Array.prototype.forEach)Array.prototype.forEach=function(b,a){var c,g;if(this==null)throw new TypeError("this is null or not defined");var j=Object(this),i=j.length>>>0;if({}.toString.call(b)!=="[object Function]")throw new TypeError(b+" is not a function");a&&(c=a);for(g=0;g<i;){var d;Object.prototype.hasOwnProperty.call(j,g)&&(d=j[g],b.call(c,
d,g,j));g++}};if(!Array.prototype.every)Array.prototype.every=function(b,a){if(this==null)throw new TypeError;var c=Object(this),g=c.length>>>0;if(typeof b!="function")throw new TypeError;for(var j=0;j<g;j++)if(j in c&&!b.call(a,c[j],j,c))return false;return true};if(!Array.prototype.some)Array.prototype.some=function(b,a){if(this==null)throw new TypeError;var c=Object(this),g=c.length>>>0;if(typeof b!="function")throw new TypeError;for(var j=0;j<g;j++)if(j in c&&b.call(a,c[j],j,c))return true;return false};
if(!Array.prototype.filter)Array.prototype.filter=function(b,a){if(this==null)throw new TypeError;var c=Object(this),g=c.length>>>0;if(typeof b!="function")throw new TypeError;for(var j=[],i=0;i<g;i++)if(i in c){var d=c[i];b.call(a,d,i,c)&&j.push(d)}return j};if(!Array.prototype.map)Array.prototype.map=function(b,a){var c,g,j;if(this==null)throw new TypeError(" this is null or not defined");var i=Object(this),d=i.length>>>0;if(typeof b!=="function")throw new TypeError(b+" is not a function");a&&(c=
a);g=Array(d);for(j=0;j<d;){var t;j in i&&(t=i[j],t=b.call(c,t,j,i),g[j]=t);j++}return g}})(b.ArrayUtils||(b.ArrayUtils={}))})(b.utils||(b.utils={}))})(d.framework||(d.framework={}))})(geocortex||(geocortex={}));Array.remove=geocortex.framework.utils.ArrayUtils.remove;Array.removeItem=geocortex.framework.utils.ArrayUtils.removeItem;Array.contains=geocortex.framework.utils.ArrayUtils.contains;Array.pos=geocortex.framework.utils.ArrayUtils.pos;
(function(d){(function(b){(function(b){var d=function(){function b(a,c){this.period=100;this.period=a;this.action=c;var g=this;setTimeout(function(){g.execute(g)},this.period)}b.prototype.execute=function(a){a.action()&&setTimeout(function(){a.execute(a)},this.period)};return b}();b.ThrottledOperation=d})(b.utils||(b.utils={}))})(d.framework||(d.framework={}))})(geocortex||(geocortex={}));
(function(d){(function(b){(function(b){var d=function(){function b(){this.target=this.attributeName=this.type=this.domElement=null;this.invert=false;this.domEventSubscriptions=[];this.templateKey=this.templateMode=null;this.templateSelections={};this.boundViews=this.parentView=null;this.type="attr"}b.prototype.destroy=function(){if(this.templateSelections)for(var a in this.templateSelections)if(this.templateSelections.hasOwnProperty(a)){var c=this.templateSelections[a];c&&c.___domParent&&dojo.place(c,
c.___domParent,"last")}this.viewModel=this.parentView=this.target=this.domElement=null;for(a=0;a<this.domEventSubscriptions.length;++a)dojo.disconnect(this.domEventSubscriptions[a]);this.domEventSubscriptions=[];for(a=0;a<this.targetBindings.length;++a)this.targetBindings[a].event.unsubscribe(this.targetBindings[a].token);this.targetBindings=[];for(a=0;a<this.boundViews.length;++a)this.boundViews[a].destroyBindings();this.boundViews=[]};return b}();b.BindingExpression=d})(b.ui||(b.ui={}))})(d.framework||
(d.framework={}))})(geocortex||(geocortex={}));
(function(d){(function(b){(function(b){var d=function(){function b(){this.parent=this.domElement=null;this.children=[];this.expressions=[];this.context=null;this.contextChange=false;this.context=this.parent=this.domElement=null}b.prototype.destroy=function(){this.context=this.parent=this.domElement=null;this.contextChange=false;for(var a=0;a<this.expressions.length;++a)this.expressions[a].destroy();this.expressions=[];for(a=0;a<this.children.length;++a)this.children[a].destroy();this.children=[]};
return b}();b.BindingNode=d})(b.ui||(b.ui={}))})(d.framework||(d.framework={}))})(geocortex||(geocortex={}));var __extends=this.__extends||function(d,b){function f(){this.constructor=d}for(var h in b)b.hasOwnProperty(h)&&(d[h]=b[h]);f.prototype=b.prototype;d.prototype=new f};
(function(d){(function(b){(function(f){var h=function(e){function a(c,g){e.call(this,c,g);this.isManaged=this.isActive=false;this.isBusy=new Observable(false);this.title=new Observable("");this.description=new Observable("");this.iconUri=new Observable("");this.viewModel=this.markupResource=null;this.typeName=this.regionName="";this.parentView=this.bindingTree=this.root=null;this.childRegions=[];this.bound=false;this.disposableBindings=[];this.bindingSetupDelegates=[];this.buildDisabledBinding=function(c,
g){var a=this.getBindingTarget(g);if(a===void 0)return this.app.trace.debug("Binding error: Property '{0}' does not exist in view model '{1}'.".format(g.target,g.viewModel.id)),false;else{g.initialDisabled=dojo.attr(c,"disabled");var b=function(b){var e=false;if(b){if(a)if(b instanceof d.framework.events.CollectionChangedArgs)if(b.type=="append"){if(b.rangeEnd+1-b.rangeStart>0||a.value&&a.value.length>0)e=false}else b.type=="clear"?e=true:b.type=="insert"?b.rangeEnd+1-b.rangeStart>0&&(e=false):b.type==
"remove"&&b.rangeEnd+1-b.rangeStart<a.value.length&&(e=false);else e=a.isObservableCollection?!(a.getLength()>0):a.isObservable?!a.get():typeof b==="string"?b.length==0:false}else e=true;g.invert==true&&(e=!e);e==true?(dojo.attr(c,"disabled",true),dojo.addClass(c,"bound-disabled")):(dojo.removeAttr(c,"disabled"),dojo.removeClass(c,"bound-disabled"))},e=this;a.isObservable&&g.targetBindings.push({event:a.bindingEvent,token:a.bind(this,b)});this.bindingSetupDelegates.push(function(){b.apply(e,[a])})}};
this.id="View-"+d.framework.utils.alphaNumericToken()}__extends(a,e);a.prototype.addDisposableBinding=function(c,g){this.disposableBindings.push({event:c.bindingEvent,token:g})};a.prototype.attach=function(c){if(!this.bound&&(this.viewModel=c,this.root))this.bindingTree=this.buildTree(),this.viewModel!==null&&this.viewModel!==void 0&&this.pulseAll(),this.bound=true};a.prototype.activated=function(){};a.prototype.deactivated=function(){};a.prototype.added=function(){if(!this.bound&&this.viewModel)this.bindingTree=
this.buildTree(),this.bound=true,this.pulseAll()};a.prototype.removed=function(){this.destroyBindings()};a.prototype.destroy=function(){this.destroyBindings()};a.prototype.destroyBindings=function(){if(this.bindingTree){this.bindingTree.destroy();for(var c=0;c<this.disposableBindings.length;++c){var g=this.disposableBindings[c];g.event.unsubscribe(g.token)}this.bound=false;this.disposableBindings=[];this.bindingSetupDelegates=[]}};a.prototype.pulseAll=function(){for(var c=0;c<this.bindingSetupDelegates.length;++c)try{this.bindingSetupDelegates[c]()}catch(g){this.app.trace.error("Error performing initial data-bind in view '{0}' with view model '{1}': {2}".format(this.id,
this.viewModel.id,g.message))}this.bindingSetupDelegates=[]};a.prototype.resolveWidget=function(){return null};a.prototype.buildTree=function(){function c(a,j){function e(c){var g=[];if(!c)return g;var a=c.match(/\{(.*?)\}/g);if(!a)if(this.app)return this.app.trace.warning("Invalid data-binding expression '{0}'.".format(c)),[];else throw Error("Invalid data-binding expression '{0}'.".format(c));for(c=0;c<a.length;++c){var b=a[c].split(":");b.length==2&&g.push({directive:b[0].replace("{","").trim(),
target:b[1].replace("}","").trim()})}return g}if(j&&j.children)for(var l=0;l<j.children.length;++l){var h=j.children[l],m=dojo.attr(h,"data-region-name"),f=dojo.attr(h,"data-binding");f||(f=h.___dataBindingExpressions);if(f){var p=e(f);h.___dataBindingExpressions=f;g.app.debugMode||dojo.removeAttr(h,"data-binding");if(p&&p.length!==0){for(var r=false,v=0;v<p.length;++v)(function(){var c=a.expressions,j=a.context,k=false,l=p[v],f=l.directive,m=l.target,o=new d.framework.ui.BindingExpression;o.type=
"attr";o.domElement=h;o.attributeName=null;o.target=m;o.invert=false;o.domEventSubscriptions=[];o.targetBindings=[];o.boundViews=[];g.viewModel!=null?o.viewModel=g.viewModel:(o.viewModel={},o.viewModel.id="[None]");o.parentView=g.parentView?g.parentView:g;if(f.startsWith("@"))if(m=f.split("-")[1],f.startsWith("@event-"))m?(o.type="event",o.attributeName=m):(this.app.trace.warning("Binding error: Invalid event binding expression '{0}' in view '{1}'.".format(f,g.id)),k=true);else if(f.startsWith("@var"))o.type=
"var";else if(f.startsWith("@text"))o.attributeName="innerHTML",o.type="text";else if(f.startsWith("@attach"))o.attributeName="___attachedValue",o.type="attachment";else if(f.startsWith("@style-"))l=f.indexOf("-"),(l=f.substring(l+1))?(o.type="style",o.attributeName=l):(this.app.trace.warning("Binding error: Invalid style binding expression '{0}' in view '{1}'.".format(f,g.id)),k=true);else if(f.startsWith("@dom"))o.type="dom",o.attributeName=m;else if(f.startsWith("@value"))o.type="value",o.attributeName=
m;else if(f.startsWith("@widget"))o.type=f.substring(1),o.attributeName=m,o.otherExpressions=p;else if(f==="@source"){o.type="source";o.attributeName="@source";r=true;o.templateMode="single-inline";for(m=0;m<p.length;++m)if(f=p[m],f!==l){var q=f.directive,f=f.target;if(q==="@template"){o.templateMode="single-external";l=new b.config.ViewConfig(null,null,null);l.markupResource=f;l.libraryId=g.libraryId;var s=g.app.viewManager.createView(l);if(!s){g.app.trace.error("Could not instantiate template '{0}' while binding view '{1}'.".format(f,
this.id));break}s.app=g.app;o.templateSelections={"@default":s.root};break}else if(q==="@template-selector"){o.templateMode="inline-selected";o.templateKey=f;o.templateSelections={};break}}if(o.templateMode!=="single-external"){l=new dojo.NodeList;for(f=0;f<h.children.length;++f)for(var m=h.children[f],q=dojo.attr(m,"data-binding"),s=e(q),w=0;w<s.length;++w)if(q=s[w],q.directive==="@template-for"||q.directive==="@template-select"){if(q.directive==="@template-for"&&q.target===o.target)l.push(m),s=
dojo.clone(m),o.templateSelections["@default"]=s,s.___domParent=h;else if(q.directive==="@template-select"){l.push(m);for(var w=false,B=0;B<s.length;++B){var C=s[B];if(C.directive==="@template"){s=new b.config.ViewConfig(null,null,null);s.markupResource=C.target;s.libraryId=g.libraryId;s=g.app.viewManager.createView(s);if(!s){this.app.trace.error("Could not instantiate template '{0}' while binding view '{1}'.".format(C.target,this.id));break}s.app=g.app;w=dojo.clone(m);dojo.place(s.root,w,"last");
o.templateSelections[q.target]=w;w=true;break}}if(!w)l.push(m),o.templateSelections[q.target]=m,m.___domParent=h}break}l.orphan()}}else if(f==="@source-remove")o.type="source-remove",o.attributeName=m;else if(f==="@source-add")o.type="source-add",o.attributeName=m;else if(f==="@visible"||f==="@hidden"){if(f==="@hidden")o.invert=true;o.type="visibility";o.attributeName="@visibility"}else if(f==="@disabled"||f==="@enabled"){if(f==="@disabled")o.invert=true;o.type="disabledState";o.attributeName="@disabledState"}else f.startsWith("@template")?
o.type="template":f.startsWith("@halt")?r=true:(g.app.trace.warning("Unknown binding term '{0}'.".format(f)),k=true);else o.type="attr",o.attributeName=f;k||g.applyBinding.apply(g,[h,o,j,a])&&c.push(o)})();f=new d.framework.ui.BindingNode;f.domElement=h;f.parent=a;f.context=a.context;f.children=[];f.expressions=[];a.children.push(f);r==false&&!m&&c(f,h)}}else m||c(a,h)}}var g=this;if(this.root!=null){var a=new d.framework.ui.BindingNode;a.domElement=null;a.parent=null;a.children=[];a.context=this.viewModel;
c(a,this.root);return a}};a.prototype.getBindingTarget=function(c){if(c.target==="@context")return c.viewModel;if(c.target.indexOf("@language-")>-1)return this.app.getResource(this.libraryId,"language-"+c.target.split("-").slice(1).join("-"));if(c.viewModel.isObservable!=true)return c.viewModel[c.target];else{var g=c.viewModel.get();return g==null?g:g[c.target]}};a.prototype.setBindingTargetValue=function(c,g){if(c.target==="@context")c.viewModel&&c.viewModel.isObservable?c.viewModel.set(g):c.viewModel=
g;else if(!(c.target.indexOf("@language-")>-1))if(c.viewModel.isObservable){var a=c.viewModel.get();a&&(a[c.target]?a[c.target].isObservable?a[c.target].set(g):a[c.target]=g:a[c.target]=new Observable(g))}else c.viewModel[c.target].isObservable?c.viewModel[c.target].set(g):c.viewModel[c.target]=g};a.prototype.resolveBindingTemplate=function(c,g){var a=null;if(c.templateMode==="single-inline"||c.templateMode==="single-external")a=dojo.clone(c.templateSelections["@default"]);else if(c.templateMode===
"inline-selected"){var b=null;g[c.templateKey]&&(b=g[c.templateKey],b.isObservable&&(b=b.get()));!b&&c.templateSelections.hasOwnProperty("@null")?a=dojo.clone(c.templateSelections["@null"]):c.templateSelections.hasOwnProperty(b)&&(a=dojo.clone(c.templateSelections[b]));!a&&c.templateSelections.hasOwnProperty("@default")&&(a=dojo.clone(c.templateSelections["@default"]),dojo.addClass(a,"empty-div"))}a||(a=dojo.create("div"));return a};a.prototype.buildSourceBinding=function(c,g,a,b){var k=this,e=k.getBindingTarget(g);
if(e===null)return false;if(e===void 0)return k.app.trace.warning("Binding error: '{0}' in view model '{1}' was not bindable.".format(g.target,g.viewModel.id)),false;var f=function(a){if(g.upToDate===true)g.upToDate=false;else{for(var j=null,f=null,l=0;l<b.expressions.length;++l){var h=b.expressions[l];if(!j&&h.type=="source-add")j=h.target;if(!f&&h.type=="source-remove")f=h.target}l=this;if(g.parentView)l=g.parentView;var n=l[j],j=l[f];if(a!==void 0){if(a instanceof d.framework.events.CollectionChangedArgs)if(a===
null||a.type==="clear"){if(j)for(h=a.rangeStart;h<=a.rangeEnd;++h)j.apply(k,[g,e.getAt(h),a,h]);for(h=0;h<g.boundViews.length;++h)this.app.viewManager.destroyView(g.boundViews[h]);g.boundViews=[];if(!j&&g.domElement!=null&&g.domElement.children!=null){l=new dojo.NodeList;for(h=0;h<g.domElement.children.length;++h)g.domElement.children[h].___collectionTemplate||l.push(g.domElement.children[h]);l.orphan()}}else{if(a.type==="replace"){if(j)for(h=a.rangeStart;h<a.rangeEnd+1;++h)j.apply(k,[g,e.getAt(h),
a,h]);for(h=0;h<g.boundViews.length;++h)this.app.viewManager.destroyView(g.boundViews[h]);g.boundViews=[];j||dojo.empty(g.domElement);a.type="append";a.rangeStart=0;a.rangeEnd=e.value.length-1}}else{f=a.isObservable?a.get():a;j&&j.apply(k,[g,f,a,0]);for(h=0;h<g.boundViews.length;++h)this.app.viewManager.destroyView(g.boundViews[h]);g.boundViews=[];if(!j&&(h=g.___singleSourceItem))l=new dojo.NodeList,l.push(h),l.orphan(),g.___singleSourceItem=null;if(f)if(n)n.apply(k,[g,f,a,0]);else{l=k.resolveBindingTemplate(g,
f);dojo.place(l,g.domElement,"last");h=new d.framework.ui.ViewBase(k.app);h.parentView=g.parentView;h.app=h.parentView.app;h.libraryId=k.libraryId;var u={children:[]};u.children.push(l);if(!f)f=new d.framework.ui.ViewModelBase(k.app,k.libraryId),f.app=k.app,f.libraryId=k.libraryId;f.hasOwnProperty("___boundViews");h.root=u;h.attach(f);h.root=l;g.___singleSourceItem=h.root;g.boundViews.push(h)}}if(a.type==="append"||a.type==="insert"){var y=null;a.type==="insert"&&g.domElement.children.length>a.rangeStart&&
(y=g.domElement.children[a.rangeStart]);var D=function(b,j){if(b>j)return false;for(var i=b;i<=j;++i){var h=null;if(n!=null)n.apply(k,[g,e.getAt(i),a,i]);else{var f=e.getAt(i),h=k.resolveBindingTemplate(g,f);y&&a.type==="insert"?dojo.place(h,y,"before"):y&&a.type==="append"?dojo.place(h,y,"after"):dojo.place(h,g.domElement,"last");var l=new d.framework.ui.ViewBase(k.app,k.libraryId);l.parentView=g.parentView;l.app=l.parentView.app;l.libraryId=k.libraryId;l.id+="-item"+i;var z={children:[]};z.children.push(h);
if(f===null||f===void 0)f=new d.framework.ui.ViewModelBase(k.app,k.libraryId),f.app=k.app,f.libraryId=k.libraryId;f.hasOwnProperty("___boundViews");l.root=z;l.attach(f);l.root=h;g.boundViews.push(l)}}c.___populateInitialValueFunc&&(c.___populateInitialValueFunc(),Array.removeItem(c,c.___populateInitialValueFunc));return true};if(e.useThrottling){var z=a.rangeStart,A=Math.min(z+10,a.rangeEnd);new d.framework.utils.ThrottledOperation(e.throttleDelay,function(){if(A>a.rangeEnd)return false;var c=D(z,
A);z+=10;A+=10;return c})}else D(a.rangeStart,a.rangeEnd)}else if(a.type==="remove")for(f=a.rangeStart;f<=a.rangeEnd;++f)for(l=0;l<g.boundViews.length;++l)h=g.boundViews[l],h.viewModel!==null&&h.viewModel!==void 0&&h.viewModel==e.getAt(f)&&(j?j.apply(k,[g,a[f],a,f]):k.app.viewManager.destroyView(h),Array.removeItem(g.boundViews,h),--l)}}};e.bind&&g.targetBindings.push({event:e.bindingEvent,token:e.bind(k,f)});if(e.isObservableCollection){var h=e.getLength()-1;this.bindingSetupDelegates.push(function(){var c=
new d.framework.events.CollectionChangedArgs;c.type="append";c.rangeStart=0;c.rangeEnd=h;c.sender=e;f.apply(k,[c]);e.isObservable&&e.bindingEvent.isPublishing&&(g.upToDate=true)})}else this.bindingSetupDelegates.push(function(){f.apply(k,[e]);e.isObservable&&e.bindingEvent.isPublishing&&(g.upToDate=true)})};a.prototype.buildEventBinding=function(c,g,a){var b=this;if(!this[g.target]&&g.parentView&&g.parentView[g.target])b=g.parentView;if(b[g.target])g.domEventSubscriptions.push(dojo.connect(c,g.attributeName,
null,function(d){var e=b[g.target](d,c,a);return!e?(dojo.stopEvent(d),false):e}));else return this.app.trace.warning("Binding error: Event handler '{0}' was not found in view '{1}' or its parent view.".format(g.target,b.id)),false};a.prototype.buildVarBinding=function(c,g){var a=this;if(g.parentView)a=g.parentView;var b=a[g.target];b?b&&b instanceof Array?b.push(c):b&&b.isObservableCollection?b.addItem(b):a[g.target]=c:a[g.target]=c};a.prototype.buildTextBinding=function(c,g){var a=this.getBindingTarget(g);
if(a===null)return false;if(a===void 0)return this.app.trace.warning("Binding error: Property '{0}' does not exist in view model '{1}'.".format(g.target,g.viewModel.id)),false;var b=function(){if(a!=null&&!a.isObservable)g.attributeName==="innerHTML"?(dojo.empty(c),c.appendChild(document.createTextNode(a))):dojo.attr(c,g.attributeName,String.escapeHtml(a));else{var b=a.get(),b=b===null||b===void 0?"":b.toString();g.attributeName==="innerHTML"?(dojo.empty(c),c.appendChild(dojo.doc.createTextNode(b))):
dojo.attr(c,g.attributeName,String.escapeHtml(b))}};a.isObservable&&g.targetBindings.push({event:a.bindingEvent,token:a.bind(this,b)});this.bindingSetupDelegates.push(function(){b.apply(this,[null])})};a.prototype.buildAttributeBinding=function(c,g,a,b){var d=this.getBindingTarget(g);if(typeof d==="undefined")return this.app.trace.warning("Binding error: Property '{0}' does not exist in view model '{1}'.".format(g.target,g.viewModel.id)),false;var e=function(){if(d===null)return dojo.attr(c,g.attributeName,
""),false;else if(d.isObservable){var a=d.get();if(a===null||a===void 0)a="";b===true?c[g.attributeName]=a:dojo.attr(c,g.attributeName,a)}else{if(d===null||d===void 0)d="";b===true?c[g.attributeName]=d:dojo.attr(c,g.attributeName,d)}};d!==null&&d.isObservable&&g.targetBindings.push({event:d.bindingEvent,token:d.bind(this,e)});this.bindingSetupDelegates.push(function(){e.apply(this,[null])})};a.prototype.buildStyleBinding=function(c,g){var a=this,b=this.getBindingTarget(g);if(b===null)return false;
if(b===void 0)return this.app.trace.warning("Binding error: Property '{0}' does not exist in view model '{1}'.".format(g.target,g.viewModel.id)),false;else if(b!=null&&!b.isObservable){var d=!isNaN(b)&&b!==""?b+"px":b;dojo.style(c,g.attributeName,d)}else if(b!=null){var e=function(){var a;a=b.get();a=!isNaN(a)&&a!==""?a+"px":a;dojo.style(c,g.attributeName,a)};b.isObservable&&g.targetBindings.push({event:b.bindingEvent,token:b.bind(this,e)});this.bindingSetupDelegates.push(function(){e.apply(a,[null])})}};
a.prototype.buildDomBinding=function(c,a){var b=this;if(a.parentView)b=a.parentView;var d=b[a.target];if(d==null)return false;if(d===void 0)return this.app.trace.warning("Binding error: Property '{0}' does not exist in view model '{1}'.".format(a.target,a.viewModel.id)),false;else try{if(d.isObservable){a.targetBindings.push({event:d.bindingEvent,token:d.bind(this,function(){if(!d.get())return false;a.domElement=dojo.place(d.get(),a.domElement,"replace");this.app&&this.app.viewManager.notifyDimensionsChanged(this)})});
if(!d.get())return false;dojo.place(d.get(),a.domElement,"replace")}else{if(!d)return false;dojo.place(d,a.domElement,"replace")}}catch(e){this.app.trace.warning("Binding error: An error occurred in view '{0}' while attempting to perform a DOM binding in view model '{1}'.".format(this.id,a.viewModel.id))}};a.prototype._createWidgetViewFromConfig=function(c,a){var j=c.type,i=c.id?"WidgetView-{0}-{1}".format(c.id,d.framework.utils.alphaNumericToken()):"{0}-{1}".format(d.framework.utils.alphaNumericToken(),
d.framework.utils.alphaNumericToken()),i=new b.config.ViewConfig(i,null,j||"geocortex.framework.ui.ViewBase");i.isVisible=true;i.libraryId=c.libraryId;if(c.markup)i.markupResource=c.markup;j=null;if(c.viewModelId){if(j=this.app.getFrameworkObjectById(c.viewModelId),!j)throw Error("Could not bind widget '{0}' to view model with ID '{1}': View model not found.".format(c.Id,c.viewModelId));}else if(c.viewModelType){j=this.app.instantiateFrameworkObject(c.viewModelType,c.libraryId);if(!c.id)c.id=d.framework.utils.alphaNumericToken();
j.id="WidgetViewModel-{0}-{1}".format(c.id,d.framework.utils.alphaNumericToken())}else j=a;i=this.app.viewManager.createView(i);if(!i)throw Error("Could not create widget '{0}': The widget's view could not be created.".format(c.Id));if(i.root.children&&i.root.children.length===1)i.root=i.root.children[0];var e={children:[]};e.children.push(i.root);i.root=e;i.attach(j);i.root=e.children[0];return i};a.prototype.buildWidgetBinding=function(c,a){var b=this,i=a.target,e=this.viewModel,h=true,f=null,n=
null;if(a.otherExpressions)for(var m=0;m<a.otherExpressions.length;++m)if(n=a.otherExpressions[m],n.directive==="@widget-context"){a.target=n.target;e=this.getBindingTarget(a);if(!e)return this.app.trace.error("Error binding widget '{0}' to target '{1}': Target was not found in view model.".format(i,n.target)),false;f=e}else n.directive==="@widget-required"&&(h=n.target!=="false");for(var n=e&&e.isObservable,q=this.app.configModel.widgetConfigs,p=null,m=0;m<q.length;++m){var r=q[m];if(r.id===i){p=
r;break}}var v=!p,x=function(){var c=f||null;c&&c.isObservable&&(c=c.get());c=(a.parentView||this).resolveWidget(i,c);if(!c){if(h)throw Error("Widget '{0}' was not found.".format(i));return false}return c},u=function(c,e){var k=null;if(a.boundViews.length>0)for(k=0;k<a.boundViews.length;++k)b.app.viewManager.destroyView(a.boundViews[k]);dojo.empty(a.domElement);if(c){if(typeof c==="string")k=dojo.create("div"),dojo.attr(k,"innerHTML",c),dojo.addClass(k,"empty-div"),k=k.children&&k.children.length===
1?k.children[0]:k;else if(c.hasOwnProperty("nodeType")&&[1,2,3,8,9].contains(p.nodeType))k=c;else if(c instanceof d.framework.ui.ViewBase)a.boundViews.push(c),k=c.root;else if(c instanceof d.framework.config.WidgetConfig){var h=b._createWidgetViewFromConfig(c,e),k=h.root;a.boundViews.push(h)}else{b.app.trace.warning("Could not resolve widget '{0}': Object of unknown type provided.".format(i));return}dojo.place(k,a.domElement,"last")}};n&&a.targetBindings.push({event:e.bindingEvent,token:e.bind(this,
function(c){if(v){var a=x();u(a,c)}else u(p,c)})});this.bindingSetupDelegates.push(function(){var c=null;e&&(c=e.isObservable?e.get():e);if(v){var a=x();u(a,c)}else u(p,c)})};a.prototype.buildVisibilityBinding=function(c,a){var b=this.getBindingTarget(a);if(b===null)return false;if(b===void 0)return this.app.trace.debug("Binding error: Property '{0}' does not exist in view model '{1}'.".format(a.target,a.viewModel.id)),false;else{a.initialVisibility=dojo.style(c,"display")||"block";var i=function(i){var e=
false;if(i){if(b)if(i instanceof d.framework.events.CollectionChangedArgs)if(i.type=="append"){if(i.rangeEnd+1-i.rangeStart>0||b.value&&b.value.length>0)e=true}else i.type=="clear"?e=false:i.type=="insert"?i.rangeEnd+1-i.rangeStart>0&&(e=true):i.type=="remove"&&i.rangeEnd+1-i.rangeStart<b.value.length&&(e=true);else e=b.isObservableCollection?b.getLength()>0:b.isObservable?!!b.get():i?true:typeof i==="string"?i.length>0:false}else e=false;a.invert==true&&(e=!e);i="";i=a.initialVisibility==="inline"?
"bound-visible-inline":"bound-visible";e==true?(dojo.removeClass(c,"bound-invisible"),dojo.addClass(c,i)):(dojo.removeClass(c,i),dojo.addClass(c,"bound-invisible"))},e=this;b.isObservable&&a.targetBindings.push({event:b.bindingEvent,token:b.bind(this,i)});this.bindingSetupDelegates.push(function(){i.apply(e,[b])})}};a.prototype.buildValueBinding=function(c,a){var b=this,i=this.getBindingTarget(a);if(i==null)return false;if(i===void 0)return this.app.trace.warning("Binding error: Property '{0}' does not exist in view model '{1}'.".format(a.target,
a.viewModel.id)),false;var e=i.isObservable||false,h=i.isObservableCollection||false,f=c.tagName.toLowerCase(),n=dojo.attr(c,"type");if(e){var m=function(a){if(a!==dojo.attr(c,"value")){if(a===null||a===void 0)a="";dojo.attr(c,"value",a)}},q=function(a){c.checked=a===true},p=function(a){var g=dojo.attr(c,"value");dojo.query("input[type=radio]",this.root).forEach(function(){});c.checked=a===true||g==a?true:false},r=function(c){if(c instanceof d.framework.events.CollectionChangedArgs){for(var b=c,j=
b.sender,i={},e=b.rangeStart;e<=b.rangeEnd;e++){var k=j.getAt(e);i[k+""]=true}if(b.type==="append"||b.type==="insert")for(b=0;b<a.domElement.options.length;++b)if(j=a.domElement.options[b],i[j.value+""]&&(j.selected=true,!dojo.attr(a.domElement,"multiple")))break}else{var h=c;if(typeof c==="number"||typeof c==="boolean")c=c.toString();i=function(a,g){return typeof a.___attachedValue!=="undefined"?a.___attachedValue===h:a.value===(g===void 0?c:g)};if(c===null||c===void 0)for(b=0;b<a.domElement.options.length;++b)j=
a.domElement.options[b],j.selected=false;else if(dojo.isArray(c))if(a.viewModel[a.target].isObservableCollection){e=false;for(b=0;b<a.domElement.options.length;++b)if(j=a.domElement.options[b],j.selected=false,dojo.attr(a.domElement,"multiple")||!e)for(k=0;k<c.length;++k){var f=c[k];if(i(j,f)){e=j.selected=true;break}}}else for(b=0;b<a.domElement.options.length;++b){if(j=a.domElement.options[b],i(j,f)){j.selected=true;break}}else for(b=0;b<a.domElement.options.length;++b)if(j=a.domElement.options[b],
i(j,f)){j.selected=true;break}}};f==="select"?(a.targetBindings.push({event:i.bindingEvent,token:i.bind(a,r)}),b.bindingSetupDelegates.push(function(){r.apply(b,[i.get()])})):n==="radio"?(a.targetBindings.push({event:i.bindingEvent,token:i.bind(a,p)}),b.bindingSetupDelegates.push(function(){p.apply(b,[i.get()])})):n==="checkbox"?(a.targetBindings.push({event:i.bindingEvent,token:i.bind(a,q)}),b.bindingSetupDelegates.push(function(){q.apply(b,[i.get()])})):(a.targetBindings.push({event:i.bindingEvent,
token:i.bind(a,m)}),b.bindingSetupDelegates.push(function(){m.apply(b,[i.get()])}))}var v=function(c){a.domEventSubscriptions.push(dojo.connect(c,"change",function(c){c=dojo.attr(c.currentTarget,"value");e?i.set(c):b.setBindingTargetValue(a,c);return true}))},x=function(c){a.domEventSubscriptions.push(dojo.connect(c,"change",function(c){c=dojo.attr(c.currentTarget,"checked");e?i.set(c):b.setBindingTargetValue(a,c);return true}))},u=function(c){a.domEventSubscriptions.push(dojo.connect(c,"click",function(c){dojo.attr(c.currentTarget,
"checked")&&(e?i.set(c.currentTarget.value):b.setBindingTargetValue(a,c.currentTarget.value));return true}))},y=function(c){c.___populateInitialValueFunc=function(){r(i.isObservable?i.get():i)};a.domEventSubscriptions.push(dojo.connect(c,"change",function(){for(var d=dojo.query("option",c),f=[],l=0;l<d.length;++l){var m=d[l];if(m.selected===true){var n=m.___attachedValue;n?f.push(n):f.push(m.value)}}if(f.length===0&&d.length>0&&!c.multiple&&b.app.___uaIsiPad===true)c.selectedIndex=0,n=d[0].___attachedValue,
f.push(n?n:d[0].value);f.length>0?h?(i.clear(),i.addItems(f)):e?i.set(f[0]):b.setBindingTargetValue(a,f):i.clear();return true}))};f==="textarea"||f==="input"&&n==="text"?function(c){var d=null,f=function(c){c=dojo.attr(c.currentTarget,"value");if(c!==d)return d=c,e?i.set(c):b.setBindingTargetValue(a,c),true};a.domEventSubscriptions.push(dojo.connect(c,"change",f));a.domEventSubscriptions.push(dojo.connect(c,"keyup",f));a.domEventSubscriptions.push(dojo.connect(c,"mouseup",f))}(c):f==="input"&&n===
"checkbox"?x(c):f==="input"&&n==="radio"?u(c):f==="select"?y(c):v(c)};a.prototype.applyBinding=function(c,a,b,d){a.type==="source"?this.buildSourceBinding(c,a,b,d):a.type==="event"?this.buildEventBinding(c,a,b):a.type==="text"?this.buildTextBinding(c,a,b):a.type==="var"?this.buildVarBinding(c,a,b):a.type==="style"?this.buildStyleBinding(c,a,b):a.type==="dom"?this.buildDomBinding(c,a,b):a.type==="value"?this.buildValueBinding(c,a,b):a.type==="attr"?this.buildAttributeBinding(c,a,b):a.type==="attachment"?
this.buildAttributeBinding(c,a,b,true):a.type==="visibility"?this.buildVisibilityBinding(c,a,b):a.type==="disabledState"?this.buildDisabledBinding(c,a,b):a.type==="widget"&&this.buildWidgetBinding(c,a,b);return true};return a}(d.framework.FrameworkObject);f.ViewBase=h})(b.ui||(b.ui={}))})(d.framework||(d.framework={}))})(geocortex||(geocortex={}));
(function(d){(function(b){(function(b){var d=function(){function b(a,c){this._activations=0;this._viewActivationTimers=[];this._viewDeactivationTimers=[];this.isActive=false;this.options=this.domElement=null;this.views=[];this.defaultTransitionDelay=10;this.app=c;this.name=a}b.prototype.host=function(a,c){this.domElement=a;this.options=c||{};c&&c.useTransitions&&c.useTransitions=="true"?(this.options.useTransitions=true,this.options.transitionDelay=c.transitionDelay&&!isNaN(c.transitionDelay)?parseInt(c.transitionDelay):
this.defaultTransitionDelay):this.options.useTransitions=false};b.prototype.unhost=function(){this.options=this.domElement=null};b.prototype.activateView=function(a){this.cancelActivate(a);if(this._activations===0&&a.isActive===false)this.isActive=true,this.app.eventRegistry.event("RegionActivatedEvent").publish(this);a.isActive===false&&++this._activations;a.activated();a.isActive=true;this.options.useTransitions?(dojo.removeClass(a.root,"inactive"),dojo.addClass(a.root,"activating"),this._viewActivationTimers[a.id]=
setTimeout(dojo.hitch(this,function(){dojo.removeClass(a.root,"inactive");dojo.removeClass(a.root,"activating");dojo.addClass(a.root,"active");delete this._viewActivationTimers[a.id]}),this.options.transitionDelay)):(dojo.removeClass(a.root,"inactive"),dojo.addClass(a.root,"active"));this.app.eventRegistry.event("ViewActivatedEvent").publish(a)};b.prototype.cancelActivate=function(a){this._viewActivationTimers[a.id]&&(clearTimeout(this._viewActivationTimers[a.id]),delete this._viewActivationTimers[a.id],
dojo.removeClass(a.root,"activating"))};b.prototype.cancelDeactivate=function(a){this._viewActivationTimers[a.id]&&(clearTimeout(this._viewActivationTimers[a.id]),delete this._viewActivationTimers[a.id],dojo.removeClass(a.root,"activating"))};b.prototype.deactivateView=function(a){this.cancelDeactivate(a);if(this._activations<=1&&a.isActive===true)this.isActive=false,this.app.eventRegistry.event("RegionDeactivatedEvent").publish(this);this.cancelActivate(a);a.isActive===true&&--this._activations;
a.deactivated();a.isActive=false;this.options.useTransitions?(dojo.removeClass(a.root,"active"),dojo.removeClass(a.root,"deactivating"),this._viewDeactivationTimers[a.id]=setTimeout(dojo.hitch(this,function(){dojo.removeClass(a.root,"active");dojo.removeClass(a.root,"deactivating");dojo.addClass(a.root,"inactive");delete this._viewDeactivationTimers[a.id]}),this.options.transitionDelay)):(dojo.removeClass(a.root,"active"),dojo.addClass(a.root,"inactive"));this.app.eventRegistry.event("ViewDeactivatedEvent").publish(a)};
b.prototype.hostView=function(a){a.added();dojo.removeClass(a.root,"active");dojo.addClass(a.root,"inactive");this.app.eventRegistry.event("ViewHostedEvent").publish({region:this,view:a})};b.prototype.unhostView=function(a){a.removed();dojo.removeClass(a.root,"active");dojo.addClass(a.root,"inactive");this.app.eventRegistry.event("ViewUnhostedEvent").publish({region:this,view:a})};return b}();b.RegionAdapterBase=d})(b.ui||(b.ui={}))})(d.framework||(d.framework={}))})(geocortex||(geocortex={}));
(function(d){(function(b){(function(f){var h=function(e){function a(c,g){e.call(this,c,g);this.activeView=null;this.activeViews=[];this._scrollTimer=this.overlayElement=this.contentElement=this.contentContainer=this.contentTitle=this.contentHeader=this.titleBindingToken=null;this._scrollDelay=50;if(a.instance)throw Error("PopupModalRegionAdapter is a singleton and has already been constructed once.");a.instance=this;if(this.app.modalRegionSingleton==null)this.app.modalRegionSingleton=this;this.app.commandRegistry.command("CloseModalRegion").register(this,
function(){this.deactivate()});this.app.eventRegistry.event("ViewActivatedEvent").subscribe(this,function(){this.activeViews.length>0&&this.positionContent()});this.app.eventRegistry.event("ViewDimensionsChangedEvent").subscribe(this,function(){this.positionContent()})}__extends(a,e);a.getInstance=function(){return a.instance};a.prototype.activate=function(){this.activeViews.length>0&&(dojo.query(this.domElement).removeClass("inactive"),dojo.query(this.domElement).addClass("active"),dojo.query(this.overlayElement).removeClass("inactive"),
dojo.query(this.overlayElement).addClass("active"));this.positionContent()};a.prototype.deactivate=function(){dojo.query(this.domElement).removeClass("active");dojo.query(this.domElement).addClass("inactive");dojo.query(this.overlayElement).removeClass("active");dojo.query(this.overlayElement).addClass("inactive");if(this.activeView)this.activeView=null};a.prototype.host=function(c){e.prototype.host.call(this,c);this.domElement=c;dojo.query(this.domElement).removeClass("active");dojo.query(this.domElement).addClass("inactive");
this.contentContainer=dojo.query(".modal-container")[0];this.contentElement=dojo.query(".modal-container-inner")[0];this.overlayElement=dojo.query(".modal-overlay")[0];var a=this;dojo.connect(window,"onresize",function(){a.handleScrollEvent()});this.app.eventRegistry.event("WorkflowFormTextInputBlurredEvent").subscribe(this,function(){setTimeout(function(){a.positionContent()},100)})};a.prototype.handleScrollEvent=function(){if(this._scrollTimer!=null)clearTimeout(this._scrollTimer),this._scrollTimer=
null;var c=this;this._scrollTimer=setTimeout(function(){c.positionContent()},0)};a.prototype.positionContent=function(){if(this.contentContainer&&this.activeView!=null&&this.activeView.root!=null){var c=dojo.position(this.contentContainer),a=dojo.window.getBox(),b=document.all?document.scrollLeft:window.pageXOffset,d=document.all?document.scrollTop:window.pageYOffset;b==void 0&&(b=0);d==void 0&&(d=0);var e=c.w;c.w>a.w?(e=a.w,dojo.style(this.contentElement,{"max-width":e+"px"})):dojo.style(this.contentElement,
{"max-width":""});var f=c.h;c.h>a.h?(f=a.h,dojo.style(this.contentElement,{"max-height":f+"px"})):dojo.style(this.contentElement,{"max-height":""});dojo.style(this.contentContainer,{left:a.w/2-e/2+b+"px",top:a.h/2-f/2+d+"px"})}};a.prototype.showActiveView=function(c){if(c.isActive)this.activeView=c,this.hideAllViews(),c.activated(),this.activate(),this.activeView=c,this.positionContent(),dojo.removeClass(c.root,"inactive"),dojo.addClass(c.root,"active")};a.prototype.hideAllViews=function(){dojo.query("> .view",
this.contentElement).removeClass("active");dojo.query("> .view",this.contentElement).addClass("inactive")};a.prototype.activateView=function(c){b.utils.ArrayUtils.contains(this.activeViews,c)&&b.utils.ArrayUtils.removeItem(this.activeViews,c);this.activeViews.push(c);e.prototype.activateView.call(this,c);this.showActiveView(c);this.positionContent();this._repositionOnImageLoaded(c.root)};a.prototype.deactivateView=function(c){b.utils.ArrayUtils.removeItem(this.activeViews,c);this.activeViews.length>
0?(this.showActiveView(this.activeViews[this.activeViews.length-1]),this.positionContent()):this.deactivate();e.prototype.deactivateView.call(this,c)};a.prototype.deactivateActiveView=function(){if(this.activeView){if(this.titleBindingToken!=null)this.activeView.title.unbind(this.titleBindingToken),this.titleBindingToken=null;var c=this.activeView;this.activeView=null;this.deactivateView(c);b.utils.ArrayUtils.removeItem(this.activeViews,this.activeView)}};a.prototype.hostView=function(c){this.views.push(c);
if(c.markupResource){var a=d.resourceManager.fetch(c.markupResource,c.libraryId);if(a==null)return this.app.trace.warning("Could not fetch markup resource '{0}' in library '{1}'.".format(c.markupResource,c.libraryId)),false;else{if(!c.bound)c.root=dojo.create("div",{className:"view"}),c.root.innerHTML=a;dojo.place(c.root,this.contentElement,"last");this.app.viewManager.discoverRegions(c.root,c);this.positionContent()}}c.viewModel&&c.attach(c.viewModel);e.prototype.hostView.call(this,c);return true};
a.prototype.unhostView=function(c){c==this.activeView&&this.deactivateView(c);b.utils.ArrayUtils.removeItem(this.views,c);b.utils.ArrayUtils.removeItem(this.activeViews,c);var a=new dojo.NodeList;a.push(c.root);a.orphan();e.prototype.unhostView.call(this,c)};a.prototype._repositionOnImageLoaded=function(c){var a=this;dojo.forEach(dojo.query("img",c),function(c){c.attached_ModalRegion_ImageLoadedConnection&&(dojo.disconnect(c.attached_ModalRegion_ImageLoadedConnection),b.utils.ArrayUtils.removeItem(c,
c.attached_ModalRegion_ImageLoadedConnection));var d=dojo.connect(c,"load",a,function(c){a._imageLoaded(c)});c.attached_ModalRegion_ImageLoadedConnection=d})};a.prototype._imageLoaded=function(c){c=c.target;c.attached_ModalRegion_ImageLoadedConnection&&(dojo.disconnect(c.attached_ModalRegion_ImageLoadedConnection),b.utils.ArrayUtils.removeItem(c,c.attached_ModalRegion_ImageLoadedConnection));this.positionContent()};a.instance=null;return a}(f.RegionAdapterBase);f.PopupModalRegionAdapter=h})(b.ui||
(b.ui={}))})(d.framework||(d.framework={}))})(geocortex||(geocortex={}));(function(d){(function(b){(function(b){var d=function(){function b(){}b.createCommands=function(a){a.commandRegistry.command("OpenWebPage").register(a,function(c){"http,https,ftp,ftps,gopher,mailto".split(",").indexOf((new dojo._Url(c)).scheme)>=0&&window.open(c,"_blank")})};return b}();b.ApplicationCommands=d})(b.application||(b.application={}))})(d.framework||(d.framework={}))})(geocortex||(geocortex={}));
(function(d){(function(b){(function(b){var h=function(){function b(){this.resources=[];this.cachedResources={};this.themesToInject=[]}b.prototype.fetch=function(a,c,b){var b=b||"inv",j="{0}-{1}-{2}".format(c,b,a);if(this.cachedResources.hasOwnProperty(j))return this.cachedResources[j];a=this.findResource(a,c,b);if(!a)return null;c=null;switch(a.format){case "css":case "html":c=d.framework.utils.base64Decode(a.data);this.cachedResources[j]=c;break;case "json":c=d.framework.utils.base64Decode(a.data);
c=dojo.fromJson(c);this.cachedResources[j]=c;break;default:return null}return c};b.prototype.fetchAllFor=function(a,c){for(var b=[],d=0;d<this.resources.length;++d){var i=this.resources[d];i.library==a&&!(c!=null&&i.format!=c)&&b.push(i)}return b};b.prototype.register=function(a,c,b,d,i){if(this.findResource(b,a)){return;throw Error("Library '{0}' attempted to re-register the resource '{1}'.".format(a,b));}var e={};e.name=b;e.library=a;e.locale=c;e.format=d;e.data=i;this.resources.push(e)};b.prototype.remove=
function(a,c,b){var d=this.findResource(c,a,b);return d!=null?(Array.removeItem(this.resources,d),a="{0}-{1}-{2}".format(a,b,c),this.cachedResources.hasOwnProperty(a)&&Array.removeItem(this.cachedResources,this.cachedResources[a]),true):false};b.prototype.injectTheme=function(a){this.themesToInject.push(a)};b.prototype.performThemeInjection=function(){for(var a=dojo.query("head")[0],c=0;c<this.themesToInject.length;++c){var b=dojo.create("link",{rel:"stylesheet",href:this.themesToInject[c]});dojo.place(b,
a,"last")}};b.prototype.findResource=function(a,c,b){for(var b=b||"inv",d=0;d<this.resources.length;++d){var i=this.resources[d];if(i.name==a&&!(c!=null&&i.library!=c)&&i.locale==b)return i}return null};return b}();b.ResourceManager=h})(b.application||(b.application={}))})(d.framework||(d.framework={}))})(geocortex||(geocortex={}));(function(d){d.resourceManager=new d.framework.application.ResourceManager})(geocortex||(geocortex={}));
(function(d){(function(b){b.applications=[];b.libraries={};b.injectedStyleBlocks=[];b.initialized=false;b.registerApplication=function(b){d.framework.applications.push(b)};b.hasLibrary=function(b){return d.framework.libraries[b]===true};b.notifyLibraryDownload=function(b){if(!d.framework.hasLibrary(b)){d.framework.libraries[b]=true;for(var h=0,e=false,a=0;a<d.framework.applications.length;++a){var c=d.framework.applications[a],g=c.getLibraryOrder(b);c.shouldOmitStylesForLibrary(b)===false&&(e=true);
if(g){h=g+a*32;break}}if(e){(a=d.resourceManager.fetchAllFor(b,"css"))||(a=[]);e="";c=dojo.query("head")[0];for(g=0;g<a.length;++g){var j=a[g];(j=d.resourceManager.fetch(j.name,j.library))&&(e+=j+" ")}a=document.createElement("style");d.framework.injectedStyleBlocks.push(a);a.setAttribute("type","text/css");dojo.attr(a,"data-block-order",h);if(h===0)dojo.place(a,c,"first");else if(g=dojo.query("head style[data-block-order]"),g.length===0)dojo.place(a,c,"first");else{for(var c=null,j=false,i=0;i<g.length;++i){var k=
g[i];if((dojo.attr(k,"data-block-order")||0)>=h){dojo.place(a,k,"before");j=true;break}else c=k}j||dojo.place(a,c,"after")}a.styleSheet?a.styleSheet.cssText=e:(h=document.createTextNode(e),a.appendChild(h))}for(a=0;a<d.framework.applications.length;++a)c=d.framework.applications[a],c.notifyLibraryDownload(b)}};b.initialize=function(){if(!d.framework.initialized)d.utils=d.framework.utils,d.framework.initialized=true}})(d.framework||(d.framework={}))})(geocortex||(geocortex={}));geocortex.framework.initialize();
(function(d){(function(b){(function(f){var h=function(){return function(a,c,b){this.impl=a;this.scope=c;this.canExecute=b}}();f.CommandRegistrationEntry=h;var e=function(){function a(c,a,d){this.app=null;this._entries={};this.name=c;this.app=a;this.isWrapper=true;this.canExecuteChanged=new b.events.Event("{0}.CanExecuteChanged".format(c));this.preExecute=new b.events.Event("{0}.PreExecute".format(c));this.postExecute=new b.events.Event("{0}.PostExecute".format(c));this.canExecuteMode=d!=null&&d!=
void 0?d:"all"}a.prototype.raiseCanExecuteChanged=function(){this.canExecuteChanged.publish()};a.prototype.canExecute=function(){for(var c=0;c<arguments.length-0;c++);if(this.isWrapper)return false;for(var a in this._entries)if(this._entries.hasOwnProperty(a))if(c=this._entries[a],c.canExecute&&c.canExecute.apply(c.scope,arguments)){if(this.canExecuteMode==="any")return true}else if(this.canExecuteMode==="all")return false;return this.canExecuteMode==="any"?false:true};a.prototype.execute=function(){for(var c=
0;c<arguments.length-0;c++);c=false;if(this._entries)for(var a in this._entries)if(this._entries.hasOwnProperty(a)){c=true;break}if(c){if(this.canExecuteMode!=="all"||this.canExecute.apply(this,arguments)){this.preExecute.publish.apply(this.preExecute,arguments);for(a in this._entries)this._entries.hasOwnProperty(a)&&(c=this._entries[a],(this.canExecuteMode!=="any"||c.canExecute.apply(c.scope,arguments))&&c.impl.apply(c.scope,arguments));this.postExecute.publish.apply(this.postExecute,arguments)}}else this.app.trace.debug("Command '{0}' executed but no implementation registered.".format(this.name))};
a.prototype.register=function(c,a,b){this.isWrapper=false;var i=d.framework.utils.alphaNumericToken(),a=new h(a,c,b||this.defaultCanExecuteFunction);this._entries[i]=a;c&&c instanceof d.framework.FrameworkObject&&c.trackCommandHandler(this,i);this.app.trace.debug("Registered an implementation for command '{0}'.".format(this.name));this.raiseCanExecuteChanged();return i};a.prototype.defaultCanExecuteFunction=function(){return true};a.prototype.unregister=function(c){this.isWrapper=false;if(!this._entries.hasOwnProperty(c))return false;
delete this._entries[c];this.app.trace.debug("Unregistered an implementation for command '{0}'.".format(this.name));this.raiseCanExecuteChanged();return true};a.prototype.clear=function(){this._entries={};this.raiseCanExecuteChanged();this.app.trace.debug("Cleared all implementations of command '{0}'.".format(this.name))};return a}();f.Command=e})(b.commands||(b.commands={}))})(d.framework||(d.framework={}))})(geocortex||(geocortex={}));
(function(d){(function(b){(function(b){var h=function(){function b(a){this.commands={};this.app=a}b.prototype.clear=function(){for(var a in this.commands)this.commands.hasOwnProperty(a)&&this.commands[a].clear()};b.prototype.command=function(a){var c=this.commands[a];return!c?(a=new d.framework.commands.Command(a,this.app),a.isWrapper=true,this.commands[a.name]=a):c};return b}();b.CommandRegistry=h})(b.commands||(b.commands={}))})(d.framework||(d.framework={}))})(geocortex||(geocortex={}));
(function(d){(function(b){(function(b){var d=function(){function b(a){this._targetConfigUri=null;this.app=a}b.prototype.loadConfigurationTree=function(a,c){function b(c){i.app.eventRegistry.event("ConfigurationLoadFailedEvent").publish(c)}this._targetConfigUri=a;var d=this,i=this;this.app.isOffline.get()===true?(a=this.app.makeAbsolute(a),this.app.store.get("__config_"+a,function(i){i?(d.app.trace.debug("Configuration found in offline storage."),c&&c(i)):(i="No offline configuration for this application was found. Configuration: {0}".format(a),
d.app.trace.error(i),b(Error(i)))},function(c){d.app.trace.error("An error occurred when fetching offline configuration. The application could not start in offline mode.");b(c)})):dojo.xhrGet({url:this._targetConfigUri,load:function(a){c!=null&&c!=void 0&&c(a)},error:function(){d.app.trace.error("Could not load configuration file.")}})};return b}();b.ConfigurationLoader=d})(b.config||(b.config={}))})(d.framework||(d.framework={}))})(geocortex||(geocortex={}));
(function(d){(function(b){(function(b){var d=function(){return function(b,a){this.locales=[];this.position=0;this.omitStyles=false;this.id=b;this.uri=a}}();b.LibraryConfig=d})(b.config||(b.config={}))})(d.framework||(d.framework={}))})(geocortex||(geocortex={}));
(function(d){(function(b){(function(b){var h=function(b){function a(c,a){b.call(this,c,a)}__extends(a,b);a.prototype.initialize=function(){};a.prototype.getResource=function(c,a){return this.app.getResource(this.libraryId,c,a)};return a}(d.framework.FrameworkObject);b.ViewModelBase=h})(b.ui||(b.ui={}))})(d.framework||(d.framework={}))})(geocortex||(geocortex={}));
(function(d){(function(b){(function(b){var d=function(){return function(b,a,c){this.viewId=b;this.moduleName=a;this.typeName=c}}();b.ViewConfig=d})(b.config||(b.config={}))})(d.framework||(d.framework={}))})(geocortex||(geocortex={}));
(function(d){(function(b){(function(b){var d=function(){return function(b,a,c){this.libraryId="";this.configuration={};this.viewModelId=b;this.moduleName=a;this.typeName=c}}();b.ViewModelConfig=d})(b.config||(b.config={}))})(d.framework||(d.framework={}))})(geocortex||(geocortex={}));
(function(d){(function(b){(function(b){var d=function(){return function(b,a,c,g){this.viewConfigs=[];this.viewModelConfigs=[];this.moduleName=b;this.moduleType=a;this.configuration=c;this.libraryId=g}}();b.ModuleConfig=d})(b.config||(b.config={}))})(d.framework||(d.framework={}))})(geocortex||(geocortex={}));
(function(d){(function(b){(function(b){var d=function(){return function(b,a){this.viewModelType=null;this.configuration={};this.markup=this.typeName="";this.id=b;this.libraryId=a}}();b.WidgetConfig=d})(b.config||(b.config={}))})(d.framework||(d.framework={}))})(geocortex||(geocortex={}));
(function(d){(function(b){(function(b){var h=function(){function b(a){this.application={};this.version="unknown";this.defaultLibraryId="";this.globals=null;this.libraryConfigs=[];this.moduleConfigs=[];this.widgetConfigs=[];this.libraryModules={};this.externalLocaleReferences=[];this.app=a}b.prototype.parse=function(a,c){var b=typeof a==="object"?a:dojo.fromJson(a),j=[],i=[],e=[];try{this.application=b.configuration.application||{},this.version=b.configuration.version||"1.0",this.defaultLibraryId=
b.configuration.defaultLibraryId||null,j=b.configuration.libraries||[],i=b.configuration.modules||[],e=b.configuration.widgets||[],this.app.trace.debug("Config version: {0}.".format(this.version))}catch(h){this.app.trace.error("Error reading configuration: {0}".format(h));return}if(j&&j.length>0)for(var f=0;f<j.length;++f){var n=j[f],n=this.app.translateConfiguration(n.id,n);if(this.defaultLibraryId==null)this.defaultLibraryId=n.id;var m=new d.framework.config.LibraryConfig(n.id,n.uri);m.position=
f;m.omitStyles=n.omitStyles||false;this.libraryConfigs.push(m);this.libraryModules[n.id]=[];if(n.locales)for(b=0;b<n.locales.length;++b){var q=n.locales[b];q.locale=q.locale.toLowerCase();if(q.hasOwnProperty("uri"))q.libraryId=n.id,m.locales.push(q),this.externalLocaleReferences.push(q)}}if(i&&i.length>0)for(b=0;b<i.length;++b){j=i[b];f=j.libraryId;if(!f)f=this.defaultLibraryId;n=new d.framework.config.ModuleConfig(j.moduleName,j.moduleType,j.configuration,f);this.libraryModules[f]?this.libraryModules[f].push(n):
this.app.trace.error("Unknown library '{0}'.".format(f));if(q=j.views)for(m=0;m<q.length;++m){var p=q[m],r=new d.framework.config.ViewConfig(p.id,j.moduleName,p.type||"geocortex.framework.ui.ViewBase");n.viewConfigs.push(r);r.libraryId=p.libraryId||f;r.viewModelId=p.viewModelId||null;r.markupResource=p.markup||null;r.configuration=p.configuration||{};r.regionName=p.region||null;r.isManaged=p.isManaged||false;r.isVisible=p.visible||false;r.title=p.title||null;r.description=p.description||"";r.iconUri=
p.iconUri||""}if(q=j.viewModels)for(m=0;m<q.length;++m)if(p=q[m],r=new d.framework.config.ViewModelConfig(p.id,j.moduleName,p.type),n.viewModelConfigs.push(r),r.libraryId=f,p.configuration)r.configuration=p.configuration;this.moduleConfigs.push(n)}if(e&&e.length>0)for(f=0;f<e.length;++f)i=new d.framework.config.WidgetConfig(e[f].id,e[f].libraryId||this.defaultLibraryId),dojo.safeMixin(i,e[f]),this.widgetConfigs.push(i);c&&c(this)};return b}();b.ConfigurationModel=h})(b.config||(b.config={}))})(d.framework||
(d.framework={}))})(geocortex||(geocortex={}));(function(d){(function(b){(function(b){var h=function(){function b(){this.events={}}b.prototype.clear=function(){for(var a in this.events)this.events.hasOwnProperty(a)&&this.events[a].clear()};b.prototype.event=function(a){var c=this.events[a];c||(c=new d.framework.events.Event(a),this.events[a]=c);return c};return b}();b.EventRegistry=h})(b.events||(b.events={}))})(d.framework||(d.framework={}))})(geocortex||(geocortex={}));
(function(d){(function(b){(function(b){var d=function(){function b(){this.numKeys=this.sizeInChars=this.capacity=b.UNKNOWN}b.UNKNOWN=-1;return b}();b.StorageStats=d})(b.storage||(b.storage={}))})(d.framework||(d.framework={}))})(geocortex||(geocortex={}));
(function(d){(function(b){(function(d){var h=function(){function d(a){this.app=a;this.keyNamespace=a.id}d.prototype.initialize=function(){};d.prototype.isSupported=function(){return false};d.prototype.isFull=function(){return false};d.prototype.getStats=function(){return new b.storage.StorageStats};d.prototype.getScore=function(){return 0};d.prototype.clear=function(){};d.prototype.clearAllData=function(){};d.prototype.get=function(){};d.prototype.set=function(){};d.prototype.remove=function(){};
return d}();d.StorageProviderBase=h})(b.storage||(b.storage={}))})(d.framework||(d.framework={}))})(geocortex||(geocortex={}));
(function(d){(function(b){(function(d){var h=function(d){function a(c){d.call(this,c);this._isInitializing=false;this._initializationErrorCallback=this._initializationSuccessCallback=null;this._defaultDesiredSize=524288E3;this._storageTypeTemporary=0;this._storageTypePersistent=1;this._error=null;this._isInitialized=this._isFull=false}__extends(a,d);a.prototype.initialize=function(c){var a=this;if(!this._isInitialized&&!this._error)if(d.prototype.initialize.call(this),this.isSupported()){if(!c&&(this.app.configuration&&
this.app.configuration.offlineStorageSpaceMb&&(c=parseInt(this.app.configuration.offlineStorageSpaceMb)*1048576),!c))c=this._defaultDesiredSize;var b=function(c){if(!a._isInitialized)a._isInitialized=true,a.app.trace.debug("Filesystem '{0}' initialized successfully.".format(c.name)),a._filesystem=c,a._error=null,a._initializationSuccessCallback(c)};!navigator.webkitPersistentStorage&&!window.webkitStorageInfo?this._requestFileSystem(LocalFileSystem.PERSISTENT,c,b,function(c){c=a._shapeError(c);a._error=
c;a._initializationErrorCallback(c)}):this._requestQuota(this._storageTypePersistent,c,function(d){this._isInitialized||(a.app.trace.debug("HTML5 File API quota granted. Size: {0} bytes.".format(d)),a._requestFileSystem(window.PERSISTENT,c,b,function(c){c=a._shapeError(c);a._error=c;a._initializationErrorCallback(c)}))},function(c){c=a._shapeError(c);a._error=c;a.app.trace.error("Error requesting filesystem quota: {0}".format(c.toString()));a._initializationErrorCallback(c)})}else this.app.trace.warning("The HTML5 storage provider could not be initialized. The File API is not supported by this browser.")};
a.prototype.isSupported=function(){return!(!window.requestFileSystem&&!window.webkitRequestFileSystem)};a.prototype.isFull=function(){return this._isFull};a.prototype.getScore=function(){this.initialize();return 5};a.prototype.getStats=function(){this.initialize();return new b.storage.StorageStats};a.prototype._ensureInitializedThen=function(c){var a=null;if(this._isInitialized)c.apply(this,[]);else if(this._isInitializing)a=dojo.connect(this,"_initializationSuccessCallback",function(){dojo.disconnect(a);
c.apply(b,[])});else{var b=this;this._isInitializing=true;a=dojo.connect(this,"_initializationSuccessCallback",function(){dojo.disconnect(a);c.apply(b,[])});this.initialize()}};a.prototype._silentlyEnsureInitializeThen=function(c,a){var b=this;this._isInitialized||this._isInitializing||!navigator.webkitPersistentStorage&&!window.webkitStorageInfo?b._ensureInitializedThen(c):this._queryUsageAndQuota(this._storageTypePersistent,function(d,e){d==0&&e==0?a():b._ensureInitializedThen(c)},function(c){c=
b._shapeError(c);b.app.trace.warning("An error occurred while trying to fetch file API usage information: {0}".format(c.toString()))})};a.prototype._requestFileSystem=function(c,a,b,d){if(window.requestFileSystem)window.requestFileSystem(c,a,b,d);else if(window.webkitRequestFileSystem)window.webkitRequestFileSystem(c,a,b,d);else throw Error("No request filesystem method found");};a.prototype._requestQuota=function(c,a,b,d){var e=navigator,f=window;switch(c){case this._storageTypeTemporary:e.webkitTemporaryStorage&&
e.webkitTemporaryStorage.requestQuota?e.webkitTemporaryStorage.requestQuota(a,b,d):f.webkitStorageInfo&&f.webkitStorageInfo.requestQuota&&f.webkitStorageInfo.requestQuota(window.TEMPORARY,a,b,d);break;case this._storageTypePersistent:e.webkitPersistentStorage&&e.webkitPersistentStorage.requestQuota?e.webkitPersistentStorage.requestQuota(a,b,d):f.webkitStorageInfo&&f.webkitStorageInfo.requestQuota&&f.webkitStorageInfo.requestQuota(window.PERSISTENT,a,b,d)}};a.prototype._queryUsageAndQuota=function(c,
a,b){var d=navigator,e=window;switch(c){case this._storageTypeTemporary:d.webkitTemporaryStorage&&d.webkitTemporaryStorage.queryUsageAndQuota?d.webkitTemporaryStorage.queryUsageAndQuota(a,b):e.webkitStorageInfo&&e.webkitStorageInfo.queryUsageAndQuota&&e.webkitStorageInfo.queryUsageAndQuota(window.TEMPORARY,a,b);break;case this._storageTypePersistent:d.webkitPersistentStorage&&d.webkitPersistentStorage.queryUsageAndQuota?d.webkitPersistentStorage.queryUsageAndQuota(a,b):e.webkitStorageInfo&&e.webkitStorageInfo.queryUsageAndQuota&&
e.webkitStorageInfo.queryUsageAndQuota(window.PERSISTENT,a,b)}};a.prototype._writeValue=function(c,a,b,d,e){function f(c){c=m._shapeError(c);d&&d(c)}function h(a){e?m._filesystem.root.getFile(c+".json",{create:true,exclusive:false},a,f):m._filesystem.root.getDirectory(q+"/",{create:true,exclusive:false},function(){m._filesystem.root.getFile(q+"/"+c+".json",{create:true,exclusive:false},a,f)},f)}function n(c){c.createWriter(function(c){c.truncate(0)});c.createWriter(function(c){c.onwriteend=function(c){m.app.trace.debug("Wrote {0} bytes to filesystem.".format(c.total))};
c.onerror=function(c){c=m._shapeError(c);m.app.trace.debug("Write failed: {0}".format(c));d&&d(c)};var e=false;try{var k=false;typeof device!=="undefined"&&device.cordova&&(c.write(a),k=true);if(!k&&typeof Blob!=="undefined")try{var h=new Blob([a],{type:"text/plain"});c.write(h);k=true}catch(l){m.app.trace.debug('Failed to create blob "'+l+'". Falling back to BlobBuilder.')}if(!k){k=null;typeof BlobBuilder!=="undefined"?k=new BlobBuilder:typeof WebKitBlobBuilder!=="undefined"?k=new WebKitBlobBuilder:
typeof MSBlobBuilder!=="undefined"&&(k=new MSBlobBuilder);if(!k)throw Error("Error writing to File API file: No BlobBuilder implementation found.");k.append(a);c.write(k.getBlob("text/plain"))}}catch(n){e=true,f(n)}e||b()})}var m=this,q=e?"":this.keyNamespace;try{h(n)}catch(p){f(p)}};a.prototype._readValue=function(c,a,b,d){function e(c){c.code&&c.code===FileError.NOT_FOUND_ERR?a(null):(c=f._shapeError(c),b&&b(c))}var f=this;f._filesystem.root.getFile((d?"":this.keyNamespace+"/")+c+".json",{},function(c){c.file(function(c){var b=
new FileReader;b.onloadend=function(){a(this.result)};try{b.readAsText(c)}catch(d){e(d)}},e)},e)};a.prototype._shapeError=function(c){var a="";if(c.hasOwnProperty("code")){switch(c.code){case FileError.QUOTA_EXCEEDED_ERR:a="Quota Exceeded.";break;case FileError.NOT_FOUND_ERR:a="File not found.";break;case FileError.SECURITY_ERR:a="Security error.";break;case FileError.INVALID_MODIFICATION_ERR:a="Invalid modification.";break;case FileError.INVALID_STATE_ERR:a="Invalid state.";break;default:a="Unknown Error."}c=
Error("File error: {0}.".format(a))}return c};a.prototype.clear=function(c,a){function b(c){a&&(c=d._shapeError(c),a(c))}var d=this;this._silentlyEnsureInitializeThen(function(){d._filesystem.root.getDirectory(this.keyNamespace+"/",{create:false},function(a){a.removeRecursively(function(){c&&c()},b)},function(a){a.code===FileError.NOT_FOUND_ERR?c():b(a)})},c)};a.prototype.clearAllData=function(c,a){var b=this;this._silentlyEnsureInitializeThen(function(){try{var d=b._filesystem.root.createReader(),
e=[],f=0,h=0,n=new dojo.Deferred,m=new dojo.Deferred,q=new dojo.DeferredList([n,m]);q.then(function(){h?a&&a(Error("{0} errors were encountered while clearing the storage provider.".format(h))):c&&c()});q.addErrback(function(c){a&&(c=b._shapeError(c),a(c))});var p=function(){var c=function(){--f;f<=0&&(n.resolve(),m.resolve())},a=function(c){c=b._shapeError(c);b.app.trace.warning("Error removing local file: {0}.".format(c.toString()));--f;++h;f<=0&&n.resolve()},g=function(b){b.remove(c,a)},d=function(c){c=
b._shapeError(c);b.app.trace.warning("Could not obtain file for removal: {0}.".format(c.toString()));m.errback(c)};f=e.length;if(f===0)n.resolve(),m.resolve();else if(e.length===0)n.resolve(),m.resolve();else for(var i=0;i<e.length;++i)try{b._filesystem.root.getFile(e[i],{},g,d)}catch(p){p=b._shapeError(p),q.errback(p)}},r=function(){},v=function(c){c=b._shapeError(c);b.app.trace.warning("Error removing local folder: {0}.".format(c.toString()));++h;m.resolve()},x=function(){d.readEntries(function(c){if(c.length){for(var a=
0;a<c.length;++a){var b=c[a];b.isDirectory?b.removeRecursively(r,v):e.push(b.fullPath)}x()}else p()},function(c){c=b._shapeError(c);a&&a(c)})};x()}catch(u){u=b._shapeError(u),a&&a(u)}},c)};a.prototype.get=function(c,a,b,d){var e=this;this._silentlyEnsureInitializeThen(function(){try{e._readValue(c,a,b,d)}catch(f){f=e._shapeError(f),b&&b(f)}},function(){a(null)})};a.prototype.set=function(c,a,b,d,e){var f=this;this._ensureInitializedThen(function(){try{f._writeValue(c,a,b,d,e)}catch(h){h=f._shapeError(h),
d&&d(h)}})};a.prototype.remove=function(c,a,b,d){var e=this,f=d?"":this.keyNamespace;this._ensureInitializedThen(function(){try{e._filesystem.root.getFile(f+"/"+c+".json",{create:false},function(c){c.remove(a,function(c){c=e._shapeError(c);b&&b(c)})},function(c){c=e._shapeError(c);e.app.trace.debug("Could not obtain file for removal: {0}.".format(c.toString()));b&&b(c)})}catch(d){d=e._shapeError(d),b&&b(d)}})};return a}(b.storage.StorageProviderBase);d.FileStorageProvider=h})(b.storage||(b.storage=
{}))})(d.framework||(d.framework={}))})(geocortex||(geocortex={}));
(function(d){(function(b){(function(d){var h=function(d){function a(c){d.call(this,c);this._isFull=false}__extends(a,d);a.prototype.initialize=function(){d.prototype.initialize.call(this);this._localStorage=window.localStorage};a.prototype.isSupported=function(){this._localStorage||this.initialize();return!!this._localStorage};a.prototype.isFull=function(){this._localStorage||this.initialize();return this._isFull};a.prototype.getScore=function(){this._localStorage||this.initialize();return 5};a.prototype.getStats=
function(){this._localStorage||this.initialize();return new b.storage.StorageStats};a.prototype.clear=function(c,b){this._localStorage||this.initialize();for(var d=null,i=RegExp("^"+this.keyNamespace+a._namespaceSeperator),e=0,f=this._localStorage.length;e<f;e++){var h=this._localStorage.key(e);if(i.test(h))try{this._localStorage.removeItem(h),e--,f--}catch(n){d=n}}d!=null?b&&b(d):c&&c()};a.prototype.clearAllData=function(c,a){this._localStorage||this.initialize();try{this._localStorage.clear(),c&&
c()}catch(b){a&&a(b)}};a.prototype.get=function(c,b,d,e){c=e?c:"{0}{1}{2}".format(this.keyNamespace,a._namespaceSeperator,c);this._localStorage||this.initialize();try{var f=this._localStorage.getItem(c);b&&b(f)}catch(h){d&&d(h)}};a.prototype.set=function(c,b,d,e,f){c=f?c:"{0}{1}{2}".format(this.keyNamespace,a._namespaceSeperator,c);this._localStorage||this.initialize();try{this._localStorage.setItem(c,b),d&&d()}catch(h){e&&e(h)}};a.prototype.remove=function(c,b,d,e){c=e?c:"{0}{1}{2}".format(this.keyNamespace,
a._namespaceSeperator,c);this._localStorage||this.initialize();try{this._localStorage.removeItem(c),b&&b()}catch(f){d&&d(f)}};a._namespaceSeperator="\u2192";return a}(b.storage.StorageProviderBase);d.LocalStorageProvider=h})(b.storage||(b.storage={}))})(d.framework||(d.framework={}))})(geocortex||(geocortex={}));
(function(d){(function(b){(function(d){var h=function(){function d(a,c){this.app=a;this._rootNamespace=this._sanitizeKey(c?c.toString():"framework."+this.app.id)}d.prototype.initialize=function(a){a?this._provider=a:(a=new b.storage.FileStorageProvider(this.app),this._provider=a.isSupported()?a:new b.storage.LocalStorageProvider(this.app));this._provider.keyNamespace=this._rootNamespace};d.prototype.hasProvider=function(){return this._provider!=null};d.prototype._yield=function(a){return!a?function(){}:
function(){var c=arguments;setTimeout(function(){a.apply(this,c)},0)}};d.prototype._yieldError=function(a){return!a?function(){}:function(){var c=arguments;setTimeout(function(){a.apply(this,c)},0)}};d.prototype._yieldGet=function(a){return!a?function(){}:function(){var c=arguments;setTimeout(function(){a.apply(this,c)},0)}};d.prototype.clear=function(a,c){this._provider&&this._provider.clear(this._yield(a),this._yieldError(c))};d.prototype.clearAllData=function(a,c){this._provider&&this._provider.clearAllData(this._yield(a),
this._yieldError(c))};d.prototype._sanitizeKey=function(a){return a.replace(RegExp("[/\\\\:,?=]","gm"),"_")};d.prototype.set=function(a,c,b,d,e){var f=new dojo.Deferred,h=this._sanitizeKey(a);this._provider&&this._provider.set(h,c,this._yield(function(){f&&f.fired==-1&&f.resolve(c);b&&b(a,c)}),this._yieldError(function(b){f&&f.fired==-1&&f.resolve(b);d&&d(b,a,c)}),e||false);return f};d.prototype.get=function(a,c,b,d){var e=new dojo.Deferred,f=this._sanitizeKey(a);this._provider&&this._provider.get(f,
this._yieldGet(function(b){e&&e.fired==-1&&e.resolve(b);c&&c(b,a)}),this._yieldError(function(c){e&&e.fired==-1&&e.resolve(c);b&&b(c,a)}),d||false);return e};d.prototype.remove=function(a,c,b,d){var e=new dojo.Deferred,f=this._sanitizeKey(a);this._provider&&this._provider.remove(f,this._yield(function(){e&&e.fired==-1&&e.resolve(a);c&&c(a)}),this._yieldError(function(c){e&&e.fired==-1&&e.resolve(c);b&&b(c,a)}),d||false);return e};return d}();d.Store=h})(b.storage||(b.storage={}))})(d.framework||(d.framework=
{}))})(geocortex||(geocortex={}));(function(d){(function(b){(function(b){var d=function(){return function(b,a){this.view=b;this.region=a}}();b.ViewDimensionsChangedArgs=d})(b.events||(b.events={}))})(d.framework||(d.framework={}))})(geocortex||(geocortex={}));
(function(d){(function(b){(function(f){var h=function(){return function(){}}();f.ViewManagerRegionEntry=h;var e=function(){function a(c){this._views=[];this._hostedRegions=[];this._pendingRegions=[];this.app=c;this._registerCommands()}a.prototype.shutdown=function(){for(var c=0;c<this._hostedRegions.length;++c)this.destroyRegion(this._hostedRegions[c]);for(var a=this._hostedRegions.length=0;a<this._views.length;++a)this.destroyView(this._views[a]);for(c=this._views.length=0;c<this._pendingRegions.length;++c){for(var b=
this._pendingRegions[c],a=0;a<b.views.length;++a)this.destroyView(b.views[a]);b.views=[]}this._pendingRegions.length=0};a.prototype._registerCommands=function(){this.app.commandRegistry.command("ActivateView").register(this,function(c){var a=this.getViewById(c);a?this.activateView(a):this.app.trace.warning("ActivateView: Could not find view '{0}'.".format(c))});this.app.commandRegistry.command("DeactivateView").register(this,function(c){var a=this.getViewById(c);a?this.deactivateView(a):this.app.trace.warning("DeactivateView: Could not find view '{0}'.".format(c))});
this.app.commandRegistry.command("ToggleView").register(this,function(c){var a=this.getViewById(c);a?this.toggleView(a):this.app.trace.warning("ToggleView: Could not find view '{0}'.".format(c))});this.app.commandRegistry.command("DestroyView").register(this,function(c){var a=this.getViewById(c);a?this.destroyView(a):this.app.trace.warning("DestroyView: Could not find view '{0}'.".format(c))})};a.prototype.activateView=function(c){if(!c.id)return this.app.trace.error("ViewManager: Invalid or nonexistent view passed to activateView."),
false;var a=this.getRegionForViewId(c.id);if(!a){if(!c.regionName)return this.app.trace.warning("Could not activate view '{0}' - view is not associated with a region.".format(c.id)),false;if(a=this.getExistingRegionByName(c.regionName))return a.hostView(c),a.activateView(c),true;else(a=this._getPendingRegionEntryByName(c.regionName))?b.utils.ArrayUtils.contains(a.views,c)?this.app.trace.debug("View '{0}' re-added to pending region '{1}'.".format(c.id,c.regionName)):a.views.push(c):(a=new h,a.name=
c.regionName,a.views=[c],this._pendingRegions.push(a));return false}a.activateView(c);return true};a.prototype.deactivateView=function(c){if(!c.id)return this.app.trace.error("ViewManager: Invalid or nonexistent view passed to deactivateView."),false;var a=this.getRegionForViewId(c.id);if(!a)return this.app.trace.debug("Could not find region for view '{0}'.".format(c.id)),false;a.deactivateView(c);return true};a.prototype.toggleView=function(c){c.isActive?this.deactivateView(c):this.activateView(c)};
a.prototype.createView=function(c){var a=c.viewId||c.id;if(a&&this.getViewById(a))this.app.trace.error("Could not create view '{0}' - a view with that ID already exists.".format(a));else{var e=c.typeName||c.type||"geocortex.framework.ui.ViewBase",i=null;try{i=this.app.instantiateFrameworkObject(e,c.libraryId)}catch(f){return this.app.trace.error("Could not instantiate view with type '{0}' - type was not found or view constructor failed.".format(e)),null}e=c.isVisible||c.visible;i.id=a==null?"View-"+
d.framework.utils.alphaNumericToken():a;i.markupResource=c.markupResource||c.markup;i.regionName=c.regionName||c.region;i.configuration=c.configuration||{};i.isManaged=c.isManaged||false;i.title.set(c.title||"");i.description.set(c.description);i.iconUri.set(c.iconUri);if(c.viewModel)i.viewModel=c.viewModel;this._views.push(i);if(i.regionName)(c=this.getExistingRegionByName(i.regionName))?(c.hostView(i),e&&c.activateView(i)):(e&&(i.___shouldActivate=true),(c=this._getPendingRegionEntryByName(i.regionName))?
b.utils.ArrayUtils.contains(c.views,i)?this.app.trace.debug("View '{0}' re-added to pending region '{1}'.".format(i.id,i.regionName)):c.views.push(i):(c=new h,c.name=i.regionName,c.views=[i],this._pendingRegions.push(c)));else if(c=d.resourceManager.fetch(i.markupResource,i.libraryId),c==null)return this.app.trace.warning("Could not fetch markup resource '{0}' in library '{1}'.".format(i.markupResource,i.libraryId)),null;else if(i.root=dojo.create("div"),i.root.innerHTML=c,i.root.children&&i.root.children.length===
1)i.root=i.root.children[0];return i}};a.prototype.create=function(c,a,b,e){c=new d.framework.config.ViewConfig(null,null,c);c.markupResource=b;c.regionName=e;c.configuration={};b=this.createView(c);if(b===null)return b;var f;try{f=this.app.instantiateFrameworkObject(a||"geocortex.framework.ui.ViewModelBase",null.libraryId),f.initialize({})}catch(h){return this.app.trace.error("Could not create view model with type '{0}' - type was not found, not a view model, or failed to construct: {1}".format(c.typeName,
h.message)),null}b.attach(f);this.activateView(b);return b};a.prototype.destroyView=function(c){for(var a=this.getRegionForViewId(c.id),d=window.document.activeElement;d;){if(c.root===d){window.document.activeElement.blur();break}d=d.parentElement}a!=null&&(a.deactivateView(c),a.unhostView(c));c.destroy();if(c.childRegions!=null)for(a=0;a<c.childRegions.length;++a)this.destroyRegion(c.childRegions[a]);c.childRegions.length=0;c.root!=null&&(a=new dojo.NodeList,a.push(c.root),a.orphan());b.utils.ArrayUtils.removeItem(this._views,
c)};a.prototype.destroyRegion=function(c){if(c.views!=null)for(var a=c.views.length-1;a>=0;a--)this.destroyView(c.views[a]);b.utils.ArrayUtils.removeItem(this._hostedRegions,c);c.unhost()};a.prototype.discoverRegions=function(c,a){var b=this;c!=null&&dojo.query("[data-region-name]",c).forEach(function(c){var d=dojo.attr(c,"data-region-name");if(b.getExistingRegionByName(d))b.app.trace.error("Region '{0}' already exists.".format(d));else{var e=b._getPendingRegionEntryByName(d),f=null;e&&b._removePendingRegionEntry(d);
var h=dojo.attr(c,"data-region-adapter"),m=null;try{h||(h="geocortex.framework.ui.DivRegionAdapter"),m=dojo.getObject(h,true),f=new m(d,b.app)}catch(q){return b.app.trace.error("Could not instantiate region with type '{0}' - type was not found.".format(h)),null}h=dojo.attr(c,"data-region-options");d={};if(h){h=h.split(",");for(m=0;m<h.length;m++){var p=h[m].split("=");d[p[0]]=p.length>1?p[1]:""}}f.host(c,d);b._hostedRegions.push(f);a!=null&&a.childRegions.push(f);if(e)for(c=0;c<e.views.length;++c)d=
e.views[c],b._views.push(d),f.hostView(d),d.___shouldActivate&&(delete d.___shouldActivate,f.activateView(d))}})};a.prototype.getExistingRegionByName=function(c){for(var a=0;a<this._hostedRegions.length;++a){var b=this._hostedRegions[a];if(b.name==c)return b}return null};a.prototype._getPendingRegionEntryByName=function(c){for(var a=0;a<this._pendingRegions.length;++a){var b=this._pendingRegions[a];if(b.name==c)return b}return null};a.prototype._removePendingRegionEntry=function(c){for(var a=-1,d=
0;d<this._pendingRegions.length;++d)if(this._pendingRegions[d].name==c){a=d;break}return d>-1?(b.utils.ArrayUtils.remove(this._pendingRegions,a,a),true):false};a.prototype.getRegionForViewId=function(c){for(var a=0;a<this._hostedRegions.length;++a)for(var b=this._hostedRegions[a],d=0;d<b.views.length;++d)if(b.views[d].id===c)return b;return null};a.prototype.getViewById=function(c){for(var a=0;a<this._views.length;++a){var b=this._views[a];if(b.id&&b.id===c)return b}};a.prototype.getViews=function(){return this._views};
a.prototype.notifyDimensionsChanged=function(c){var a=this.getRegionForViewId(c.id),c=new d.framework.events.ViewDimensionsChangedArgs(c,a);this.app.eventRegistry.event("ViewDimensionsChangedEvent").publish(c)};return a}();f.ViewManager=e})(b.ui||(b.ui={}))})(d.framework||(d.framework={}))})(geocortex||(geocortex={}));
(function(d){(function(b){(function(b){var d=function(){function b(a){this.app=a}b.prototype._traceImpl=function(a,c){(!(a==="debug"||a==="trace")||this.app.debugMode)&&this.app&&this.app.eventRegistry.event("TraceEvent").publish({level:a,timestamp:new Date,message:c})};b.prototype.debug=function(a){this._traceImpl("debug",a)};b.prototype.trace=function(a){this._traceImpl("trace",a)};b.prototype.info=function(a){this._traceImpl("info",a)};b.prototype.alert=function(a){this._traceImpl("alert",a)};
b.prototype.warning=function(a){this._traceImpl("warning",a)};b.prototype.error=function(a){this._traceImpl("error",a)};b.prototype.exception=function(a){this._traceImpl("error",a)};return b}();b.Trace=d})(b.utils||(b.utils={}))})(d.framework||(d.framework={}))})(geocortex||(geocortex={}));
(function(d){(function(b){(function(d){var h=function(b){function a(c,a){b.call(this,c,a);this.configuration={}}__extends(a,b);a.prototype.initialize=function(a){this.configuration=a};a.prototype.shutdown=function(){};return a}(b.FrameworkObject);d.ModuleBase=h})(b.application||(b.application={}))})(d.framework||(d.framework={}))})(geocortex||(geocortex={}));
(function(d){(function(b){(function(b){var d=function(){function b(a){this._modules={};this.app=a}b.prototype.shutdown=function(a){for(var c in this._modules)this._modules.hasOwnProperty(c)&&(this._modules[c].shutdown(a),this._modules[c].destroy());this._modules={}};b.prototype.instantiate=function(a,c){return a==null?null:this.app.instantiateFrameworkObject(a,c)};b.prototype.markModuleLoaded=function(a,c){this._modules[a]=c;this.app.eventRegistry.event("ModuleInitializedEvent").publish(a)};b.prototype.moduleIsLoaded=
function(a){return this._modules[a]!=null};b.prototype.notifyModuleLoaded=function(a,c){if(this.moduleIsLoaded(a)&&c!=null)c(a);else var b=this.app.eventRegistry.event("ModuleInitializedEvent").subscribe(this,function(d){if(d==a)try{c(d)}finally{this.app.eventRegistry.event("ModuleInitializedEvent").unsubscribe(b)}})};return b}();b.ModuleManager=d})(b.application||(b.application={}))})(d.framework||(d.framework={}))})(geocortex||(geocortex={}));
(function(d){(function(b){(function(f){var h=function(){function e(a,c,g,e){this.version="1.3";this.allowCrossDomainConfig=false;this.configuration={};this.urlParameters={};this.allLibrariesLoaded=this.isHttpsMode=this.developmentMode=false;this.configPreprocessor=null;this.eventRegistry=new d.framework.events.EventRegistry;this._resourceDictionaries={};this.frameworkObjects={};this.modalRegionSingleton=null;this.id=g||"default";this.configTokens=e||{};this.trace=new b.utils.Trace(this);this.moduleManager=
new d.framework.application.ModuleManager(this);this.commandRegistry=new d.framework.commands.CommandRegistry(this);this.viewManager=new d.framework.ui.ViewManager(this);this.hostElement=c||dojo.body();this.store=new d.framework.storage.Store(this,this.id);this.store.initialize();typeof a==="object"?(this.configObject=a,this.configUri=null):(this.configModel=null,this.configUri=a.trim());this.isOffline=new Observable(false);this.isOffline.bind(this,function(a){a?this.eventRegistry.event("ApplicationOfflineEvent").publish():
this.eventRegistry.event("ApplicationOnlineEvent").publish()});this.isNative=new Observable(false);this.isNative.bind(this,function(a){a?this.eventRegistry.event("ApplicationNativeReadyEvent").publish():this.eventRegistry.event("ApplicationNativeRemovedEvent").publish()});d.framework.application.ApplicationCommands.createCommands(this);a=document.URL;a=a.substring(a.indexOf("?")+1,a.length);this.urlParameters=dojo.queryToObject(a)||{};a=window.location.protocol;a.indexOf(":")<0&&(a+=":");c=window.location.pathname.lastIndexOf("/");
g="/";c>-1&&(g=window.location.pathname.substr(0,c));g===""&&(g="/");this.host=a+"//"+window.location.host.trim()+g.trim();this.host.charAt(this.host.length-1)!=="/"&&(this.host+="/");this.isHttpsMode=this.isHttpsUri(this.host);this.detectBrowserLocale();d.framework.registerApplication(this)}e.prototype.getLibraryOrder=function(a){if(!this.configModel.libraryConfigs)return null;for(var c=0;c<this.configModel.libraryConfigs.length;++c)if(this.configModel.libraryConfigs[c].id===a)return c;return null};
e.prototype.shouldOmitStylesForLibrary=function(a){if(!this.configModel.libraryConfigs)return null;for(var c=0;c<this.configModel.libraryConfigs.length;++c){var b=this.configModel.libraryConfigs[c];if(b.id===a)return!!b.omitStyles}return false};e.prototype.translateConfiguration=function(a,c){var b=this,d=function(c,e){if(typeof e==="string")if(e.indexOf("@language")>-1){var i=e.split("-");if(i.length<2)throw Error("Invalid language key '{0}'.".format(e));i=i.join("-").replace("@","");return b.getResource(a,
i)}else{if(typeof e==="string")return b.performTokenReplacement(e)}else if(e instanceof Array){for(var f=[],h=0;h<e.length;++h)i={},i=d(h,e[h]),f.push(i);return f}else if(e instanceof Function)return e;else if(e instanceof Object){i={};for(f in e)e.hasOwnProperty(f)&&(i[f]=d(f,e[f]));return i}else return e},e={},f;for(f in c)c.hasOwnProperty(f)&&(e[f]=d(f,c[f]));return e};e.prototype.performTokenReplacement=function(a){if(!a)return a;var c=this;return a.replace(/{.+?}/g,function(a){var b=a.substring(1,
a.length-1),a=c.configTokens.hasOwnProperty(b)?c.configTokens[b]:a;return!a&&c.configuration&&c.configuration.hasOwnProperty(b)?c.configuration[b]:a?a:(c.trace.warning("The token syntax \\{{0}\\} was detected, but could not be matched to a valid replacement.".format(b)),"")})};e.prototype.isHttpsUri=function(a){a=a.trim();return a.indexOf("://")>-1&&a.length>=5&&a.substring(0,5)==="https"};e.prototype.makeAbsolute=function(a,c){if(!(new dojo._Url(a)).host){var b=c?c:"{0}//{1}{2}".format(window.location.protocol,
window.location.host,window.location.pathname);if(b.charAt(b.length-1)!="/"||b.charAt(b.length-1)!="\\")b=b.split("/"),--b.length,b=b.join("/"),b+="/";if(a.charAt(0)=="/"||a.charAt(0)=="\\")a=window.location.protocol+"//"+window.location.host+"/"+a.substring(1);else{for(var d=b.split("/"),b=a?a.split("../"):[],e=0,f=0;f<b.length;++f)b[f]==""&&++e;d=d.slice(0,d.length-(e>0?e+1:e));b=b.slice(e>0?e-1:e);a=d.join("/")+b.join("/")}}return a};e.prototype.getResource=function(a,c,b){b=b||this.locale||"inv";
b=b.toLowerCase();if(!this._resourceDictionaries||!this._resourceDictionaries.inv)throw Error("The application is missing its invariant resources.");var d=this._resourceDictionaries[b],e=this._resourceDictionaries.inv;d||(d=e);var f=d[a]||e[a];if(!f)return this.trace.warning("No resource dictionary found for library '{0}' while trying to get resource with key '{1}', using locale '{2}'.".format(a,c,b)),"@{0}".format(c);if(f.hasOwnProperty(c)===false)if(d===e)return"@{0}".format(c);else if(f=e[a],f.hasOwnProperty(c)===
false)return this.trace.warning("The resource with key '{0}' was not found in library '{1}'.".format(c,a)),"@{0}".format(c);return f[c]};e.prototype.getUri=function(a){var c=false;return(c=a.indexOf("://")<0)?(a=this.host+a,this.isHttpsUri(a)!=this.isHttpsMode&&this.trace.warning("Mixing secured and non-secured resources. Request: '{0}'.".format(a)),this.proxyUri!=null&&!String.isNullOrEmpty(this.proxyUri)?this.proxyUri+encodeURIComponent(a):a):(this.isHttpsUri(a)!=this.isHttpsMode&&this.trace.warning("Mixing secured and non-secured resources. Request: '{0}'.".format(a)),
this.proxyUri+encodeURIComponent(a))};e.prototype.onLibrariesDownloaded=function(){};e.prototype.onConfigurationLoaded=function(){};e.prototype.notifyLibraryDownload=function(a){this.trace.info("Processing downloaded library '{0}' for application '{1}'.".format(a,this.id));this.eventRegistry.event("LibraryDownloadedEvent").publish(a);var c=d.resourceManager.fetchAllFor(a,"json");if(c&&c.length>0)for(var b=0;b<c.length;++b){var e=c[b],f=d.resourceManager.fetch(e.name,e.library,e.locale);this.injectLibraryResources(a,
f,e.locale)}if(this.configModel)if(c=this.configModel.libraryModules[a],c==null)this.trace.warning("No modules found for library '{0}' in application '{1}'.".format(a,this.id));else if(this.initializeModules(c),this.pendingLibraryDownloads>0&&--this.pendingLibraryDownloads,this.pendingLibraryDownloads===0)d.resourceManager&&d.resourceManager.performThemeInjection(),this.allLibrariesLoaded=true,this.eventRegistry.event("ViewerLibrariesDownloadedEvent").publish(this),this.onLibrariesDownloaded(this)};
e.prototype.registerFrameworkObject=function(a){if(!a.id)throw Error("Could not register framework object. Object was missing an ID.");return this.frameworkObjects[a.id]=a};e.prototype.freeAllFrameworkObjects=function(){};e.prototype.getFrameworkObjectById=function(a){for(var c in this.frameworkObjects)if(this.frameworkObjects.hasOwnProperty(c)&&c===a)return this.frameworkObjects[c];return null};e.prototype.initialize=function(){var a=this;dojo.connect(window,"onresize",function(){a.eventRegistry.event("ApplicationResizedEvent").publish()});
var c=new d.framework.config.ConfigurationLoader(this),b=function(c){typeof c=="string"&&(c=dojo.fromJson(c));if(a.configPreprocessor)a.configPreprocessor(c),a.configPreprocessor=null;var b=new d.framework.config.ConfigurationModel(a);a.onConfigurationLoaded(c);a.abortInitialization||b.parse(c,function(c){a.processConfiguration(c)})};if(this.configModel!=null)throw Error("Configuration model should not be loaded already");else if(this.configObject!=null)b(this.configObject),this.configObject=null;
else if(this.configUri!=null)c.loadConfigurationTree(this.configUri,function(a){b(a)});else throw Error("No configuration method");this.viewManager.discoverRegions(this.hostElement)};e.prototype.shutdown=function(a){this.eventRegistry.event("ApplicationShutdownEvent").publish(a);this.viewManager.shutdown();this.moduleManager.shutdown(a);this.commandRegistry.clear();this.eventRegistry.clear()};e.prototype.onInitializationComplete=function(){this.initializationCompleteCallback!=null&&this.initializationCompleteCallback!=
void 0&&this.initializationCompleteCallback(this)};e.prototype.detectBrowserLocale=function(){this.locale=navigator.language?navigator.language:navigator.userLanguage?navigator.userLanguage:navigator.browserLanguage?navigator.browserLanguage:"inv"};e.prototype.downloadLibraries=function(a){this.pendingLibraryDownloads=a.libraryConfigs.length;for(var c=0;c<a.libraryConfigs.length;++c){var b=a.libraryConfigs[c];d.framework.hasLibrary(b.id)===true?this.notifyLibraryDownload(b.id):(d.framework.libraries[b.id]=
false,this.includeScript(b.uri,function(){},function(){}))}};e.prototype.injectLibraryResources=function(a,c,b){b=b.toLowerCase();this._resourceDictionaries.hasOwnProperty(b)===false?(this._resourceDictionaries[b]={},this._resourceDictionaries[b][a]=c):this._resourceDictionaries[b].hasOwnProperty(a)===false?this._resourceDictionaries[b][a]=c:dojo.mixin(this._resourceDictionaries[b][a],c)};e.prototype.instantiateFrameworkObject=function(a,c){for(var b=a.split("."),d=window,e=0;e<b.length&&typeof d===
"object";e++)d=d[b[e]];b=null;typeof d==="function"&&(b=new d(this,c));b||(b=new (dojo.getObject(a))(this,c));return b};e.prototype._loadScriptRemote=function(a,c,b){var d=this.trace;dojo.io.script.get({url:a,callbackParamName:"callback",preventCache:this.debugMode,load:function(b){try{c&&c(b)}catch(e){d.error("Error while including script '{0}': {1}".format(a,e))}},error:function(c){d.error("Error while including script '{0}': {1}".format(a,c));b&&b(c)}})};e.prototype.includeScript=function(a){var c=
this;if(this.isOffline.get()===false||this.urlParameters.hasOwnProperty("ffl"))this._loadScriptRemote(a);else{var b="__lib_{0}".format(a);c.trace.debug("Attempting to load '{0}' from offline storage".format(b));this.store.get(b,function(e){if(e){c.trace.debug("Library '{0}' found in offline storage. Loading...".format(a));e=d.framework.utils.base64Decode(e);try{eval.apply(window,[e])}catch(f){c.trace.error("An error in a library file occurred: {0}".format(f))}c.trace.debug("Library '{0}' loaded.".format(a))}else c.trace.debug("Library '{0}' not found in offline storage. Loading over HTTP...".format(b)),
c._loadScriptRemote(a)},function(b){c.trace.error("An error occurred loading library '{0}' from offline storage: {1}".format(a,b))})}};e.prototype.processConfiguration=function(a){this.configuration=a.application||{};this.configModel=a;this.eventRegistry.event("AppConfigLoaded").publish(this.configModel);if(this.configuration&&this.configuration.locale)this.locale=this.configuration.locale;if(this.urlParameters&&this.urlParameters.locale)this.locale=this.urlParameters.locale;this.pendingLocaleDownloads=
a.externalLocaleReferences.length;if(this.pendingLocaleDownloads==0)this.downloadLibraries(a);else for(var c=this,b=function(b,d){try{if(d)if(d.hasOwnProperty("locales"))for(var e in d)d.hasOwnProperty(e)&&c.injectLibraryResources(b.libraryId,d[e],e);else if(b.hasOwnProperty("locale"))c.injectLibraryResources(b.libraryId,d,b.locale);else throw Error("Locale reference missing 'locale' identifier.");else c.trace.warning("Error loading locale '{0}' for library '{1}' from offline storage.".format(b.locale,
b.libraryId))}catch(g){c.trace.error("Error fetching external locale resource {0}: {1}".format(b.uri,g.message))}finally{--c.pendingLocaleDownloads,c.pendingLocaleDownloads<1&&c.downloadLibraries(a)}},e=function(b,d){c.trace.error("Error fetching external locale resource {0}: {1}".format(b.uri,d.message));--c.pendingLocaleDownloads;c.pendingLocaleDownloads<1&&c.downloadLibraries(a)},f=0;f<a.externalLocaleReferences.length;++f)(function(a){c.isOffline.get()===true?c.store.get("__locale_{0}".format(a.uri),
function(c){c&&(c=d.framework.utils.base64Decode(c));b(a,c)},function(c){e(a,c)}):dojo.xhrGet({url:a.uri,handleAs:"json",load:function(c){b(a,c)},error:function(c){e(a,c)}})})(a.externalLocaleReferences[f])};e.prototype.addNativeReadyFunction=function(a){if(typeof gcxNativeReady!=="undefined")a&&a();else{var c=gcxNativeReadyCallback;gcxNativeReadyCallback=function(){c&&c();a&&a()}}};e.prototype.initializeModules=function(a){for(var c={},b=0;b<a.length;++b){var e=a[b];if(!this.moduleManager.moduleIsLoaded(e.moduleName)){var f=
this.translateConfiguration(e.libraryId,e.configuration),h=this.moduleManager.instantiate(e.moduleType,e.libraryId);if(h===null)this.trace.error("Could not instantiate module with type '{0}' - type not found or constructor failed.".format(e.moduleType));else{if(h.initialize){this.trace.info("Initializing module '{0}'.".format(e.moduleName));try{h.initialize(f),h.id=d.framework.utils.alphaNumericToken(),this.registerFrameworkObject(h)}catch(t){this.trace.error("Error initializing module '{0}': {1}.".format(e.moduleName,
t.message));continue}this.moduleManager.markModuleLoaded(e.moduleName,h);this.trace.debug("Module '{0}' initialized.".format(e.moduleName))}if(e.viewModelConfigs&&e.viewModelConfigs.length>0)for(h=0;h<e.viewModelConfigs.length;++h){var l=e.viewModelConfigs[h];if(c[l.viewModelId])this.trace.error("ViewModel '{0}' already exists in module '{1}'.".format(l.viewModelId,e.moduleName));else{var n=null;try{n=this.instantiateFrameworkObject(l.typeName,l.libraryId),n.id=l.viewModelId||d.framework.utils.alphaNumericToken(),
f=this.translateConfiguration(e.libraryId,l.configuration),n.initialize(f),c[l.viewModelId]=n,this.registerFrameworkObject(n)}catch(m){this.trace.error("Could not create view model with type '{0}' - type was not found, not a view model, or failed to construct: {1}".format(l.typeName,m.message))}}}}}}for(b=0;b<a.length;++b)if(e=a[b],e.viewConfigs)for(h=0;h<e.viewConfigs.length;++h)if(f=e.viewConfigs[h],!this.getFrameworkObjectById(f.viewId))f=this.translateConfiguration(e.libraryId,f),l=null,f.viewModelId?
(l=c[f.viewModelId])?l.libraryId=e.libraryId:this.trace.error("Could not attach view model '{0}' to view '{1}' - view model not found.".format(f.viewModelId,f.viewId)):l=new d.framework.ui.ViewModelBase(this,e.libraryId),f.viewModel=l,(l=this.viewManager.createView(f))?this.registerFrameworkObject(l):this.trace.warning("Could not instantiate view with type '{0}'.".format(f.typeName));if(this.initializationCompleteCallback)this.onInitializationComplete(),this.initializationCompleteCallback=null};return e}();
f.Application=h})(b.application||(b.application={}))})(d.framework||(d.framework={}))})(geocortex||(geocortex={}));(function(d){(function(b){(function(b){var d=function(){return function(){}}();b.BindingExpressionFactory=d})(b.ui||(b.ui={}))})(d.framework||(d.framework={}))})(geocortex||(geocortex={}));
(function(d){(function(b){(function(b){var d=function(){function b(){}b.prototype.bind=function(){};b.prototype.unbind=function(){};return b}();b.DefaultBindingEngine=d})(b.ui||(b.ui={}))})(d.framework||(d.framework={}))})(geocortex||(geocortex={}));
(function(d){(function(b){(function(f){var h=function(e){function a(a,b){e.call(this,a,b)}__extends(a,e);a.prototype.unhostAllViews=function(){for(var a=0;a<this.views.length;++a)this.unhostView(this.views[a]);this.views.length=0};a.prototype.hostView=function(a){this.unhostAllViews();this.views.push(a);if(a.markupResource){var b=d.resourceManager.fetch(a.markupResource,a.libraryId);if(b==null)return this.app.trace.warning("Could not fetch markup resource '{0}' in library '{1}'.".format(a.markupResource,
a.libraryId)),false;else{if(!a.bound)a.root=dojo.create("div",{className:"view"}),a.root.innerHTML=b;dojo.place(a.root,this.domElement,"only");this.app.viewManager.discoverRegions(a.root,a)}}a.viewModel&&a.attach(a.viewModel);e.prototype.hostView.call(this,a);return true};a.prototype.unhostView=function(a){this.deactivateView(a);b.utils.ArrayUtils.removeItem(this.views,a);var d=new dojo.NodeList;d.push(a.root);d.orphan();e.prototype.unhostView.call(this,a)};return a}(f.RegionAdapterBase);f.DivRegionAdapter=
h})(b.ui||(b.ui={}))})(d.framework||(d.framework={}))})(geocortex||(geocortex={}));
(function(d){(function(b){(function(f){var h=function(e){function a(a,b){e.call(this,a,b);this.activeViews=[]}__extends(a,e);a.prototype.activateView=function(a){b.utils.ArrayUtils.contains(this.activeViews,a)&&b.utils.ArrayUtils.removeItem(this.activeViews,a);this.activeViews.push(a);dojo.place(a.root,this.domElement,"last");e.prototype.activateView.call(this,a)};a.prototype.deactivateView=function(a){a.isActive=false;b.utils.ArrayUtils.removeItem(this.activeViews,a);this.activeViews.length>0&&this.activateView(this.activeViews[this.activeViews.length-
1]);e.prototype.deactivateView.call(this,a)};a.prototype.hostView=function(a){this.views.push(a);if(a.markupResource){var b=d.resourceManager.fetch(a.markupResource,a.libraryId);if(b==null)return this.app.trace.warning("Could not fetch markup resource '{0}' in library '{1}'.".format(a.markupResource,a.libraryId)),false;else{if(!a.bound){var f=this.getHostedTagName();a.root=dojo.create(f,{className:"view {0}".format(a.id)});a.root.innerHTML=b}dojo.place(a.root,this.domElement,"last");this.app.viewManager.discoverRegions(a.root,
a)}}a.viewModel&&a.attach(a.viewModel);e.prototype.hostView.call(this,a);return true};a.prototype.unhostView=function(a){this.deactivateView(a);b.utils.ArrayUtils.removeItem(this.views,a);b.utils.ArrayUtils.removeItem(this.activeViews,a);var d=new dojo.NodeList;d.push(a.root);d.orphan();e.prototype.unhostView.call(this,a)};a.prototype.getHostedTagName=function(){return!this.options||!this.options.tagName?"div":this.options.tagName};return a}(f.RegionAdapterBase);f.DivStackRegionAdapter=h})(b.ui||
(b.ui={}))})(d.framework||(d.framework={}))})(geocortex||(geocortex={}));
(function(d){(function(b){(function(f){var h=function(e){function a(){e.apply(this,arguments);this.activeViews=[]}__extends(a,e);a.prototype.activateView=function(a){this.hideAllViews();if(this.activeViews.length>0){var d=this.activeViews[this.activeViews.length-1];d!==a&&(this.cancelActivate(d),d.deactivated())}b.utils.ArrayUtils.contains(this.activeViews,a)&&b.utils.ArrayUtils.removeItem(this.activeViews,a);this.activeViews.push(a);e.prototype.activateView.call(this,a)};a.prototype.deactivateView=
function(a,d){if(d===void 0||d===null)d=true;b.utils.ArrayUtils.removeItem(this.activeViews,a);d&&this.activeViews.length>0&&this.activateView(this.activeViews[this.activeViews.length-1]);e.prototype.deactivateView.call(this,a)};a.prototype.hideAllViews=function(){dojo.query("> .view",this.domElement).removeClass("active");dojo.query("> .view",this.domElement).addClass("inactive")};a.prototype.hostView=function(a){this.views.push(a);if(a.markupResource){var b=d.resourceManager.fetch(a.markupResource,
a.libraryId);if(b==null)return this.app.trace.warning("Could not fetch markup resource '{0}' in library '{1}'.".format(a.markupResource,a.libraryId)),false;var f=this.getHostedTagName();a.root=dojo.create(f,{className:"view {0}".format(a.id)});a.root.innerHTML=b;dojo.place(a.root,this.domElement,"last");this.app.viewManager.discoverRegions(a.root,a)}a.viewModel&&a.attach(a.viewModel);e.prototype.hostView.call(this,a);return true};a.prototype.getHostedTagName=function(){return!this.options||!this.options.tagName?
"div":this.options.tagName};a.prototype.unhostView=function(a){this.deactivateView(a);b.utils.ArrayUtils.removeItem(this.views,a);b.utils.ArrayUtils.removeItem(this.activeViews,a);var d=new dojo.NodeList;d.push(a.root);d.orphan();e.prototype.unhostView.call(this,a)};return a}(f.RegionAdapterBase);f.MultiViewRegionAdapter=h})(b.ui||(b.ui={}))})(d.framework||(d.framework={}))})(geocortex||(geocortex={}));
(function(d){(function(b){(function(b){var d=function(b){function a(){b.apply(this,arguments)}__extends(a,b);a.prototype.getHostedTagName=function(){return"div"};return a}(b.MultiViewRegionAdapter);b.MultiDivRegionAdapter=d})(b.ui||(b.ui={}))})(d.framework||(d.framework={}))})(geocortex||(geocortex={}));
(function(d){(function(b){(function(b){(function(b){function d(){c===null&&(c=(new Date).getTimezoneOffset());return c}var a=/(Z|([+-][012]\d(:?\d\d)?))\s*$/;b.containsTimezone=function(b){return a.test(b)};var c=null,f=null;b.getTimezoneOffset=d;b.getTimezoneString=function(){if(f==null){var a=d(),b=Math.floor(a/60),a=Math.floor(a-b*60);if(b==0&&a==0)return"Z";b<0?(b*=-1,f="+"):f="-";f+=b==0?"00":b<10?"0"+b:b;f+=a==0?":00":a<10?":0"+a:":"+a}return f};(function(){var a=new Date("2011-06-02T09:34:29+02:00");
Date.fromISO=!a||+a!==1307000069E3?function(a){var b,c=/^(\d{4}\-\d\d\-\d\d([tT ][\d:\.]*)?)([zZ]|([+\-])(\d\d):(\d\d))?$/.exec(a)||[];if(c[1]){a=c[1].split(/\D/);b=0;for(var d=a.length;b<d;b++)a[b]=parseInt(a[b],10)||0;a[1]-=1;a=new Date(Date.UTC.apply(Date,a));if(!a.getDate())return NaN;c[5]&&(b=parseInt(c[5],10)*60,c[6]&&(b+=parseInt(c[6],10)),c[4]=="+"&&(b*=-1),b&&a.setUTCMinutes(a.getUTCMinutes()+b));return a}return NaN}:function(a){return new Date(a)}})();Date.prototype.toISOString||function(){function a(b){b=
String(b);b.length===1&&(b="0"+b);return b}Date.prototype.toISOString=function(){return this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"."+String((this.getUTCMilliseconds()/1E3).toFixed(3)).slice(2,5)+"Z"}}()})(b.DateUtils||(b.DateUtils={}))})(b.utils||(b.utils={}))})(d.framework||(d.framework={}))})(geocortex||(geocortex={}));
(function(d){(function(b){(function(b){var d=function(){function b(a,c,d){this.delayMS=0;this.func=null;this.delayMS=a;this.func=d?function(){c.apply(d)}:c}b.prototype.start=function(){this._timerHandle=setTimeout(this.func,this.delayMS)};b.prototype.stop=function(){clearTimeout(this._timerHandle)};b.prototype.reset=function(){this.stop();this.start()};return b}();b.TimeDelayedAction=d})(b.utils||(b.utils={}))})(d.framework||(d.framework={}))})(geocortex||(geocortex={}));
