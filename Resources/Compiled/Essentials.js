/*
	
	Copyright (c) 2013, Latitude Geographics Group Ltd.
	All rights reserved.
	       
	Redistribution is not permitted. 
	
	Use in binary form, without modification, is permitted provided that neither 
	the name of the organization nor the names of its contributors may be used 
	to endorse or promote products derived from this software without specific 
	prior written permission.
	       
	THIS SOFTWARE IS PROVIDED BY COPYRIGHT HOLDER ''AS IS'' AND ANY
	EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
	WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
	DISCLAIMED. IN NO EVENT SHALL LATITUDE GEOGRAPHICS GROUP LTD. BE LIABLE FOR ANY
	DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
	(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
	LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
	ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
	(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
	SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/

var geocortex;(function(b){(function(b){var e=function(){return function(b,c){this.className=b;this.instance=c}}();b.Extension=e})(b.essentials||(b.essentials={}))})(geocortex||(geocortex={}));(function(b){(function(b){var e=function(){return function(){this.password=this.messageFromServer=null;this.pendingCalls=[];this.username=this.token=this.targetRootUri=this.tokenRootUri=this.tokenService=null}}();b.AuthenticationControlBlock=e})(b.essentials||(b.essentials={}))})(geocortex||(geocortex={}));
(function(b){(function(b){var e=function(){function b(){this._authenticationControlBlocks=[]}b.prototype.add=function(c){this.find(c.tokenRootUri)===null&&this._authenticationControlBlocks.push(c)};b.prototype.remove=function(c){for(var a=0;a<this._authenticationControlBlocks.length;a++)if(this._authenticationControlBlocks[a]===c)return this._authenticationControlBlocks.splice(a,1),true;return false};b.prototype.find=function(c){for(var a=0;a<this._authenticationControlBlocks.length;a++){var g=this._authenticationControlBlocks[a],
h=g.tokenRootUri,b=g.targetRootUri;if(c.toLowerCase().indexOf(h.toLowerCase())===0||c.toLowerCase().indexOf(b.toLowerCase())===0)return g}return null};b.prototype.removeAt=function(c){this._authenticationControlBlocks.splice(c,1)};return b}();b.AuthenticationControlBlockStore=e})(b.essentials||(b.essentials={}))})(geocortex||(geocortex={}));(function(b){(function(b){var e=function(){return function(){}}();b.TokenResult=e})(b.essentials||(b.essentials={}))})(geocortex||(geocortex={}));
(function(b){(function(f){var e=function(){function d(c,a){this._error=this._handle=this.optionsObject=this.requestObject=null;this._deferred=new dojo.Deferred;if(c!==void 0){this.requestObject=c;if(dojo.isFunction(this.requestObject.error))this._error=this.requestObject.error,this.requestObject.error=null;if(dojo.isFunction(this.requestObject.handle))this._handle=this.requestObject.handle;this.requestObject.handle=dojo.hitch(this,this._handleProxy)}if(a!==void 0)this.optionsObject=a}d.getAuthenticationControlBlockStore=
function(){return d._controlBlocks};d.prototype._handleProxy=function(c,a){this._isUnauthorizedResponse(c)===false&&dojo.isFunction(this._handle)&&this._handle(c,a)};d.prototype._requestCallback=function(c){this._deferred.resolve(c)};d.prototype._requestErrback=function(c){this._isUnauthorizedResponse(c)?this._handleUnauthenticated(c):(dojo.isFunction(this._error)&&this._error(c),this._deferred.reject(c))};d.prototype._isUnauthorizedResponse=function(c){return c&&c.code===401?true:false};d.prototype._handleUnauthenticated=
function(c){if(c&&c.tokenService){if(b.hasProxy()===false)throw Error("No proxy page is configured - a proxy page is required to access secured Sites");var a=this.requestObject.url,g=c.tokenService,h=b.essentials.RestHelperHTTPService._controlBlocks.find(this.requestObject.url);if(h===null||h.token!==null&&h.token!==""){var o=new dojo._Url(a),g=o.scheme+"://"+o.host+(o.port&&o.port!=="80"?":"+o.port:"")+g;h||(h=new b.essentials.AuthenticationControlBlock);h.messageFromServer=c.message;h.token===null?
(h.tokenService=g,h.tokenRootUri=g.substring(0,g.lastIndexOf("/")),h.targetRootUri=a.substring(0,a.lastIndexOf("/")),h.pendingCalls.push(this),b.essentials.RestHelperHTTPService._controlBlocks.add(h),this._gatherCredentials().then(dojo.hitch(this,function(a){h.username=a.username;h.password=a.password;this._requestToken(h)}))):(h.token=null,h.pendingCalls=[],h.pendingCalls.push(this),this._requestToken(h))}else{c=false;for(a=0;a<h.pendingCalls.length;a++)if(h.pendingCalls[a]===this){c=true;break}c===
false&&h.pendingCalls.push(this)}}else dojo.isFunction(this._error)&&this._error(c),this._deferred.reject(c)};d.prototype._gatherCredentials=function(c){var a;a=c===void 0?new dojo.Deferred:c;if(!dijit.Dialog||!dijit.form||!dijit.form.TextBox||!dijit.form.Button)dojo.require("dijit.Dialog"),dojo.require("dijit.form.TextBox"),dojo.require("dijit.form.Button"),dojo.addOnLoad(dojo.hitch(this,function(){this._gatherCredentials(a)}));else{var g=b.essentials.RestHelperHTTPService._controlBlocks.find(this.requestObject.url),
c=b.config.authenticationDialogId,h;c?h=dijit.byId(c):c=b.config.authenticationDialogId="geocortex_authenticationDialog_default";if(!h||!(h instanceof dijit.Dialog))h=new dijit.Dialog({title:"Authentication Required",id:c,content:this._createAuthDialogContent()});dojo.html.set(dojo.byId(c+"_message"),g.messageFromServer||"");var g=dijit.byId(c+"_ok"),c=dijit.byId(c+"_cancel"),o,d,e;o=dojo.connect(g,"onClick",function(){dojo.forEach([o,d,e],dojo.disconnect);var g=h.attr("value");a.resolve({username:g.username,
password:g.password})});d=dojo.connect(c,"onClick",function(){dojo.forEach([o,d,e],dojo.disconnect);h.hide();a.cancel()});e=dojo.connect(h,"onCancel",function(){dojo.forEach([o,d,e],dojo.disconnect);a.cancel()});h.show()}return a};d.prototype._createAuthDialogContent=function(){var c=b.config.authenticationDialogId,a=new dijit.form.TextBox({name:"username",id:"gcx_auth_username"}),g=new dijit.form.TextBox({type:"password",name:"password",id:"gcx_auth_password"}),h=new dijit.form.Button({label:"OK",
type:"submit",id:c+"_ok"}),o=new dijit.form.Button({label:"Cancel",type:"button",id:c+"_cancel"}),d=dojo.create("div");dojo.create("div",{id:c+"_message"},d);var e=dojo.create("table",null,d),f=dojo.create("tr",null,e),i=dojo.create("tr",null,e),e=dojo.create("tr",null,e);dojo.place("<td><label for='gcx_auth_username'>Username: </label></td>",f);dojo.place("<td><label for='gcx_auth_password'>Password: </label></td>",i);f=dojo.create("td",null,f);i=dojo.create("td",null,i);e=dojo.create("td",{colspan:"2",
align:"center"},e);c=dojo.create("div",{id:c+"_actionbuttoncontainer"},e);a.placeAt(f);g.placeAt(i);h.placeAt(c);o.placeAt(c);return d};d.prototype._requestToken=function(c){esri.request({url:c.tokenService,content:{username:c.username,password:c.password,lifespan:"20",f:"json"},timeout:b.config.io.timeout,handleAs:"json"},{usePost:true}).then(dojo.hitch(this,this._onTokenRequestCompleted),dojo.hitch(this,this._onTokenRequestFault))};d.prototype._onTokenRequestFault=function(c){if(this._isUnauthorizedResponse(c)){var a=
b.essentials.RestHelperHTTPService._controlBlocks.find(this.requestObject.url);a.messageFromServer=c.message;this._gatherCredentials().then(dojo.hitch(this,function(g){a.username=g.username;a.password=g.password;this._requestToken(a)}))}else dojo.isFunction(this._error)&&this._error(c),this._deferred.errback(c)};d.prototype._onTokenRequestCompleted=function(c){var a=b.essentials.RestHelperHTTPService._controlBlocks.find(this.requestObject.url);if(c&&c.token){a.token=c.token;dojo.publish("geocortex_authenticationSucceeded",
[{username:a.username,token:a.token}]);for(c=a.pendingCalls.length-1;c>=0;c--){var g=a.pendingCalls[c];a.pendingCalls.pop();g.send()}}else b.essentials.RestHelperHTTPService._controlBlocks.remove(a)};d.prototype.send=function(){if(this.requestObject!==null){var c=b.essentials.RestHelperHTTPService._controlBlocks.find(this.requestObject.url);if(c!==null&&c.token!==null){if(!this.requestObject.content)this.requestObject.content={};if(this.requestObject.url.indexOf("token=")===-1)this.requestObject.url=
this._appendParameter(this.requestObject.url,"token",c.token)}}else if(this.requestObject.url.indexOf("token=")!==-1)this.requestObject.url=this.requestObject.url.replace("token=","oldtkn=");if(d.arcGisPortalToken)this.requestObject.url=this._appendParameter(this.requestObject.url,"arcGisPortalToken",d.arcGisPortalToken.token);esri.request(this.requestObject,this.optionsObject).then(dojo.hitch(this,this._requestCallback),dojo.hitch(this,this._requestErrback));return this._deferred.promise};d.prototype._appendParameter=
function(c,a,g){var h=c;h+=c.indexOf("?")>0?"&":"?";h+=encodeURIComponent(a)+"="+encodeURIComponent(g);return h};d._controlBlocks=new b.essentials.AuthenticationControlBlockStore;return d}();f.RestHelperHTTPService=e})(b.essentials||(b.essentials={}))})(geocortex||(geocortex={}));
(function(b){function f(b){var d,c,a={};typeof b.toJson==="function"&&(a=b.toJson());for(var g in b)if(!(g=="declaredClass"||a[g]!==void 0))if(d=b[g],c=typeof d,d!==null&&d!==void 0&&c!=="function")if(dojo.isArray(d)){a[g]=[];c=0;for(var h=d.length;c<h;c++)a[g][c]=f(d[c])}else c==="object"?typeof d.toJson==="function"&&(a[g]=d.toJson()):a[g]=d;return a}b.config={baseUrl:"http://localhost/",io:{errorHandler:function(b){dojo.publish("geocortex.Error",[b])},postLength:2E3,timeout:6E4},REST_version:"3.0",
authenticationDialogId:null};b.deferredResolve=function(b,d){b&&b.fired==-1&&b.resolve(d)};b.deferredReject=function(b,d){b&&b.fired==-1&&b.reject(d)};b.encodeJson=function(b){var b=f(b),d={},c;for(c in b)d[c]=dojo.isArray(b[c])||typeof b[c]==="object"?dojo.toJson(b[c]):b[c];return d};b.request=function(e,d){d||(d={});if(!d.gcx)d.gcx={};e.preventCache=d.gcx.preventCache===void 0?true:d.gcx.preventCache?true:false;e.content=b.encodeJson(dojo.mixin({v:b.config.REST_version},e.content));e.timeout=e.timeout||
b.config.io.timeout;e.handleAs=e.handleAs||"json";var c=b.requiresProxy(e),a=b.hasProxy();if(c&&!a)return c=Error("Cross-domain or large requests require a proxy."),dojo.isFunction(e.error)&&e.error(c),a=new dojo.Deferred,a.errback(c),a;delete e.gcx;d.useProxy=c;if(!d.hasOwnProperty("disableIdentityLookup"))d.disableIdentityLookup=true;return(new b.essentials.RestHelperHTTPService(e,d)).send()};b.hasProxy=function(){var b=false;try{b=esri._getProxyUrl()}catch(d){}return b};b.requiresProxy=function(e){var d=
false;try{var c=e.url.length;e.content&&(c+=dojo.objectToQuery(e.content).length);var a=new dojo._Url(e.url),g=window.location;if(!a.scheme&&!a.host&&!a.port)return false;var h=g.protocol+"//"+g.hostname+(g.port?":"+g.port:"")!==a.scheme+"://"+a.host+(a.port?":"+a.port:""),d=c>b.config.io.postLength&&h}catch(o){}return d};b.urlToQueryObject=function(b){var d=b.indexOf("?");return d===-1?null:dojo.queryToObject(b.substring(d+1))};b._getExtensions=function(e){var d=[];if(!e)return d;d.length=e.length;
for(var c=0;c<e.length;c++)d[c]=new b.essentials.Extension(e[c].className,e[c].instance);return d};b._getProperties=function(b){var d={};if(!b)return d;for(var c=0;c<b.length;c++)d[b[c].name]=b[c].value;return d}})(geocortex||(geocortex={}));
(function(b){(function(f){var e=function(){function d(c){this.initializationFailure=null;this.isInitialized=false;this.onInitialized=this.onInitializationFailed=null;this._initializing=false;if(!dojo.isString(c)||c.length===0)throw Error("Invalid url supplied to AsyncInitializable: "+c);this.url=c;this._initializedHandler=dojo.hitch(this,this._initializedHandler);this._initializationFailedHandler=dojo.hitch(this,this._initializationFailedHandler);this._restLoadHandler=dojo.hitch(this,this._restLoadHandler);
this._restErrorHandler=dojo.hitch(this,this._restErrorHandler)}d.prototype.initialize=function(c){if(!this.isInitialized&&!this._initializing){var a=c!==void 0&&c!==null;a?this._restLoadHandler(true,c):(this._initializing=true,b.request({url:this.url,content:{f:"json"},load:dojo.hitch(this,this._restLoadHandler,a),error:this._restErrorHandler,callbackParamName:"CallBack"}))}};d.prototype.doWhenInitialized=function(c,a){arguments.length===1&&(a=c,c=this);if(this.isInitialized)a.call(c,this);else var g=
dojo.connect(this,"onInitialized",this,function(){dojo.disconnect(g);a.apply(c,arguments)})};d.prototype._configureObject=function(){};d.prototype._initializationFailedHandler=function(c){this.initializationFailure=c;if(this.onInitializationFailed)this.onInitializationFailed(c)};d.prototype._initializedHandler=function(c){this.isInitialized=true;if(this.onInitialized)this.onInitialized(c);this._initializing=false};d.prototype._restErrorHandler=function(c){this._initializationFailedHandler(c);this._initializedHandler(this)};
d.prototype._restLoadHandler=function(c,a){this._configureObject(a,c);this._initializedHandler(this)};return d}();f.AsyncInitializable=e})(b.essentials||(b.essentials={}))})(geocortex||(geocortex={}));
(function(b){(function(b){(function(b){var d=function(){function c(a){this.originalUri=a;this.schemeHostAndPath=a.match(/[^?|^#]*/)[0];var g=a.match(/\?([^#]*)/);this.query={};if(g&&g.length>1)this.query=dojo.queryToObject(g[1]);this.fragment=dojo.queryToObject(a.indexOf("#")>=0?a.substring(a.indexOf("#")+1,a.length):"")}c.prototype.recompose=function(){var a=this.schemeHostAndPath;this.query&&this.anyProperties(this.query)&&(a+="?"+dojo.objectToQuery(this.query));this.fragment&&this.anyProperties(this.fragment)&&
(a+="#"+dojo.objectToQuery(this.fragment));return a};c.prototype.anyProperties=function(a){for(var g in a)return true;return false};c.getHost=function(a){if(!a)return null;a=a.match(/^http[s]?:\/\/([^\/]*)/);return a.length>1?a[1]:null};return c}();b.DecomposedUri=d})(b.utilities||(b.utilities={}))})(b.essentials||(b.essentials={}))})(geocortex||(geocortex={}));
(function(b){(function(b){(function(b){var d=function(){function c(){}c.endsWith=function(a,g){return a.indexOf(g,a.length-g.length)!==-1};return c}();b.StringUtilities=d;if(typeof String.prototype.endsWith!=="function")String.prototype.endsWith=function(c){return d.endsWith(this,c)}})(b.utilities||(b.utilities={}))})(b.essentials||(b.essentials={}))})(geocortex||(geocortex={}));
(function(b){(function(b){var e=function(){function c(){}c.getTokenFromImplicitGrant=function(){var a=window.location.href;if(a.indexOf("#")>0){var a=a.substring(a.indexOf("#")+1,a.length),g=dojo.queryToObject(a);if(!g.access_token)return null;a=new b.TokenResult;a.token=g.access_token;a.userName=g.username;if(g=parseInt(g.expires_in))a.expiresOn=new Date((new Date).getTime()+g*1E3);return a}return null};c.getErrorFromImplicitGrant=function(){var a=window.location.href;if(a.indexOf("#")>0&&(a=a.substring(a.indexOf("#")+
1,a.length),a=dojo.queryToObject(a),a.error)){var g=new d;g.code=a.error;g.description=a.error_description;return g}return null};c.applicationHasImplicitGrant=function(){return c.hasFragmentParameter("access_token")};c.applicationHasImplicitGrantError=function(){return c.hasFragmentParameter("error")};c.hasFragmentParameter=function(a){var g=window.location.href;if(g.indexOf("#")<0)return false;g=window.location.href;g=g.substring(g.indexOf("#")+1,g.length);return!!dojo.queryToObject(g)[a]};c.redirectToLogOnPage=
function(a,g){var h=new b.utilities.DecomposedUri(window.location.href);c.removeImplicitGrantParams(h);h=a+"?client_id="+encodeURIComponent(g)+"&response_type=token&redirect_uri="+encodeURIComponent(h.recompose())+"&expiration=20160";window.location.href=h};c.removeImplicitGrantParamsAndUpdateUrlHash=function(){var a=new b.utilities.DecomposedUri(window.location.href);c.removeImplicitGrantParams(a);window.location.hash=dojo.objectToQuery(a.fragment)};c.removeImplicitGrantParams=function(a){delete a.fragment.access_token;
delete a.fragment.username;delete a.fragment.expires_in;delete a.fragment.error;delete a.fragment.error_description;return a};return c}();b.OAuth2Client=e;var d=function(){function c(){}c.ACCESS_DENIED_ERROR_CODE="access_denied";return c}();b.OAuth2Error=d})(b.essentials||(b.essentials={}))})(geocortex||(geocortex={}));
(function(b){(function(b){var e=function(){function d(c,a,g){this.baseUrl=c;this.domains=a;this.clientId=g}d.prototype.initiate=function(){if(!this.tokenResult)this.tokenResult=b.OAuth2Client.getTokenFromImplicitGrant();if(!this.tokenResult)return(this.error=b.OAuth2Client.getErrorFromImplicitGrant())||b.OAuth2Client.redirectToLogOnPage(this.getLogOnUrl(),this.clientId),b.OAuth2Client.removeImplicitGrantParamsAndUpdateUrlHash(),false;b.OAuth2Client.removeImplicitGrantParamsAndUpdateUrlHash();return true};
d.prototype.getLogOnUrl=function(){return this.baseUrl+"oauth2/authorize"};d.prototype.getToken=function(c){return!this.tokenResult||!c?null:this.appliesTo(c)?this.tokenResult.token:null};d.prototype.appliesTo=function(c){for(var c=b.utilities.DecomposedUri.getHost(c),a=0;a<this.domains.length;a++)if(b.utilities.StringUtilities.endsWith(c,this.domains[a]))return true;return false};return d}();b.ArcGisPortalSecurityContext=e})(b.essentials||(b.essentials={}))})(geocortex||(geocortex={}));
(function(b){(function(b){var e;(function(c){c[c.NONE=-1]="NONE";c[c.RESIZE=0]="RESIZE";c[c.REPOSITION=1]="REPOSITION";c[c.EXTENT_CHANGE=2]="EXTENT_CHANGE"})(e||(e={}));var d=function(){function c(a,g){this._map=null;this._queuedExtentChangePriority=this._currentExtentChangePriority=-1;this._queuedExtentChange=[];this._mapLoaded=false;this._layersLoaded=true;this._repositionInProgress=this._resizeInProgress=this._extentChangeInProgress=false;this._newLayers=[];this.currentExtentChangeHandle=null;
this._map=a;g&&a.setExtent(g);dojo.connect(this._map,"onResize",dojo.hitch(this,this._onResize));dojo.connect(this._map,"onReposition",dojo.hitch(this,this._onReposition))}c.prototype._onResize=function(){if(this._resizeInProgress)this._resizeInProgress=false,this._handleNextExtentChange()};c.prototype._onReposition=function(){if(this._repositionInProgress)this._repositionInProgress=false,this._handleNextExtentChange()};c.prototype._onExtentChange=function(){if(this._extentChangeInProgress)this._currentExtentChangePriority=
-1,this._extentChangeInProgress=false,this._handleNextExtentChange()};c.prototype.registerLayer=function(a){this._hasLoaded()||(this._newLayers.push(a),a.suspend())};c.prototype.firstResize=function(){this._mapLoaded=true;this._handleNextExtentChange()};c.prototype._handleNextExtentChange=function(){if(this._hasLoaded())if(this._queuedExtentChange[e.RESIZE]!==null&&typeof this._queuedExtentChange[e.RESIZE]!=="undefined"){this._resizeInProgress=true;var a=this._queuedExtentChange[e.RESIZE];this._queuedExtentChange[e.RESIZE]=
null;a(this._map)}else if(this._queuedExtentChange[e.REPOSITION]!==null&&typeof this._queuedExtentChange[e.REPOSITION]!=="undefined")this._repositionInProgress=true,a=this._queuedExtentChange[e.REPOSITION],this._queuedExtentChange[e.REPOSITION]=null,a(this._map);else if(this._queuedExtentChange[e.EXTENT_CHANGE]!==null&&typeof this._queuedExtentChange[e.EXTENT_CHANGE]!=="undefined")this._extentChangeInProgress=true,this._currentExtentChangePriority=this._queuedExtentChangePriority,this._queuedExtentChangePriority=
-1,a=this._queuedExtentChange[e.EXTENT_CHANGE],this._queuedExtentChange[e.EXTENT_CHANGE]=null,a(this._map);else for(a in this._map._layers)this._map._layers.hasOwnProperty(a)&&this._map._layers[a].resume()};c.prototype.changeExtentWithPriority=function(a,g,h){var c=a,b=this;this._hasLoaded()?(g=typeof h!=="undefined"?h:5,c=function(g){b.currentExtentChangeHandle!==null&&b.currentExtentChangeHandle.cancel();b.currentExtentChangeHandle=a(g);b.currentExtentChangeHandle.then(dojo.hitch(b,b._onExtentChange),
dojo.hitch(b,b._onExtentChange))}):(g=typeof g!=="undefined"?g:5,c=function(g){setTimeout(function(){b.currentExtentChangeHandle!==null&&b.currentExtentChangeHandle.cancel();var h=esri.config.defaults.map.panDuration,c=esri.config.defaults.map.zoomDuration;esri.config.defaults.map.panDuration=0;esri.config.defaults.map.zoomDuration=0;b.currentExtentChangeHandle=a(g);b.currentExtentChangeHandle.then(dojo.hitch(b,b._onExtentChange),dojo.hitch(b,b._onExtentChange));esri.config.defaults.map.panDuration=
h;esri.config.defaults.map.zoomDuration=c},20)});if(this._isExtentChangeBlocked()){if(!(g<this._queuedExtentChangePriority))this._queuedExtentChangePriority=g,this._queuedExtentChange[e.EXTENT_CHANGE]=c}else if(!(g<this._currentExtentChangePriority))this._currentExtentChangePriority=g,this._extentChangeInProgress=true,c(this._map)};c.prototype.setExtentWithPriority=function(a,g,h){this.changeExtentWithPriority(function(g){return g.setExtent(a)},g,h)};c.prototype.centerAtWithPriority=function(a,g,
h){this.changeExtentWithPriority(function(g){return g.centerAt(a)},g,h)};c.prototype.setScaleWithPriority=function(a,g,h){this.changeExtentWithPriority(function(g){return g.setScale(a)},g,h)};c.prototype.blockForResize=function(a,g,h){if(!(a==this._map.width&&g==this._map.height))this._isResizeBlocked()?this._queuedExtentChange[e.RESIZE]=function(a){a.resize(h)}:(this._resizeInProgress=true,this._map.resize(h))};c.prototype.blockForReposition=function(){this._isRepositionBlocked()?this._queuedExtentChange[e.REPOSITION]=
function(a){a.reposition()}:(this._repositionInProgress=true,this._map.reposition())};c.prototype._isExtentChangeBlocked=function(){return this._resizeInProgress||this._repositionInProgress||this._queuedExtentChange[e.REPOSITION]!=null||this._queuedExtentChange[e.RESIZE]!=null||!this._hasLoaded()};c.prototype._isRepositionBlocked=function(){return this._resizeInProgress||this._repositionInProgress||this._extentChangeInProgress||!this._hasLoaded()};c.prototype._isResizeBlocked=function(){return this._isRepositionBlocked()};
c.prototype._hasLoaded=function(){return this._mapLoaded};return c}();b.ExtentManager=d})(b.essentials||(b.essentials={}))})(geocortex||(geocortex={}));(function(b){(function(b){var e=function(){return function(b,c){this.runtimeTypeName=null;this.runtimeTypeName=b||null;this.value=c||null}}();b.ArgumentValueWrapper=e})(b.workflow||(b.workflow={}))})(geocortex||(geocortex={}));
(function(b){(function(b){(function(b){var d=function(){function c(){}c.equals=function(a,g){return a&&g&&(a===g||b.StringUtilities.endsWith(a,this.separator+g))?true:false};c.separator="-";return c}();b.SiteResourceIdComparer=d})(b.utilities||(b.utilities={}))})(b.essentials||(b.essentials={}))})(geocortex||(geocortex={}));
(function(b){(function(b){var e=function(){return function(){this.type=this.name=this.id=this.featureField=null}}();b.DataLinkParameter=e})(b.essentials||(b.essentials={}))})(geocortex||(geocortex={}));(function(b){(function(b){var e=function(){return function(){}}();b.MapGrid=e})(b.essentials||(b.essentials={}))})(geocortex||(geocortex={}));
(function(b){(function(b){var e=function(){return function(b,c,a,g){this.label=new Observable(b);this.value=new Observable(c);this.isDefault=new Observable(g||false);this.causesValidation=new Observable(a)}}();b.FormButton=e})(b.forms||(b.forms={}))})(geocortex||(geocortex={}));
(function(b){(function(f){(function(e){(function(d){var c=function(){function a(a){this.message=b.forms.getElementText(a,"Message")}a.prototype.validate=function(){throw Error("Abstract method");};return a}();d.ValidationItem=c})(e.validation||(e.validation={}))})(f.items||(f.items={}))})(b.forms||(b.forms={}))})(geocortex||(geocortex={}));
(function(b){(function(f){var e=function(){function d(c,a,g){this._formManager=this.knownTypes=this.inputGeometry=this.containerFormItem=this.inputData=this.version=null;this._version=1.1;this._controlMap=this._cascadingMap=this._formContainer=null;this.knownTypes=[];this.inputData=a;this.version=this._version;this._controlMap={};this._cascadingMap={};a=null;c&&(a=dojox.xml.parser.parse(c));if(g)this.inputGeometry=g;if(a!=null){c=a.documentElement;g=b.forms.getElementText(c,"Version");if(parseFloat(g)>
this._version)throw Error("Form version "+g+" is incompatible with current API version "+this._version);this.title=new Observable(b.forms.getElementText(c,"Title"));this.maxWidth=new Observable(parseInt(b.forms.getElementText(c,"MaxWidth")));this.maxHeight=new Observable(parseInt(b.forms.getElementText(c,"MaxHeight")));a=b.forms.getElement(c,"KnownTypes");if(a!=null)for(g=0;g<a.childNodes.length;g++)this.knownTypes.push(a.childNodes[g].firstChild.data);this.containerFormItem=new b.forms.items.ContainerFormItem(b.forms.getElement(c,
"ContainerFormItem"),this)}else this.containerFormItem=new b.forms.items.ContainerFormItem(null,this),this.containerFormItem.itemID=new Observable("Group1"),this.title=new Observable(""),this.maxWidth=new Observable(NaN),this.maxHeight=new Observable(NaN);for(var h in this._cascadingMap)if(this._cascadingMap.hasOwnProperty(h))for(g=0;g<this._cascadingMap[h].length;++g)c=this._cascadingMap[h][g],this._controlMap[h].queryTaskRunner.cascadingEvent.subscribe(c.formItem,c.handler)}d.prototype.addCascading=
function(b,a,g){this._cascadingMap.hasOwnProperty(b)==false&&(this._cascadingMap[b]=[]);this._cascadingMap[b].push({formItem:a,handler:g})};d.prototype.map=function(b){this._controlMap[b.itemID.get()]=b};d.prototype.render=function(){};d.prototype.validate=function(){return this.containerFormItem.validate()};d.prototype.getResults=function(){return this.containerFormItem._getResults()};d.prototype.destroy=function(){this.containerFormItem._destroy()};return d}();f.FormDefinition=e})(b.forms||(b.forms=
{}))})(geocortex||(geocortex={}));(function(b){(function(b){(function(b){(function(b){var c=function(){return function(a,g){this.isValid=a;this.errorMessage=g}}();b.ValidationResult=c})(b.validation||(b.validation={}))})(b.items||(b.items={}))})(b.forms||(b.forms={}))})(geocortex||(geocortex={}));
(function(b){(function(b){(function(b){var d=function(){return function(b,a,g){this.isList=false;this.argumentName=b;this.value=a;this.wasSet=g||false}}();b.FormItemResult=d})(b.items||(b.items={}))})(b.forms||(b.forms={}))})(geocortex||(geocortex={}));
(function(b){(function(f){(function(e){var d=function(){function c(a,g){this.isRequired=new Observable(false);this.isValid=new Observable(true);this.isVisible=new Observable(true);this.argumentName=null;this.validationItems=[];this.attached_indicatorClass=new Observable("");this.attached_showIndicator=new Observable("");this.formDefinition=g||null;if(a){this.toolTip=new Observable(b.forms.getElementText(a,"ToolTip"));this.itemID=new Observable(b.forms.getElementText(a,"ItemID"));this.argumentName=
new Observable(b.forms.getElementText(a,"ArgumentName"));var h=b.forms.getElementText(a,"IsVisible");h&&this.isVisible.set(b.forms._parseBoolean(h));h=b.forms.getElement(a,"ValidationItems");if(h!=null)for(var c=0;c<h.childNodes.length;c++){var d=b.forms.items._processValidationItem(h.childNodes[c]);d instanceof b.forms.items.validation.RequiredValidationItem&&this.isRequired.set(true);d!=null&&this.validationItems.push(d)}}else this.toolTip=new Observable(""),this.itemID=new Observable(null),this.argumentName=
new Observable(null)}c.prototype.getResult=function(){return null};c.prototype.refresh=function(){};c.prototype.validate=function(){var a=[];this.isValid.set(true);if(this.validationItems!=null)for(var g=0;g<this.validationItems.length;g++){var h=this.getResult();if(h!=null)h=h.value;h=this.validationItems[g].validate(h);h.isValid||(this.isValid.set(false),a.push(h))}return a};c.prototype._render=function(){return document.createTextNode(this.itemID.get())};c.prototype._destroy=function(){};return c}();
e.AbstractFormItem=d})(f.items||(f.items={}))})(b.forms||(b.forms={}))})(geocortex||(geocortex={}));var __extends=this.__extends||function(b,f){function e(){this.constructor=b}for(var d in f)f.hasOwnProperty(d)&&(b[d]=f[d]);e.prototype=f.prototype;b.prototype=new e};
(function(b){(function(f){(function(e){var d=function(c){function a(a,h){c.call(this,a,h);this.formItemType="LabelFormItem";a?(this.text=new Observable(b.forms.getElementText(a,"Text")),this.labelForItemID=new Observable(b.forms.getElementText(a,"LabelForItemID"))):(this.text=new Observable(null),this.labelForItemID=new Observable(null))}__extends(a,c);a.prototype._render=function(){return b.forms.renderFormItem(this)};return a}(e.AbstractFormItem);e.LabelFormItem=d})(f.items||(f.items={}))})(b.forms||
(b.forms={}))})(geocortex||(geocortex={}));(function(b){(function(f){(function(e){e.initLabelContainer=function(d,c){c?(d.label=new e.LabelFormItem(b.forms.getElement(c,"Label")),d.label.toolTip.get()==""&&d.toolTip!=null&&d.label.toolTip.set(d.toolTip.get())):d.label=new b.forms.items.LabelFormItem(null)}})(f.items||(f.items={}))})(b.forms||(b.forms={}))})(geocortex||(geocortex={}));
(function(b){(function(f){(function(e){var d=function(c){function a(a,h){c.call(this,a,h);this.formItemType="TextBoxFormItem";if(a){var o=b.forms.getElementText(a,"DefaultText");this.defaultText=new Observable(o);this.text=new Observable(o);this.inputScope=new Observable(b.forms.getElementText(a,"InputScope"));this.textboxWidth=new Observable(parseInt(b.forms.getElementText(a,"TextboxWidth")))}else this.defaultText=new Observable(""),this.text=new Observable(""),this.inputScope=new Observable("Default"),
this.textboxWidth=new Observable(NaN);this.readOnly=new Observable(false);e.initLabelContainer(this,a,h)}__extends(a,c);a.prototype.getResult=function(){return new e.FormItemResult(this.argumentName.get(),this.text.get())};a.prototype._render=function(){return b.forms.renderFormItem(this)};return a}(e.AbstractFormItem);e.TextBoxFormItem=d})(f.items||(f.items={}))})(b.forms||(b.forms={}))})(geocortex||(geocortex={}));
(function(b){(function(f){(function(e){var d=function(c){function a(a,h){c.call(this,a,h);this.formItemType="TextAreaFormItem";this.textboxHeight=a?new Observable(parseInt(b.forms.getElementText(a,"TextboxHeight"))):new Observable(1)}__extends(a,c);return a}(e.TextBoxFormItem);e.TextAreaFormItem=d})(f.items||(f.items={}))})(b.forms||(b.forms={}))})(geocortex||(geocortex={}));
(function(b){(function(b){var e=function(){return function(b,c,a,g){this.id=b;this.displayName=c;this.value=a;this.multiline=g}}();b.TextField=e})(b.essentials||(b.essentials={}))})(geocortex||(geocortex={}));
(function(b){(function(f){(function(e){e._pickSupported=function(b,c){if(!b||b.length<=0)return null;if(c)for(var a=c.toUpperCase(),g=0;g<b.length;g++){var h=b[g];if(h&&h.toUpperCase()===a)return b[g]}return b[0]};e.handleIntersectLayers=function(d){var c=[],a=[],g=[],h=[],o=null,p=o=null,e=null,e=null,f=false,p=null,i,j;i=-1;var l=d.getValue("InputLayers");if(l&&l.length>0)for(o=0;o<l.length;o++)i=l[o].lastIndexOf("\\\\"),i>=0&&(l[o]=l[o].substring(i+2));else d.dispatcher().handleError(Error("Intersect Layers: no input layers provided."),
d);(o=d.getSite())||d.dispatcher().handleError(Error("Intersect Layers: no site available."),d);(o=o.essentialsMap)||d.dispatcher().handleError(Error("Intersect Layers: no map available."),d);(!o.mapServices||o.mapServices.length<=0)&&d.dispatcher().handleError(Error("Intersect Layers: no map service is configured for the map."),d);for(i=0;i<o.mapServices.length;i++){p=o.mapServices[i];e=p.layers;j=f=0;for(p=[];f<e.length&&j<l.length;)e[f].name<l[j]?f++:(e[f].name>l[j]||(p.push(e[f]),f++),j++);for(j=
0;j<p.length;j++){e=p[j];f=false;switch(e.type){case b.essentials.LayerType.FEATURE_LAYER:a.push(e.name);f=true;break;case b.essentials.LayerType.GROUP_LAYER:g.push(e.name);f=true;break;case b.essentials.LayerType.RASTER_LAYER:h.push(e.name),f=true}f&&c.push(e.name)}}d.setValue("OutputLayers",c);d.setValue("FeatureLayers",a);d.setValue("GroupLayers",g);d.setValue("RasterLayers",h);d.completeActivity()};e.handleExportMap=function(d){var c=d.getValue("TargetSpatialReference"),a=d.getValue("CustomExtent"),
g=d.getValue("Resolution"),h=d.getValue("OutputFormat"),o=d.getValue("Scale"),p=d.getValue("ImageHeight"),e=d.getValue("ImageWidth"),f=null,i=null,j=f=null;(f=d.getSite())||d.dispatcher().handleError(Error("Export Map: no site available."),d);(i=f._esriMap)||d.dispatcher().handleError(Error("Export Map: no map available."),d);(f=f.essentialsMap)||d.dispatcher().handleError(Error("Export Map: no map available."),d);j=new b.essentials.ReportParameters;j.outputFormat=b.workflow.MapActivityHandlers._pickSupported(f.supportedExportFormats,
h);if(g)j.resolution=new b.essentials.Resolution("",g);if(o)j.scale=new b.essentials.Scale("",o);j.imageHeight=p?p:i.height;j.imageWidth=e?e:i.width;if(a)j.customExtent=a;j.extentType=a?b.essentials.ReportParameters.CUSTOM_EXTENT:b.essentials.ReportParameters.CURRENT_EXTENT;if(c)j.targetSpatialReference=c;i&&j.populateMapGraphicsLayers(i);f.exportMap(j,function(a){d.setValue("ResultUrl",a?a.href:null);d.completeActivity()},function(a,g){d.dispatcher().handleError(Error("Error exporting map '"+g.message+
"'"),d)})};e.handlePrintMap=function(d){var c=d.getValue("TargetSpatialReference"),a=d.getValue("TextFields"),g=d.getValue("CustomExtent"),h=d.getValue("NotificationEmailAddress"),o=d.getValue("Resolution"),p=d.getValue("OutputFormat"),e=d.getValue("Scale"),f=d.getValue("PrintTemplateId"),i=d.getValue("GridId"),j=null,l=null,m=null,q=null,r=m=null;(m=d.getSite())||d.dispatcher().handleError(Error("Print Map: no site available."),d);(q=m._esriMap)||d.dispatcher().handleError(Error("Print Map: no map available."),
d);(r=m.findPrintTemplateById(f))||d.dispatcher().handleError(Error("Print Map: unable to find print template '"+f+"'."),d);r.isPrinting()&&d.dispatcher().handleError(Error("Print Map: unable to perform print operation because print template '"+f+"' is busy."),d);m=new b.essentials.ReportParameters;m.outputFormat=b.workflow.MapActivityHandlers._pickSupported(r.supportedOutputFormats,p);if(o)m.resolution=new b.essentials.Resolution("",o);if(e)m.scale=new b.essentials.Scale("",e);if(h)m.notificationEmailAddress=
h;if(g)m.customExtent=g;m.extentType=g?b.essentials.ReportParameters.CUSTOM_EXTENT:b.essentials.ReportParameters.CURRENT_EXTENT;if(c)m.TargetSpatialReference=c;if(r.textFields&&r.textFields.length>0&&a)for(j=0;j<a.length;j++)if(a[j])for(l=0;l<r.textFields.length;l++)a[j].Key===r.textFields[l].displayName&&(c=new b.essentials.TextField(r.textFields[l].id,"",a[j].Value,false),m.fields.push(c));if(i&&(a=dojo.filter(r.grids,function(a){return a.id==i}),a.length>0))m.grid=a[0];q&&m.populateMapGraphicsLayers(q);
r.print(m,function(a){d.setValue("ResultUrl",a?a.href:null);d.completeActivity()},function(a,g){d.dispatcher().handleError(Error("Error printing map '"+g.message+"'"),d)})}})(f.MapActivityHandlers||(f.MapActivityHandlers={}))})(b.workflow||(b.workflow={}))})(geocortex||(geocortex={}));
(function(b){(function(f){(function(e){function d(a,h){for(var b in a)if(a.hasOwnProperty(b)&&b.toLowerCase()===h.toLowerCase())return b;return null}function c(a,h){if(h&&a&&a.essentialsMap&&a.essentialsMap.mapServices)for(var c=0;c<a.essentialsMap.mapServices.length;c++){var d=a.essentialsMap.mapServices[c];if(b.essentials.utilities.SiteResourceIdComparer.equals(d.id,h))return d}return null}function a(a,h){if(!a||!h)return null;if(a.layerIds!=null)for(var c=0;c<a.layerIds.length;c++){var d=a.getLayer(a.layerIds[c]);
if(d!=null&&b.essentials.utilities.SiteResourceIdComparer.equals(d.id,h))return d}if(a.graphicsLayerIds!=null)for(c=0;c<a.graphicsLayerIds.length;c++)if(d=a.getLayer(a.graphicsLayerIds[c]),d!=null&&b.essentials.utilities.SiteResourceIdComparer.equals(d.id,h))return d;return null}e.handleAlert=function(a){a.getValue("Title");var h=a.getValue("Text");alert(h);a.completeActivity()};e.handleConfirm=function(a){var h=a.getValue("Text"),h=confirm(h);h==null&&(h=false);a.setValue("Result",h);a.completeActivity()};
e.handleExportMap=function(a){b.workflow.MapActivityHandlers.handleExportMap(a)};e.handlePrintMap=function(a){b.workflow.MapActivityHandlers.handlePrintMap(a)};e.handleIntersectLayers=function(a){b.workflow.MapActivityHandlers.handleIntersectLayers(a)};e.handleRemoveMapService=function(g){var h=g.getValue("MapServiceId"),c=g.getEsriMap();if(c==null)throw Error("Remove Map Service: No map available.");var d=a(c,h);d&&c.removeLayer(d);if((c=g.getSite())&&c.essentialsMap&&c.essentialsMap.mapServices)for(d=
0;d<c.essentialsMap.mapServices.length;d++)if(b.essentials.utilities.SiteResourceIdComparer.equals(c.essentialsMap.mapServices[d].id,h)){c.essentialsMap.mapServices.splice(d,1);break}g.completeActivity()};e.handleReport=function(a){function h(a){var g=null;if(u&&a)for(var h=0;h<u.length;h++)if(u[h].Key==a){g=u[h];break}return g}var o=a.getValue("MapServiceId"),d=a.getValue("LayerId"),e=a.getValue("LayerName"),f=a.getValue("ReportId"),i=null,j=a.getSite();if(j&&o&&(d||e)&&f)if(o=c(j,o))j=null,d?j=
o.findLayerById(d):e&&(j=o.findLayerByName(e)),j!=null&&(i=j.findReportById(f));if(i){d=new esri.tasks.Query;e=new b.essentials.ReportParameters;a.getValue("ShowOpenReport");var f=a.getValue("Geometry"),o=a.getValue("OutSpatialReference"),j=a.getValue("Text"),l=a.getValue("Where"),m=a.getValue("OutputFormat"),q=a.getValue("Resolution"),r=a.getValue("CustomExtent"),s=a.getValue("SpatialRelationship"),t=a.getValue("ReportExtentType"),v=a.getValue("NotificationEmailAddress"),u=a.getValue("TextFields");
if(!t)t=b.essentials.ReportParameters.CURRENT_EXTENT;e.extentType=t;if(m)e.outputFormat=m;if(i.textFields)for(var w in i.textFields)i.textFields.hasOwnProperty(w)&&(m=i.textFields[w],t=h(m.displayName),t!=null?e.fields.push(new b.essentials.TextField(m.id,m.displayName,t.Value,m.multiline)):e.fields.push(m));if(v)e.notificationEmailAddress=v;if(q)e.resolution=q;if(r)e.customExtent=r;d.spatialRelationship=b.essentials.RestHelper._convertSpatialRelationshipFromDotnetIndex(s);if(f)d.geometry=f;if(o)d.outSpatialReference=
o;if(j)d.text=j;if(l)d.where=l;i.run(d,e,function(h){(h=h?h.href:null)&&h.length>0&&a.dispatcher().handleOpenReportUrl(h,a);a.setValue("ResultUrl",h);a.completeActivity()},function(h,b){a.dispatcher().handleError(Error("Error running report '"+b.message+"'"),a)})}else a.dispatcher().handleError(Error("Cannot find report '"+f+"'"),a)};e.showDebug=function(a,h,c){var d=new b.forms.FormDefinition;d.maxHeight.set(600);d.maxWidth.set(500);var e;h?(d.title.set("Debug - Input Arguments for "+a.getDisplayName()),
d.containerFormItem.description.set("Input Arguments:"),e=a.getInputNames()):(d.title.set("Debug - Output Arguments for "+a.getDisplayName()),d.containerFormItem.description.set("Output Arguments:"),e=a.getOutputNames());if(e!=null&&e.length>0)for(var f=0;f<e.length;f++){var i=e[f],j;(j=h?a.getValue(i):a.getOutputValue(i))&&typeof j=="object"&&(j=h?a.getJsonValue(i):a.getOutputJsonValue(i));var l;!j||String(j).length<100&&String(j).indexOf("\n")==-1?l=new b.forms.items.TextBoxFormItem(null,d):(l=
new b.forms.items.TextAreaFormItem(null,d),l.textboxHeight.set(100));l.label=new b.forms.items.LabelFormItem(null,d);l.text.set(j);l.textboxWidth.set(300);l.label.text.set(i);l.readOnly.set(true);d.containerFormItem.formItems.addItem(l)}(a=a.dispatcher())&&typeof a._showDebugHandler=="function"?a._showDebugHandler(d,c):c&&c()};e.handlePrompt=function(a){var h=a.getValue("Description"),b=a.getValue("DefaultText"),h=prompt(h,b);a.setValue("Result",h);a.completeActivity()};e.handleCaptureGeometry=function(a){function h(h){var b;
switch(h){case 0:b=esri.toolbars.Draw.EXTENT;break;case 1:b=esri.toolbars.Draw.FREEHAND_POLYGON;break;case 2:b=esri.toolbars.Draw.FREEHAND_POLYLINE;break;case 3:b=esri.toolbars.Draw.LINE;break;case 4:b=esri.toolbars.Draw.POINT;break;case 5:b=esri.toolbars.Draw.MULTI_POINT;break;case 6:b=esri.toolbars.Draw.POLYGON;break;case 7:b=esri.toolbars.Draw.POLYLINE;break;case 8:var h=c.extent,o=e;d.deactivate();dojo.disconnect(o);a.setValue("Result",h);a.completeActivity();f=false;break;default:b=esri.toolbars.Draw.EXTENT}return b}
var b=a.getValue("CaptureType"),c=a.getEsriMap();if(c!=null){if(typeof esri.toolbars.Draw!="function")throw Error('dojo.require("esri.toolbars.draw") must be added to your client code to use CaptureGeometry activity.');var d=new esri.toolbars.Draw(c),e=dojo.connect(d,"onDrawEnd",dojo.hitch(e,function(h){var b=e;d.deactivate();dojo.disconnect(b);a.setValue("Result",h);a.completeActivity()})),f=true,b=h(b);f&&d.activate(b)}else throw Error("Capture Geometry: No map available.");};e.handleRefreshMap=
function(a){var h=a.getValue("MapServiceId");if(a.getEsriMap()!=null)for(var c=0;c<a.workflow().site.essentialsMap.mapServices.length;c++){var d=a.workflow().site.essentialsMap.mapServices[c];if(d!=null&&d.serviceLayer!=null&&(h==null||b.essentials.utilities.SiteResourceIdComparer.equals(d.id,h))&&typeof d.serviceLayer.refresh=="function")if(typeof d.serviceLayer.disableClientCaching=="boolean"){var e=d.serviceLayer.disableClientCaching;d.serviceLayer.disableClientCaching=true;d.serviceLayer.refresh();
d.serviceLayer.disableClientCaching=e}else d.serviceLayer.refresh()}else throw Error("Refresh Map: no map available.");a.completeActivity()};e.handleGetBrowserUrl=function(a){a.setValue("Url",window.location.href);a.completeActivity()};e.handleGetCurrentPosition=function(a){if(navigator.geolocation){var h={enableHighAccuracy:a.getValue("EnableHighAccuracy"),timeout:a.getValue("Timeout"),maximumAge:a.getValue("MaximumAge")};navigator.geolocation.getCurrentPosition(function(h){a.setValue("Latitude",
h.coords.latitude);a.setValue("Longitude",h.coords.longitude);a.setValue("Altitude",h.coords.altitude);a.setValue("Accuracy",h.coords.accuracy);a.setValue("AltitudeAccuracy",h.coords.altitudeAccuracy);a.setValue("Heading",h.coords.heading);a.setValue("Speed",h.coords.speed);a.setValue("Timestamp",h.timestamp);a.completeActivity()},function(h){a.setValue("ErrorCode",h.code);a.setValue("ErrorMessage",h.message);a.completeActivity()},h)}else a.setValue("ErrorCode",2),a.setValue("ErrorMessage","Geolocation is not supported."),
a.completeActivity()};e.handleGetMapExtent=function(a){var h=a.getEsriMap();if(h==null)throw Error("Get Map Extent: No map available.");a.setValue("Extent",h.extent);a.completeActivity()};e.handleGetMapInfo=function(a){var h=a.getEsriMap();if(h==null)throw Error("Get Map Info: No map available.");a.setValue("Extent",h.extent);a.setValue("Scale",esri.geometry.getScale(h));a.setValue("SpatialReference",h.spatialReference);a.setValue("Height",h.height);a.setValue("Width",h.width);a.completeActivity()};
e.handleGetPhoto=function(a){if(navigator.camera){var h={quality:a.getValue("Quality"),destinationType:a.getValue("DestinationType"),sourceType:a.getValue("SourceType"),allowEdit:a.getValue("AllowEdit"),encodingType:a.getValue("EncodingType"),targetWidth:a.getValue("TargetWidth"),targetHeight:a.getValue("TargetHeight")};navigator.camera.getPicture(function(h){a.setValue("ImageData",h);a.completeActivity()},function(h){a.setValue("Message",h);a.completeActivity()},h)}else a.setValue("Message","camera is not supported."),
a.completeActivity()};e.handleSetMapExtent=function(a){var h=a.getValue("Extent");if(h!=null){var b=a.getEsriMap();if(b!=null){if(!h.spatialReference||!h.spatialReference.wkid&&!h.spatialReference.wkt)h.spatialReference=b.spatialReference;a.getSite().essentialsMap.extentManager.setExtentWithPriority(h,10)}else throw Error("Set Map Extent: No map available.");}else throw Error("Set Map Extent: required Extent argument was not supplied.");a.completeActivity()};e.handleExternalDelay=function(a){var h=
a.getValue("Milliseconds");if(h!=null)setTimeout(function(){a.completeActivity()},h);else throw Error("External Delay: required Milliseconds argument was not supplied.");};e.handleWaitForGeoprocessorJobComplete=function(a){var h=a.getValue("GeoprocessorUrl");a.getValue("Token");a.getValue("ProxyURL");var c=a.getValue("UpdateDelay"),d=a.getValue("JobId"),e=false;if(!h)throw Error("GeoprocessorUrl parameter is missing.");if(!d)throw Error("JobId parameter is missing.");var f=new esri.tasks.Geoprocessor(h);
c>0&&f.setUpdateDelay(c);dojo.connect(f,"onError",function(){a.setValue("Result",b.workflow.DefaultActivityHandlers._getJobStatusCode(esri.tasks.JobInfo.STATUS_FAILED));a.completeActivity()});dojo.connect(f,"onStatusUpdate",function(h){if(!e)h=h.jobStatus,h==esri.tasks.JobInfo.STATUS_CANCELLED||h==esri.tasks.JobInfo.STATUS_DELETED||h==esri.tasks.JobInfo.STATUS_FAILED||h==esri.tasks.JobInfo.STATUS_SUCCEEDED||h==esri.tasks.JobInfo.STATUS_TIMED_OUT?(e=true,a.setValue("Result",b.workflow.DefaultActivityHandlers._getJobStatusCode(h)),
a.completeActivity()):window.setTimeout(function(){f.checkJobStatus(d)},c)});f.checkJobStatus(d)};e._getJobStatusCode=function(a){switch(a){case "esriJobNew":return 0;case "esriJobSubmitted":return 1;case "esriJobWaiting":return 2;case "esriJobExecuting":return 3;case "esriJobSucceeded":return 4;case "esriJobFailed":return 5;case "esriJobTimedOut":return 6;case "esriJobCancelling":return 7;case "esriJobCancelled":return 8;case "esriJobDeleting":return 9;case "esriJobDeleted":return 10;default:return-1}};
e.handleSetLayerDefinition=function(a){var h=a.getValue("MapServiceId"),b=a.getValue("LayerId"),d=a.getValue("LayerName"),e=a.getValue("Definition");if(!h)throw Error("Set Layer Definition: required MapServiceId argument was not supplied.");if(!b&&!d)throw Error("Set Layer Definition: a LayerId or a LayerName argument must be supplied.");var f=a.getSite();if(!f)throw Error("Set Layer Visibility: No site available.");var i=null,i=c(f,h);if(!i||!i.serviceLayer)throw Error("Set Layer Definition: Unable to find map service with ID '"+
h+"'");if(!b&&d)if(h=i.findLayerByName(d))b=h.id;else throw Error("Set Layer Definition: Unable to find layer with Name '"+d+"'.");if(i.serviceLayer instanceof esri.layers.ArcGISDynamicMapServiceLayer){if(!i.serviceLayer.layerDefinitions)i.serviceLayer.layerDefinitions=[];i.serviceLayer.layerDefinitions[parseInt(b)]=e;i.serviceLayer.setLayerDefinitions(i.serviceLayer.layerDefinitions,true)}else if(i.serviceLayer instanceof esri.layers.FeatureLayer)i.serviceLayer.setDefinitionExpression(e);else throw Error("Set Layer Definition: Map service type does not support layer definitions.");
a.completeActivity()};e.handleSetLayerProperty=function(a){var h=a.getValue("MapServiceId"),b=a.getValue("LayerId"),e=a.getValue("LayerName"),f=a.getValue("PropertyName"),k=a.getValue("Value");if(!h)throw Error("Set Layer Property: required MapServiceId argument was not supplied.");if(!b&&!e)throw Error("Set Layer Property: a LayerId or a LayerName argument must be supplied.");var i=a.getSite();if(!i)throw Error("Set Layer Property: No site available.");var j=null,j=c(i,h);if(!j||!j.serviceLayer)throw Error("Set Layer Property: Unable to find map service with ID '"+
h+"'");h=null;h=b?j.findLayerById(b):j.findLayerByName(e);if(!h)throw Error("Set Layer Property: Unable to find layer with Name '"+e+"' or ID '"+b+"'.");b=d(h,f);if(!b)throw Error("Set Layer Property: Layer does not support the property '"+f+"'.");h[b]=k;a.completeActivity()};e.handleGetLayerProperty=function(a){var h=a.getValue("MapServiceId"),b=a.getValue("LayerId"),e=a.getValue("LayerName"),f=a.getValue("PropertyName");if(!h)throw Error("Get Layer Property: required MapServiceId argument was not supplied.");
if(!b&&!e)throw Error("Get Layer Property: a LayerId or a LayerName argument must be supplied.");var k=a.getSite();if(!k)throw Error("Get Layer Property: No site available.");var i=null,i=c(k,h);if(!i||!i.serviceLayer)throw Error("Get Layer Property: Unable to find map service with ID '"+h+"'");h=null;h=b?i.findLayerById(b):i.findLayerByName(e);if(!h)throw Error("Get Layer Property: Unable to find layer with Name '"+e+"' or ID '"+b+"'.");b=d(h,f);if(!b)throw Error("Get Layer Property: Layer does not support the property '"+
f+"'.");a.setValue("Value",h[b]);a.completeActivity()};e.handleGetLayerVisibility=function(a){var h=a.getValue("MapServiceId"),b=a.getValue("LayerId"),d=a.getValue("LayerName"),e=a.getValue("EffectiveVisibility");if(!h)throw Error("Get Layer Visibility: required MapServiceId argument was not supplied.");if(!b&&!d)throw Error("Get Layer Visibility: a LayerId or a LayerName argument must be supplied.");var f=a.getSite();if(!f)throw Error("Get Layer Visibility: No site available.");var i=null,i=c(f,
h);if(!i)throw Error("Get Layer Visibility: Unable to find map service with ID '"+h+"'");f=null;b?f=i.findLayerById(b):d&&(f=i.findLayerByName(d));if(!f)throw Error("Get Layer Visibility: Unable to find layer with ID '"+b+"' in map service with ID '"+h+"'");h=f.isVisible();if(e&&(h=false,f.isVisible()&&i.isVisible()&&f.withinScaleRange(null))){e=i.getVisibleLayers();for(i=0;i<e.length;i++)if(e[i]==f.id){h=true;break}}a.setValue("Visible",h);a.completeActivity()};e.handleSetLayerVisibility=function(a){var b=
a.getValue("MapServiceId"),d=a.getValue("LayerId"),e=a.getValue("LayerName"),f=a.getValue("Visible");if(!b)throw Error("Set Layer Visibility: required MapServiceId argument was not supplied.");if(!d&&!e)throw Error("Set Layer Visibility: a LayerId or a LayerName argument must be supplied.");if(f===null)throw Error("Set Layer Visibility: required Visible argument was not supplied.");var k=a.getSite();if(!k)throw Error("Set Layer Visibility: No site available.");var i=null,i=c(k,b);if(!i)throw Error("Set Layer Visibility: Unable to find map service with ID '"+
b+"'");k=null;if(d){if(k=i.findLayerById(d),!k)throw Error("Set Layer Visibility: Unable to find layer with ID '"+d+"' in map service with ID '"+b+"'");}else if(e){if(k=i.findLayerByName(e),!k)throw Error("Set Layer Visibility: Unable to find layer with name '"+e+"' in map service with ID '"+b+"'");}else throw Error("Set Layer Visibility: must define layer ID or name");k.setVisibility(f);a.completeActivity()};e.handleSetMapServiceVisibility=function(g){var b=g.getValue("MapServiceId"),d=g.getValue("Visible");
if(b==null)throw Error("Set Map Service Visibility: required MapServiceId argument was not supplied.");if(d==null)throw Error("Set Map Service Visibility: required Visible argument was not supplied.");var e=g.getEsriMap(),f=g.getSite();if(e==null)throw Error("Set Map Service Visibility: No map available.");var k=null,k=a(e,b);if(k==null)throw Error("Set Map Service Visibility: Unable to find map service with ID '"+b+"'");k.setVisibility(d);g.completeActivity();f&&b&&(g=c(f,b),dojo.publish("MapServiceVisibilityChangedEvent",
g))};e.handleGetMapServiceInfo=function(g){if(!g)throw Error("Get Map Service Info: required context was not supplied.");var b=g.getValue("MapServiceId"),d=g.getValue("LayerName");if(b==null)throw Error("Get Map Service Info: required MapServiceId argument was not supplied.");var e=null,f=null,k=null,i=null,j=g.getEsriMap();if(j==null)throw Error("Get Map Service Info: No map available.");var l=g.getSite(),m=null;if(l!=null&&l.essentialsMap!=null&&(l=c(l,b),l!=null))m=l.serviceLayer,e=l.serviceUrl,
f=l.findServiceToken();if(m==null&&(m=a(j,b)))e=m.url;if(m==null)throw Error("Get Map Service Info: Unable to find map service with ID '"+b+"'");if(d!=null){b=false;if(m.supportsDynamicLayers&&m.dynamicLayerInfos){j=m.dynamicLayerInfos;for(l=0;l<j.length;l++){var q=j[l];if(q.name===d||q.id===d){b=true;k="dynamicLayer";i=q.source;break}}}if(!b&&m.layerInfos){j=m.layerInfos;for(l=0;l<j.length;l++)if(q=j[l],q!=null&&q.id!=null&&q.name==d){k=q.id;break}}}g.setValue("MapServiceUrl",e);g.setValue("Token",
f);g.setValue("LayerId",k);g.setValue("Source",i);g.completeActivity()};e.handleUpdateGraphicsLayer=function(g){var b=g.getValue("GraphicsLayerId"),c=!!g.getValue("RemoveAllFeatures"),d=g.getValue("FeatureSet"),e=g.getValue("RendererJson"),f=g.getEsriMap();if(f==null)throw Error("Update Graphics Layer: No map available.");var i=false,j=a(f,b);if(j){if(!(j instanceof esri.layers.GraphicsLayer))throw Error("Update Graphics Layer: The layer '"+b+"' is not a GraphicsLayer");}else j=new esri.layers.GraphicsLayer({id:b}),
i=true;try{j.suspend();c&&j.clear();if(d&&d.features)for(var l=d.features.length-1;l>=0;--l)j.add(d.features[l]);if(e)j.renderer=esri.renderer.fromJson(JSON.parse(e));i&&f.addLayer(j)}finally{j.resume()}g.completeActivity()}})(f.DefaultActivityHandlers||(f.DefaultActivityHandlers={}))})(b.workflow||(b.workflow={}))})(geocortex||(geocortex={}));
(function(b){(function(b){var e=function(){function b(c,a,g,h){this.runtimeTypeName=null;this.name=c||null;this.typeName=a||null;this.isRequired=!!g;this.value=h||null}b.prototype._configureObject=function(b){if(typeof b.name=="undefined"||typeof b.typeName=="undefined")throw Error("Incorrect argument info object returned from initialization");this.name=b.name;this.typeName=b.typeName;this.isRequired=b.isRequired;this.value=b.value;this.runtimeTypeName=b.runtimeTypeName};b.prototype._internalClone=
function(){var c=new b(this.name,this.typeName,this.isRequired,dojo.clone(this.value));c.runtimeTypeName=dojo.clone(this.runtimeTypeName);return c};return b}();b.ArgumentInfo=e})(b.workflow||(b.workflow={}))})(geocortex||(geocortex={}));
(function(b){(function(f){var e=function(){function d(b,a,g,h,d,e,f,k,i){this.debug=false;this.id=b||null;this.displayName=a||null;this.typeName=g||null;this.instanceId=h||null;this.externalId=d||null;this.syncToken=e||null;this.isComplete=f||false;this.inputs=k||[];this.outputs=i||[]}d.prototype._configureObject=function(c){if(typeof c.id=="undefined"||typeof c.displayName=="undefined"||typeof c.typeName=="undefined"||typeof c.instanceId=="undefined")throw Error("Incorrect external activity info object returned from initialization");
this.id=c.id;this.displayName=c.displayName;this.typeName=c.typeName;this.instanceId=c.instanceId;this.externalId=c.externalId;this.syncToken=c.syncToken;this.isComplete=c.isComplete;if(c.debug)this.debug=c.debug;this.inputs=[];this.outputs=[];var a;if(c.inputs)for(a=0;a<c.inputs.length;a++){var g=c.inputs[a],h=new b.workflow.ArgumentInfo;h._configureObject(g);this.inputs[a]=h}if(c.outputs)for(a=0;a<c.outputs.length;a++)g=c.outputs[a],h=new b.workflow.ArgumentInfo,h._configureObject(g),this.outputs[a]=
h};return d}();f.ExternalActivityInfo=e})(b.workflow||(b.workflow={}))})(geocortex||(geocortex={}));(function(b){(function(b){var e=function(){return function(b,c,a,g,h,o){this.instanceId=b;this.status=c;this.pendingExternalActivities=a;this.outputs=g;this.workflowData=h;this.instanceData=o}}();b._WorkflowState=e})(b.workflow||(b.workflow={}))})(geocortex||(geocortex={}));
(function(b){(function(b){(function(b){function d(a,b,c){return a==null||b==null?c:a.isWebMercator&&b.isWebMercator&&a.isWebMercator()&&b.isWebMercator()?true:a.wkid!==b.wkid?false:a.wkid>0?true:a.wkt.toLowerCase()==b.wkt.toLowerCase()}function c(a){var b=a.rings[0][0],c=a.rings[0][1],d=null,a=a.rings[0].slice(2,a.rings[0].length);a.push(b);for(var e=0;e<a.length;++e){var f=a[e],b=this.crossProduct(f,b,c);if(b>0&&d===true||b<0&&d===false)return false;d=b>0;b=c;c=f}return true}function a(a,b,c){c||
(c=[0,0]);return(a[0]-c[0])*(b[1]-c[1])-(a[1]-c[1])*(b[0]-c[0])}b.spatialRefsAreEqual=d;b.envelopesAreEqual=function(a,b){return a==null||b==null?a==null&&b==null:d(a.spatialReference,b.spatialReference)&&a.xmin==b.xmin&&a.ymin==b.ymin&&a.xmax==b.xmax&&a.ymax==b.ymax};b.getExtent=function(a){for(var b=new esri.geometry.Extent(Number.MAX_VALUE,Number.MAX_VALUE,Number.MIN_VALUE,Number.MIN_VALUE),c=0;c<a.length;++c){var d=a[c].getExtent();b.xmin=Math.min(d.xmin,b.xmin);b.ymin=Math.min(d.ymin,b.ymin);
b.xmax=Math.min(d.xmax,b.xmax);b.xmax=Math.min(d.ymax,b.ymax)}return b};b.envelopeToPolygon=function(a){var b=new esri.geometry.Polygon(a.spatialReference);b.addRing([[a.xmin,a.ymin],[a.xmin,a.ymax],[a.xmax,a.ymax],[a.xmax,a.ymin],[a.xmin,a.ymin]]);return b};b.isValidGeometry=function(g){if(g.type!="polygon")return true;if(g.rings.length==0||g.rings.length<3)return true;if(c(g)){var b=g.rings[0][0],d=g.rings[0][1],g=g.rings[0].slice(2,g.rings[0].length);g.push(b);for(var e=0;e<g.length;++e){var f=
g[e];if(a(b,f,d)>0)return true;b=d;d=f}return false}else{for(d=b=0;d<g.rings.length;++d)for(var f=g.rings[d],k=0,e=0;e<f.length;++e)k=(e+1)%f.length,b+=f[e][0]*-f[k][1],b-=-f[e][1]*f[k][0];return b>0}};b.isSelfIntersectingPolygon=function(a){return esri.geometry.polygonSelfIntersecting(a)};b.isConvex=c;b.pointInEnvelope=function(a,b){if(!this.spatialRefsAreEqual(a.spatialReference,b.spatialReference,true))throw Error("Mismatched spatial references.");return a.x<b.xmin||a.x>b.xmax?false:a.y<b.ymin||
a.y>b.ymax?false:true};b.clipEnvelope=function(a,b){if(!this.spatialRefsAreEqual(a.spatialReference,b.spatialReference,true))throw Error("Mismatched spatial references.");var c=new esri.geometry.Extent(a.xmin,a.ymin,a.xmax,a.ymax);c.xmin=a.xmin<b.xmin?b.xmin:a.xmin>b.xmax?b.xmax:a.xmin;c.xmin=a.ymin<b.ymin?b.ymin:a.ymin>b.ymax?b.ymax:a.ymin;c.xmin=a.xmax<b.xmin?b.xmin:a.xmax>b.xmax?b.xmax:a.xmax;c.xmin=a.ymax<b.ymin?b.ymin:a.ymax>b.ymax?b.ymax:a.ymax;return c};b.scaleEnvelope=function(a,b,c){return new esri.geometry.Extent(a.xmin*
b,a.ymin*c,a.xmax*b,a.ymax*c,a.spatialReference)};b.scaleEnvelopeWithoutTranslation=function(a,b){if(a==null)return null;var c=a.getCenter();return new esri.geometry.Extent(c.x-a.getWidth()*(b/2),c.y-a.getHeight()*(b/2),c.x+a.getWidth()*(b/2),c.y+a.getHeight()*(b/2),a.spatialReference)};b.computeDistance=function(a,b){var c=b.x-a.x,d=b.y-a.y;return Math.sqrt(c*c+d*d)};b.translateEnvelope=function(a,b,c){return new esri.geometry.Extent(a.xmin+b,a.ymin+c,a.xmax+b,a.ymax+c,a.spatialReference)};b.length=
function(a){return Math.sqrt(a.x*a.x+a.y*a.y)};b.normalize=function(a){var b=this.length(a);return new esri.geometry.Point(a.x/b,a.y/b)};b.angle=function(a,b){if(!this.spatialRefsAreEqual(a.spatialReference,b.spatialReference,true))throw Error("Mismatched spatial references");return Math.acos(this.dotProduct(a,b)/Math.sqrt(this.dotProduct(a,a)*this.dotProduct(b,b)))};b.crossProduct=function(a,b,c){if(!this.spatialRefsAreEqual(a.spatialReference,b.spatialReference,true))throw Error("Mismatched spatial references");
c||(c=new esri.geometry.Point(0,0));return(a.x-c.x)*(b.y-c.y)-(a.y-c.y)*(b.x-c.x)};b.crossProductArray=a;b.dotProduct=function(a,b){if(!this.spatialRefsAreEqual(a.spatialReference,b.spatialReference,true))throw Error("Mismatched spatial references");return a.x*b.x+a.y*b.y};b.polygonMidpoint=function(a){if(a.length==0)throw Error("Expected at least one point in polygonMidPoint.");for(var b=0,c=0,d=0;d<a.length;++d){var e=a[d];b+=e.x;c+=e.y}b/=a.length;c/=a.length;return new esri.geometry.Point(b,c,
a[0].spatialReference)}})(b.GeometryUtilities||(b.GeometryUtilities={}))})(b.essentials||(b.essentials={}))})(geocortex||(geocortex={}));
(function(b){(function(b){var e=function(){function b(){}b.processClientSideTokens=function(c,a){var g="";if(a!==""){var h="";if(c)h=c.url;var g=b._replaceToken("SiteRestUrl",a,h),g=b._replaceToken("VirtualDirectoryUrl",g,h+"/virtualdirectory"),o=window.location.href.substring(0,window.location.href.lastIndexOf("/")),g=b._replaceToken("HostUri",g,o),h=h.substring(0,h.lastIndexOf("/sites/"))+"/virtualdirectory",g=b._replaceToken("RestVirtualDirectoryUrl",g,h)}return g};b.validateDynamicDefinition=
function(c){if(!c||!c.trim())throw Error("The JSON string cannot be null, empty nor merely whitespace!");if(c=b.getJsonObjectFromJsonString(c)){if(c.source==null)throw"The source is required!";if(c.source.type==null)throw"The type is required!";if(c.source.type=="mapLayer"){if(c.source.mapLayerId==null)throw"The mapLayerId is required for the mapLayer type!";}else if(c.source.type=="dataLayer"){if(c.source.dataSource==null)throw"The dataSource is required for the dataLayer type!";}else throw"The type '"+
c.source.type.toString()+"' is not supported!";}};b.getJsonObjectFromJsonString=function(b){return dojo.fromJson(b)};b.getLayerSourceFromJsonObject=function(b){if(b.type=="mapLayer")return new esri.layers.LayerMapSource(b);else{var a=new esri.layers.LayerDataSource;switch(b.dataSource.type){case "table":a.dataSource=new esri.layers.TableDataSource(b.dataSource);break;case "queryTable":a.dataSource=new esri.layers.QueryDataSource(b.dataSource);break;case "raster":a.dataSource=new esri.layers.RasterDataSource(b.dataSource);
break;case "joinTable":a.dataSource=new esri.layers.JoinDataSource(b.dataSource);break;default:throw"The type '"+b.type.toString()+"' not supported!";}return a}};b.getDynamicLayerInfoFromJson=function(c,a){var g;b.validateDynamicDefinition(c);var h=b.getJsonObjectFromJsonString(c);if(h){g=new esri.layers.DynamicLayerInfo;if(h.id)g.id=h.id;else if(a!=null)g.id=parseInt(a,10);else throw"The Layer's ID is missing or invalid!";g.source=this.getLayerSourceFromJsonObject(h.source);if(h.minScale!=null)g.minScale=
h.minScale;if(g.minScale<=0)g.minScale=Infinity;if(h.maxScale!=null)g.maxScale=h.maxScale}return g};b.getLayerDrawingOptionsFromJson=function(c){var a;b.validateDynamicDefinition(c);if((c=b.getJsonObjectFromJsonString(c))&&c.drawingInfo){c=dojo.clone(c.drawingInfo);a=new esri.layers.LayerDrawingOptions;switch(c.renderer.type){case "simple":dojo.clone(a.renderer);a.renderer=new esri.renderer.SimpleRenderer(c.renderer);break;case "uniqueValue":a.renderer=new esri.renderer.UniqueValueRenderer(c.renderer);
break;case "classBreaks":a.renderer=new esri.renderer.ClassBreaksRenderer(c.renderer);break;default:throw"The type '"+c.renderer.type.toString()+"' not supported!";}a.transparency=c.transparency;a.scaleSymbols=c.scaleSymbols;a.showLabels=c.showLabels}return a};b._replaceToken=function(b,a,g){return!a?a:a.replace("{"+b+"}",g)};b._createRestParametersFromQuery=function(c){var a={};if(c)a=c.toJson(),a.spatialRel=b._convertSpatialRelationshipToDotnet(a.spatialRel);return a};b._convertSpatialRelationshipToDotnet=
function(b){switch(b){case esri.tasks.Query.SPATIAL_REL_CONTAINS:return"esriSpatialRelContains";case esri.tasks.Query.SPATIAL_REL_CROSSES:return"esriSpatialRelCrosses";case esri.tasks.Query.SPATIAL_REL_ENVELOPEINTERSECTS:return"esriSpatialRelEnvelopeIntersects";case esri.tasks.Query.SPATIAL_REL_INDEXINTERSECTS:return"esriSpatialRelIndexIntersects";case esri.tasks.Query.SPATIAL_REL_INTERSECTS:return"esriSpatialRelIntersects";case esri.tasks.Query.SPATIAL_REL_OVERLAPS:return"esriSpatialRelOverlaps";
case esri.tasks.Query.SPATIAL_REL_RELATION:return"esriSpatialRelRelation";case esri.tasks.Query.SPATIAL_REL_TOUCHES:return"esriSpatialRelTouches";case esri.tasks.Query.SPATIAL_REL_WITHIN:return"esriSpatialRelWithin"}throw Error("Unknown rel: "+b);};b._convertSpatialRelationshipFromDotnetIndex=function(b){switch(b){case 1:return esri.tasks.Query.SPATIAL_REL_CONTAINS;case 2:return esri.tasks.Query.SPATIAL_REL_CROSSES;case 3:return esri.tasks.Query.SPATIAL_REL_ENVELOPEINTERSECTS;case 4:return esri.tasks.Query.SPATIAL_REL_INDEXINTERSECTS;
case 0:return esri.tasks.Query.SPATIAL_REL_INTERSECTS;case 5:return esri.tasks.Query.SPATIAL_REL_OVERLAPS;case 8:return esri.tasks.Query.SPATIAL_REL_RELATION;case 6:return esri.tasks.Query.SPATIAL_REL_TOUCHES;case 7:return esri.tasks.Query.SPATIAL_REL_WITHIN}throw Error("Unknown rel: "+b);};b.tokenDurationMinutes=20;return b}();b.RestHelper=e})(b.essentials||(b.essentials={}))})(geocortex||(geocortex={}));
(function(b){(function(f){var e=function(){return function(d,c){this.encodeUriReplacementValues=d.encodeUriReplacementValues;this.target=d.target;this.text=d.text;this.toolTip=d.toolTip;var a=null;if(c&&c.mapService&&c.mapService.essentialsMap)a=c.mapService.essentialsMap.site;this.uri=b.essentials.RestHelper.processClientSideTokens(a,d.uri);this.iconUri=b.essentials.RestHelper.processClientSideTokens(a,d.iconUri);this.layer=c}}();f.FeatureHyperlink=e})(b.essentials||(b.essentials={}))})(geocortex||
(geocortex={}));(function(b){(function(b){var e=function(){return function(b,c){this.name=b;this.type=c}}();b.DistanceUnit=e})(b.essentials||(b.essentials={}))})(geocortex||(geocortex={}));
(function(b){b=b.essentials||(b.essentials={});b=b.DistanceUnitType||(b.DistanceUnitType={});b.OTHER="Other";b.INCHES="Inches";b.FEET="Feet";b.US_SURVEY_FEET="USSurveyFeet";b.YARDS="Yards";b.MILES="Miles";b.NAUTICAL_MILES="NauticalMiles";b.MILLIMETERS="Millimeters";b.CENTIMETERS="Centimeters";b.DECIMETERS="Decimeters";b.METERS="Meters";b.KILOMETERS="Kilometers";b.DEGREES="Degrees";b.RADIANS="Radians";b.GRADS="Grads"})(geocortex||(geocortex={}));
(function(b){(function(f){var e=function(d){function c(a){d.call(this,a);this.initialExtent=this.fullExtent=null;this.mapServices=[];this.primaryMapService=null;this.supportedExportFormats=["BMP","JPEG","PNG","TIFF"];this.units=null;this.serviceLayersAdded=false;this.extentManager=null;this.setExtentOnLoad=true;this._onExportError=this._onExportComplete=this._esriMap=null}__extends(c,d);c.prototype.getMap=function(){return this._esriMap};c.prototype.filteredLayers=function(){for(var a=[],b=0;b<this.mapServices.length;b++)for(var c=
this.mapServices[b],d=0;d<c.layers.length;d++)a.push(c.layers[d]);return a};c.prototype.loadServiceLayersInMap=function(a){if(!a)throw Error("Must supply a map");this._esriMap=a;if(this.initialExtent&&this.initialExtent.spatialReference&&!a.spatialReference)a.spatialReference=this.initialExtent.spatialReference;this.extentManager=new f.ExtentManager(a,this.initialExtent);for(var b=0;b<this.mapServices.length;b++){var c=this.mapServices[b],d=c.serviceLayer;d&&(this.extentManager.registerLayer(d),d.loaded?
(this._layerLoadedUpdate(a),c._handleServiceLayerLoaded(d),c._handleDynamicLayers(d)):(dojo.connect(d,"onLoad",dojo.hitch(this,"_layerLoadedUpdate",a)),dojo.connect(d,"onError",dojo.hitch(this,"_layerLoadedUpdate",a))))}this.setExtentOnLoad&&this.extentManager.firstResize()};c.prototype.calculateScale=function(){return esri.geometry.getScale(this.site.getMap())};c.prototype._addServiceLayers=function(a){for(var b=this.mapServices.length-1;b>=0;b--){var c=this.mapServices[b];if(b===this.mapServices.length-
1&&a.spatialReference&&c.serviceLayer instanceof esri.layers.TiledMapServiceLayer){var d=c.serviceLayer;if(!d.spatialReference||!d.spatialReference.wkid||d.spatialReference.wkid<=0)d.spatialReference=a.spatialReference}a.addLayer(c.serviceLayer)}if(this.site!==null&&dojo.isObject(this.site)&&dojo.isFunction(this.site.onServiceLayersLoaded))this.site.onServiceLayersLoaded(this.site)};c.prototype._configureMapServices=function(a,g){var c,d,e;for(d=0;a&&d<a.length;d++){c=a[d];e=this.url+"/mapservices/"+
c.id;if(c.drawingBehavior==b.essentials.DrawingBehavior.FEATURE_LAYER){if(!dojo.isObject(esri.layers.FeatureLayer))throw Error("This Javascript application must // dojo.require the esri.layers.FeatureLayer package in order to use a site with feature layers");this.mapServices[d]=new b.essentials.FeatureLayerService(e)}else if(c.drawingBehavior==b.essentials.DrawingBehavior.GeoRSS_LAYER){if(!dojo.isObject(esri.layers.GraphicsLayer))throw Error("This Javascript application must // dojo.require the esri.layers.GraphicsLayer package in order to use a site with GeoRSS layers");
this.mapServices[d]=new b.essentials.GeoRssLayerService(c.connectionString)}else this.mapServices[d]=new b.essentials.MapService(e);this.mapServices[d].essentialsMap=this;this.mapServices[d]._configureObject(c,g)}};c.prototype._configureObject=function(a,g){if(a===void 0||a.mapServices===void 0)throw Error("Incorrect map object returned from initialization");if(a.initialExtent)this.initialExtent=new esri.geometry.Extent(a.initialExtent);if(a.fullExtent)this.fullExtent=new esri.geometry.Extent(a.fullExtent);
if(a.units)this.units=new b.essentials.DistanceUnit(a.units.name,a.units.type);this._configureMapServices(a.mapServices,g);if(g)this.isInitialized=true;this.primaryMapService=this.findMapServiceById(a.primaryMapServiceID)};c.prototype.findMapServiceById=function(a){for(var b=0;b<this.mapServices.length;b++)if(this.mapServices[b].id==a)return this.mapServices[b];return null};c.prototype.setFeatureLayerExclusivelyVisible=function(a){for(var b=this.site.getFeatureServices(),c=0;c<b.length;c++){var d=
b[c];d.setVisibility(d.serviceLayer.id===a.id)}};c.prototype.exportMap=function(a,g,c){try{this._onExportComplete=g;this._onExportError=c;var d=this.url+"/export",g={},e=c=null;if(this.site)c=this.site.getMap(),e=this.site.essentialsMap;a&&a.toJson&&(g=a.toJson(c,e));g.symbols&&this._adjustTextSymbols(g.symbols);var f=b.encodeJson(dojo.mixin({f:"json"},g));if(f.graphics&&f.symbols)f.graphics='{"layers":'+f.graphics+', "symbols":'+f.symbols+"}",f.symbols=null}catch(k){this._exportRestError(k);return}b.request({url:d,
content:f,load:dojo.hitch(this,this._exportRestComplete),error:dojo.hitch(this,this._exportRestError),callbackParamName:"CallBack"})};c.prototype._adjustTextSymbols=function(a){for(var b in a)a[b].declaredClass==="esri.symbol.TextSymbol"&&(a[b].yoffset+=parseInt(a[b].font.size,10)*1.2)};c.prototype._exportRestComplete=function(a){var b=null;if(a){if(a.error)b=a.error}else b=Error("No results");b&&this._onExportComplete&&this._onExportError(b);a&&this._onExportComplete&&this._onExportComplete(a)};
c.prototype._exportRestError=function(a){this._onExportError&&this._onExportError(a)};c.prototype._layerLoadedUpdate=function(a){if(!this.serviceLayersAdded){for(var b=0;b<this.mapServices.length;b++){var c=this.mapServices[b];if(!c.serviceLayer.loaded&&!c.initializationFailure)return}this.serviceLayersAdded=true;this._addServiceLayers(a)}};return c}(f.AsyncInitializable);f.Map=e})(b.essentials||(b.essentials={}))})(geocortex||(geocortex={}));
(function(b){(function(b){var e=function(){return function(b,c){this.displayName=b;this.scale=c}}();b.Scale=e})(b.essentials||(b.essentials={}))})(geocortex||(geocortex={}));(function(b){(function(b){var e=function(){return function(b,c){if(b!==void 0)this.displayName=b;if(c!==void 0)this.dpi=c}}();b.Resolution=e})(b.essentials||(b.essentials={}))})(geocortex||(geocortex={}));
(function(b){(function(f){var e=function(){function d(){this.customExtent=null;this.extentType="currentExtent";this.fields=[];this.scale=this.resolution=this.outputFormat=this.notificationEmailAddress=this.grid=null}d.prototype.toJson=function(c,a){if(!c||!a)throw Error("Reporting parameter creation is missing a main map.");var g={},h,d;if(this.extentType==b.essentials.ReportParameters.CURRENT_EXTENT&&c!==null)h=c.extent;else if(this.extentType==b.essentials.ReportParameters.FULL_EXTENT&&a!==null)h=
a.fullExtent;else if(this.extentType==b.essentials.ReportParameters.INITIAL_EXTENT&&a!==null)h=a.initialExtent;else if(this.extentType==b.essentials.ReportParameters.CUSTOM_EXTENT&&this.customExtent!==null)h=this.customExtent;if(h){if(h.spatialReference&&(d=h.spatialReference.toJson()))if(d.wkid&&d.wkid>0)g.bboxSR=d.wkid;else if(d.wkt)g.bboxSR=d.wkt;g.bbox=h.xmin+","+h.ymin+","+h.xmax+","+h.ymax}if(this.targetSpatialReference&&(d=this.targetSpatialReference.toJson()))if(d.wkid&&d.wkid>0)g.targetSR=
d.wkid;else if(d.wkt)g.targetSR=d.wkt;if(this.notificationEmailAddress)g.emailAddress=this.notificationEmailAddress;if(this.imageHeight&&this.imageHeight>0)g.imageHeight=this.imageHeight;if(this.imageWidth&&this.imageWidth>0)g.imageWidth=this.imageWidth;if(c.timeExtent)g.time="",g.time+=c.timeExtent.startTime?c.timeExtent.startTime.getTime():"null",g.time+=",",g.time+=c.timeExtent.endTime?c.timeExtent.endTime.getTime():"null";d=[];if(a!==null){var e="",f="",k="";for(h=0;h<a.mapServices.length;h++){var i=
a.mapServices[h],j="",l=i.serviceLayer,m,q="";if(l)if(l.visible===true&&(f+=(f===""?"":";")+i.id+":"+l.opacity),i.mapServiceType===b.essentials.MapServiceType.DYNAMIC){m=l.layerDefinitions;var r=0,s;for(s in m)r>0&&(q+=","),q+='"'+s+'":"'+m[s].replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"',r++;r>0&&(k.length>1&&(k+=","),k+='"'+i.id+'":{',k+=q,k+="}");if(l.visible===true)if(l instanceof esri.layers.ArcGISDynamicMapServiceLayer)m=l,m.visibleLayers&&m.visibleLayers.toString()!=="-1"&&(j=m.visibleLayers.toString());
else if(!i.layers||i.layers.length===0)j="*";else if(i.layers&&i.layers.length>0)for(m=0;m<i.layers.length;m++)q=i.layers[m],q.isVisible()&&q.areAllAncestorsVisible()&&(j+=(j.length===0?"":",")+q.id)}else if(l.visible===true)if(!i.layers||i.layers.length===0)j="*";else if(i.layers&&i.layers.length>0)for(m=0;m<i.layers.length;m++)q=i.layers[m],q.isVisible()&&q.areAllAncestorsVisible()&&(j+=(j.length===0?"":",")+q.id);m=i.id;m+=j.length===0?"(hide:*)":"(show:"+j+")";e+=(e.length===0?"":";")+m;if(i instanceof
b.essentials.FeatureLayerService){j={};j.id=i.id;if((m=l.getSelectionSymbol())&&m.color)m=m.color.toRgba(),j.selectionColor={r:m[0],g:m[1],b:m[2],a:m[3]};j.mode=i.queryMode;if(i=l.getDefinitionExpression())j.where=i;if(l.renderer)j.renderer=l.renderer.toJson();j.selectedFeatures=[];if((i=l.getSelectedFeatures())&&i.length>0)if(l=l.objectIdField)for(m=0;m<i.length;m++)q=i[m],q.attributes&&(q=q.attributes[l])&&j.selectedFeatures.push(q);d.push(j)}}if(k.length>0)g.layerDefinitions="{"+k+"}";if(e.length>
0)g.layers=e;if(f.length>0)g.opacity=f}if(d.length>0)g.featureLayerOptions=d;if(this.scale)g.scale=this.scale.scale;if(this.outputFormat)g.outputFormat=this.outputFormat;if(this.resolution)g.dpi=this.resolution.dpi;if(this.mapGraphicsLayers)g.graphics=this.mapGraphicsLayers.layers,g.symbols=this.mapGraphicsLayers.symbols;for(s=0;s<this.fields.length;s++)h=this.fields[s],g[h.id]=h.value;if(this.grid)g.grid=this.grid.id;return g};d.prototype.populateMapGraphicsLayers=function(b){this.mapGraphicsLayers=
{layers:[],symbols:[]};this._extractGraphicInformation(b.graphics,this.mapGraphicsLayers.layers,this.mapGraphicsLayers.symbols);for(var a=0;a<b.graphicsLayerIds.length;a++){var g=b.getLayer(b.graphicsLayerIds[a]);g.visible&&!(g instanceof esri.layers.FeatureLayer)&&this._extractGraphicInformation(g,this.mapGraphicsLayers.layers,this.mapGraphicsLayers.symbols)}};d.prototype._extractGraphicInformation=function(b,a,g){for(var h=0;h<b.graphics.length;h++){var d={},e=b.graphics[h],f;for(f in g)if(e.symbol&&
g[f]==e.symbol){d.symbolID=""+f;e.symbol.id=d.symbolID;break}if(d.symbolID===void 0){d.symbolID=""+g.length;if(e.symbol===null||e.symbol===void 0)if(b.renderer&&b.renderer.getSymbol)g.push(b.renderer.getSymbol(e));else continue;else g.push(e.symbol);g[d.symbolID].id=d.symbolID}d.geometry=e.geometry;a.push({elements:[d],opacity:b.opacity})}};d.CURRENT_EXTENT="currentExtent";d.CUSTOM_EXTENT="customExtent";d.FULL_EXTENT="fullExtent";d.INITIAL_EXTENT="initialExtent";return d}();f.ReportParameters=e})(b.essentials||
(b.essentials={}))})(geocortex||(geocortex={}));
(function(b){(function(f){var e=function(d){function c(a){d.call(this,a);this.displayName=this.description=null;this.extensions=[];this.id=null;this.visible=false;this.layer=null;this.properties={};this.supportedMapScales=[];this.supportedOutputFormats=[];this.supportedResolutions=[];this.textFields=[];this._running=false;this._onRunReportError=this._onRunReportComplete=null}__extends(c,d);c.prototype.isRunning=function(){return this._running};c.prototype.run=function(a,g,c,d){if(this.isRunning())d&&
d(Error("Report already running"));else{this._running=true;try{this._onRunReportComplete=c;this._onRunReportError=d;var e=this.layer,f=this.url+"/run",c={},d={},k=null,i=null;if(e!==null&&e.mapService!==null&&e.mapService.essentialsMap!==null&&e.mapService.essentialsMap.site!==null)var j=e.mapService.essentialsMap.site,k=j.getMap(),i=j.essentialsMap;c=g.toJson(k,i);a!==null&&(d=b.essentials.RestHelper._createRestParametersFromQuery(a));var l=b.encodeJson(dojo.mixin({f:"json"},c,d))}catch(m){this._runRestError(m);
return}b.request({url:f,load:dojo.hitch(this,this._runRestComplete),content:l,error:dojo.hitch(this,this._runRestError),callbackParamName:"CallBack"})}};c.prototype._configureObject=function(a,g){if(a.id===void 0||a.displayName===void 0)throw Error("Incorrect report object returned from initialization");this.id=a.id;this.visible=a.visible===void 0?true:a.visible;this.supportedOutputFormats=a.supportedOutputFormats;this.supportedResolutions=a.supportedResolutions;this.supportedMapScales=a.supportedScales;
this.textFields=a.textFields;this.description=a.description;this.displayName=a.displayName;if(g)this.isInitialized=true;this.properties=b._getProperties(a.properties);this.extensions=b._getExtensions(a.extensions)};c.prototype._runRestComplete=function(a){this._running=false;var b=null;if(a){if(a.error)b=a.error}else b=Error("No results");b&&this._onRunReportError&&this._onRunReportError(b);a&&this._onRunReportComplete&&this._onRunReportComplete(a)};c.prototype._runRestError=function(a){this._running=
false;this._onRunReportError&&this._onRunReportError(a)};return c}(f.AsyncInitializable);f.Report=e})(b.essentials||(b.essentials={}))})(geocortex||(geocortex={}));(function(b){b=b.essentials||(b.essentials={});b=b.ReportType||(b.ReportType={});b.LAYER_TEMPLATE_REPORT="Layer Template Report";b.MAP_TEMPLATE_REPORT="Map Template Report"})(geocortex||(geocortex={}));
(function(b){(function(b){var e=function(){function b(){}b.UNKNOWN=0;b.FEATURE_LAYER=1;b.RASTER_LAYER=2;b.GROUP_LAYER=3;b.GEO_RSS_LAYER=4;return b}();b.LayerType=e})(b.essentials||(b.essentials={}))})(geocortex||(geocortex={}));
(function(b){(function(b){var e=function(){return function(b){this.alias=b.alias;this.dataType=b.dataType;this.displayName=b.displayName;this.focusField=!!b.focusField;this.hyperlinkLabel=b.hyperlinkLabel;this.name=b.name;this.searchable=!!b.searchable;this.visible=!!b.visible}}();b.Field=e})(b.essentials||(b.essentials={}))})(geocortex||(geocortex={}));
(function(b){(function(f){var e=function(d){function c(a){d.call(this,a);this.displayName=null;this.extensions=[];this.visible=this.id=null;this.isOneToOne=false;this.layer=null;this.parameters=[];this.properties={};this._dataLinking=false;this._onDataLinkingError=this._onDataLinkingComplete=null}__extends(c,d);c.prototype.isDataLinking=function(){return this._dataLinking};c.prototype.performDataLinking=function(a,g,c){if(!a&&this.parameters.length>0)c&&c(Error("No FeatureSetParameters provided"));
else if(this.isDataLinking())c&&c(Error("Currently performing data linking"));else{this._dataLinking=true;this._onDataLinkingComplete=dojo.hitch(this,g);this._onDataLinkingError=dojo.hitch(this,c);for(var g=this.url+"/link",d={},e=0;e<this.parameters.length;e++){for(var f=this.parameters[e],k="",i=0;i<a.features.length;i++){var j=a.features[i].attributes[f.featureField];if(!j&&this.layer&&this.layer.fields)for(var l=0;l<this.layer.fields.length;l++);if(j)k+=(k.length===0?"":",")+this._prepParamValue(j);
else{c&&c(Error("Missing feature field"));return}}k&&k.length>0&&(d[f.id]=k)}a=b.encodeJson(dojo.mixin({f:"json"},d));b.request({url:g,content:a,load:dojo.hitch(this,this._dataLinkingRestComplete),error:dojo.hitch(this,this._dataLinkRestError),callbackParamName:"CallBack"})}};c.prototype._configureObject=function(a,g){if(a===void 0||a.displayName===void 0||a.parameters===void 0)throw Error("Incorrect data link object returned from initialization");this.displayName=a.displayName;this.id=a.id;this.visible=
a.visible===void 0?true:a.visible;this.isOneToOne=!!a.isOneToOne;this.parameters=a.parameters;if(g)this.isInitialized=true;this.properties=b._getProperties(a.properties);this.extensions=b._getExtensions(a.extensions)};c.prototype._dataLinkingRestComplete=function(a){this._dataLinking=false;!a&&this._onDataLinkingError&&this._onDataLinkingError(Error("No results"));a.error&&this._onDataLinkingError&&this._onDataLinkingError(a.error);this._onDataLinkingComplete&&this._onDataLinkingComplete(this._parseConvertDates(a.results))};
c.prototype._parseConvertDates=function(a){for(var b in a)if(a.hasOwnProperty(b)){var c=a[b];typeof c==="string"?c.length>6&&c.substring(0,6)==="/Date("&&(c=parseInt(c.substring(6)),c=(new Date(c)).toLocaleString(),a[b]=c):typeof c==="object"&&(a[b]=this._parseConvertDates(c))}return a};c.prototype._dataLinkRestError=function(a){this._dataLinking=false;this._onDataLinkingError&&this._onDataLinkingError(a)};c.prototype._prepParamValue=function(a){var b="";typeof a==="number"?b=a.toString():typeof a===
"string"&&(b=a.replace(/,/g,"\\,"));return b};return c}(f.AsyncInitializable);f.DataLink=e})(b.essentials||(b.essentials={}))})(geocortex||(geocortex={}));
(function(b){(function(f){var e=function(d){function c(a){d.call(this,a);this.configuredVisible=false;this.dataLinks=[];this.defaultVisibility=false;this.displayName=this.displayField=null;this.extensions=[];this.featureLongDescription=this.featureDescription=null;this.featureHyperlinks=[];this.featureBorderColor=this.featureFillColor=this.featureLabel=null;this.featureType="None";this.type=b.essentials.LayerType.UNKNOWN;this.featureZoomFactor=this.featureZoomScale=null;this.fields=[];this.relationships=
[];this.fullExtent=null;this.hasReports=this.hasAttachments=this.hasDataLinks=false;this.id=this.iconUri=null;this.identifiableAtAllScales=this.identifiable=false;this.includeInLegend=this.includeInLayerList=true;this.drawIndex=null;this.isExpanded=false;this.mapService=null;this.minScale=this.maxScale=0;this.primaryKeyField=this.parentLayerId=this.wmsLayerName=this.styleName=this.legendUrl=this.name=null;this.properties={};this.reports=[];this.showMapTips=this.searchable=false;this.subLayerIds=[];
this.isDynamic=false;this.dynamicDefinition=null;this._visible=false}__extends(c,d);c.prototype.getRelatedFeatureLayer=function(a,g,c){var d=new dojo.Deferred,e=function(a){b.deferredResolve(d,a);typeof g=="function"&&g(a)},f=this._getRelation(a);if(!f)return e=Error("Relation not found: "+a),d&&d.fired==-1&&d.resolve(e),typeof c=="function"&&c(e),d;a=this.getLayerUrl();f=a.substring(0,a.lastIndexOf("/")+1)+f.relatedTableId;this.mapService&&this.mapService.serviceToken&&(f+=f.indexOf("?")>-1?"&token=":
"?token=",f+=encodeURIComponent(this.mapService.serviceToken));f=new esri.layers.FeatureLayer(f,{mode:esri.layers.FeatureLayer.MODE_SELECTION,outFields:["*"]});f.loaded?e(f):dojo.connect(f,"onLoad",dojo.hitch(this,e));dojo.connect(f,"onError",dojo.hitch(this,function(a){d&&d.fired==-1&&d.resolve(a);typeof c=="function"&&c(a)}));return d};c.prototype.areAllAncestorsVisible=function(){for(var a=this.mapService.findLayerById(this.parentLayerId);a!==null&&a!==void 0;){if(!a.isVisible())return false;a=
this.mapService.findLayerById(a.parentLayerId)}return true};c.prototype.getLayerUrl=function(){return this.mapService&&this.mapService.serviceUrl?this.mapService.drawingBehavior==="FeatureLayer"?this.mapService.serviceUrl:this.mapService.serviceUrl+"/"+this.id:null};c.prototype.getFieldByName=function(a){var b;if(this.fields)for(var c=0;c<this.fields.length;c++)if((b=this.fields[c])&&b.name==a)return b;return null};c.prototype.isVisible=function(){return this._visible};c.prototype.setVisibility=function(a,
g){if(this.mapService){switch(this.mapService.mapServiceType){case b.essentials.MapServiceType.DYNAMIC:case b.essentials.MapServiceType.FEATURE:case b.essentials.MapServiceType.WMS:case b.essentials.MapServiceType.WMTS:case b.essentials.MapServiceType.GEORSS:case b.essentials.MapServiceType.TILED:this._visible=a;break;default:this._visible=true}this.mapService._setVisibility(this.id,this._visible,g)}};c.prototype.findReportById=function(a){if(this.reports)for(var g=0;g<this.reports.length;g++){var c=
this.reports[g];if(b.essentials.utilities.SiteResourceIdComparer.equals(c.id,a))return c}return null};c.prototype.withinScaleRange=function(a){if(this.maxScale==0&&this.minScale==Infinity||isNaN(this.maxScale)&&isNaN(this.minScale))return true;a==null&&(a=this.mapService.essentialsMap.calculateScale());return this.maxScale<a&&a<this.minScale};c.prototype._configureDataLinks=function(a,g){for(var c=0;a&&c<a.length;c++)this.dataLinks[c]=new b.essentials.DataLink(this.url+"/datalinks/"+a[c].id),this.dataLinks[c].layer=
this,this.dataLinks[c]._configureObject(a[c],g)};c.prototype._configureObject=function(a,g){if(a===void 0||a.name===void 0||a.id===void 0||a.hasDataLinks===void 0)throw Error("Incorrect layer object returned from initialization");this.defaultVisibility=a.defaultVisibility;this.configuredVisible=a.visible;this.displayName=a.displayName;this.featureDescription=a.featureDescription;this.featureLongDescription=a.hasOwnProperty("featureLongDescription")?a.featureLongDescription:a.featureDescription;this.featureLabel=
a.featureLabel;this.featureType=a.featureType===void 0?this.featureType:a.featureType;this.featureZoomScale=a.featureZoomScale===void 0?this.featureZoomScale:a.featureZoomScale;this.featureZoomFactor=a.featureZoomFactor===void 0?this.featureZoomFactor:a.featureZoomFactor;this.hasDataLinks=a.hasDataLinks;this.hasReports=a.hasReports;this.hasAttachments=a.hasAttachments;this.id=a.id;this.name=a.name;this.wmsLayerName=a.nativeID;this.parentLayerId=a.parentLayerId;this.subLayerIds=a.subLayerIds;this._visible=
a.visible;this.styleName=a.styleName;this.legendUrl=a.legendUrl;this.isDynamic=a.isDynamic===void 0?this.isDynamic:a.isDynamic;this.dynamicDefinition=a.dynamicDefinition;var c=a.fullExtent;if(c)this.fullExtent=new esri.geometry.Extent(c.xmin,c.ymin,c.xmax,c.ymax,c.spatialReference);c=null;if(this.mapService&&this.mapService.essentialsMap)c=this.mapService.essentialsMap.site;this.iconUri=b.essentials.RestHelper.processClientSideTokens(c,a.iconUri);this.minScale=a.hasOwnProperty("minScale")&&!isNaN(a.minScale)&&
a.minScale!=0?a.minScale:Infinity;this.maxScale=a.hasOwnProperty("maxScale")&&!isNaN(a.maxScale)?a.maxScale:0;if(a.hasOwnProperty("identifiable"))this.identifiable=a.identifiable;if(a.hasOwnProperty("includeInLayerList"))this.includeInLayerList=a.includeInLayerList;if(a.hasOwnProperty("includeInLegend"))this.includeInLegend=a.includeInLegend;if(a.hasOwnProperty("drawIndex"))this.drawIndex=a.drawIndex;if(a.hasOwnProperty("searchable"))this.searchable=a.searchable;if(a.hasOwnProperty("showMapTips"))this.showMapTips=
a.showMapTips;if(a.hasOwnProperty("featureBorderColor"))this.featureBorderColor=a.featureBorderColor;if(a.hasOwnProperty("featureFillColor"))this.featureFillColor=a.featureFillColor;if(a.type!==void 0)this.type=this._convertLayerType(a.type);if(this.type==b.essentials.LayerType.GROUP_LAYER&&a.hasOwnProperty("isExpanded"))this.isExpanded=a.isExpanded;if(a.featureHyperlinks)for(c=0;c<a.featureHyperlinks.length;c++)this.featureHyperlinks[c]=new b.essentials.FeatureHyperlink(a.featureHyperlinks[c],this);
if(a.fields)for(c=0;c<a.fields.length;c++)this.fields[c]=new b.essentials.Field(a.fields[c]);if(a.relationships)for(c=0;c<a.relationships.length;c++)a.relationships[c].id=parseInt(a.relationships[c].id),a.relationships[c].relatedTableId=parseInt(a.relationships[c].relatedTableId),this.relationships.push(a.relationships[c]);this.primaryKeyField=this.getFieldByName(a.primaryKeyField);this.displayField=this.getFieldByName(a.displayField);this._configureDataLinks(a.dataLinks,g);this._configureReports(a.reports,
g);if(g)this.isInitialized=true;this.properties=b._getProperties(a.properties);this.extensions=b._getExtensions(a.extensions)};c.prototype._configureReports=function(a,c){for(var h=0;a&&h<a.length;h++)this.reports[h]=new b.essentials.Report(this.url+"/reports/"+a[h].id),this.reports[h].layer=this,this.reports[h]._configureObject(a[h],c)};c.prototype.getObjectIdFieldName=function(){var a=null;if(this.primaryKeyField)a=this.primaryKeyField.name;return a};c.prototype._convertLayerType=function(a){return a==
"FeatureLayer"||a=="DynamicFeatureLayer"?b.essentials.LayerType.FEATURE_LAYER:a=="GroupLayer"||a=="AnnotationLayer"?b.essentials.LayerType.GROUP_LAYER:a=="RasterLayer"?b.essentials.LayerType.RASTER_LAYER:a=="GeoRssLayer"?b.essentials.LayerType.GEO_RSS_LAYER:b.essentials.LayerType.UNKNOWN};c.prototype._getRelation=function(a){typeof a=="string"&&(a=parseInt(a));for(var b=0;b<this.relationships.length;b++)if(this.relationships[b].id==a)return this.relationships[b];return null};c.prototype._createDynamicLayerInfo=
function(){var a=null;if(this.isDynamic){a=b.essentials.RestHelper.getDynamicLayerInfoFromJson(this.dynamicDefinition,this.id);if(this.minScale<Infinity)a.minScale=this.minScale;if(this.maxScale>0)a.maxScale=this.maxScale}return a};c.prototype._createLayerDrawingOptions=function(){var a;this.isDynamic&&(a=b.essentials.RestHelper.getLayerDrawingOptionsFromJson(this.dynamicDefinition));return a};c.prototype._syncProgramaticallyChangedLayerVisibility=function(a){this._visible=a};return c}(f.AsyncInitializable);
f.Layer=e})(b.essentials||(b.essentials={}))})(geocortex||(geocortex={}));
(function(b){(function(f){var e=function(c){function a(a){c.call(this,a);this.bingProperties=null;this.configuredOpacity=1;this.configuredVisible=false;this.essentialsMap=this.displayName=this.description=null;this.extensions=[];this.imageFormat=this.id=this.iconUri=null;this.includeInLayerList=true;this.updateInterval=null;this.isExpanded=true;this.serverVersion=null;this.failureAction=b.essentials.FailureAction.WARN;this.operationalSpatialReference=null;this.layers=[];this.requestEncoding=this.tileInfo=
this.tileMatrixSet=this.mapServiceType=this.mapServiceFunction=null;this.properties={};this.geometryServiceUrl=this.mapUrl=this.proxyUrl=this.serviceUrl=this.serviceToken=this.serviceLayer=null;this.isServiceLayerLoaded=false;this.initializationFailure=null;this.supportsDynamicLayers=false;this.drawingBehavior=null;this._needsProxy=false;this.layerVisibilityEventManager=null}__extends(a,c);a.prototype.getConfiguredVisibleLayers=function(){return this._getVisibleLayersOfType("configuredVisible")};
a.prototype.getDefaultVisibleLayers=function(){return this._getVisibleLayersOfType("defaultVisibility")};a.prototype.getVisibleLayers=function(){return this._getVisibleLayersOfType("_visible")};a.prototype._getVisibleLayersOfType=function(a){for(var b=[],c=0,d=0;d<this.layers.length;d++){var e=this.layers[d];if(e[a]&&e.parentLayerId===null)e.subLayerIds===null||e.subLayerIds.length===0?b[c++]=e.id:c=this._getVisibleGroupLayersOfType(a,e,b,c)}return b};a.prototype.isVisible=function(){var a=false;
if(this.serviceLayer&&typeof this.serviceLayer.visible==="boolean")a=this.serviceLayer.visible;return a};a.prototype.isTiled=function(){return this.serviceLayer?this.serviceLayer instanceof esri.layers.TiledMapServiceLayer:false};a.prototype.setVisibility=function(a){this.serviceLayer!==null&&(a?this.serviceLayer.show():this.serviceLayer.hide())};a.prototype.findServiceToken=function(){return this.serviceToken?this.serviceToken:!this.essentialsMap||!this.essentialsMap.site||!this.essentialsMap.site.arcGisPortalSecurityContext?
null:this.essentialsMap.site.arcGisPortalSecurityContext.getToken(this.serviceUrl)};a.prototype.findLayerByName=function(a){for(var b=0;b<this.layers.length;b++){var c=this.layers[b];if(c.name==a||c.displayName==a)return c}return null};a.prototype.findLayerById=function(a){for(var b=0;b<this.layers.length;b++){var c=this.layers[b];if(c.id==a)return c}return null};a.prototype._configureLayers=function(a,c){for(var d=this,e=0;a&&e<a.length;e++)this.layers[e]=new b.essentials.Layer(this.url+"/layers/"+
a[e].id),this.layers[e].mapService=this,this.layers[e]._configureObject(a[e],c);this._createServiceLayer();this.updateInterval&&this.serviceLayer&&this.serviceLayer.setDisableClientCaching&&this.serviceLayer.setDisableClientCaching(true);if(this.updateInterval&&this.serviceLayer&&this.serviceLayer.refresh){var f=this;dojo.connect(this.serviceLayer,"onUpdateEnd",function(){setTimeout(function(){f.serviceLayer.refresh()},d.updateInterval*1E3)})}};a.prototype._configureObject=function(a,c){if(a===void 0||
a.id===void 0||a.displayName===void 0||a.serviceType===void 0||a.connectionString===void 0)throw Error("Incorrect map service object returned from initialization");this.id=a.id;this.mapServiceType=a.serviceType;this.mapServiceFunction=a.serviceFunction===void 0?this.mapServiceFunction:a.serviceFunction;this.displayName=a.displayName;this.description=a.description===void 0?this.description:a.description;this.configuredVisible=!!a.visible;this.configuredOpacity=a.opacity===void 0||a.opacity===null?
this.configuredOpacity:a.opacity;this.imageFormat=a.format===void 0?this.imageFormat:a.format;if(a.updateInterval!==void 0){var d=a.updateInterval;d&&d<10&&d!==0&&(d=10);this.updateInterval=d}this.isExpanded=a.isExpanded===void 0?this.isExpanded:a.isExpanded;this.serverVersion=a.serverVersion;this.failureAction=a.failureAction;this.tileMatrixSet=a.tileMatrixSet;this.requestEncoding=a.requestEncoding;this.operationalSpatialReference=a.operationalSpatialReference;if(a.tileInfo&&(this.tileInfo=dojo.clone(a.tileInfo),
this.tileInfo.spatialReference))this.tileInfo.spatialReference=new esri.SpatialReference(this.tileInfo.spatialReference.wkid?this.tileInfo.spatialReference.wkid:this.tileInfo.spatialReference.wkt);this.supportsDynamicLayers=a.supportsDynamicLayers===void 0?this.supportsDynamicLayers:a.supportsDynamicLayers;if(a.iconUri){d=null;if(this.essentialsMap)d=this.essentialsMap.site;this.iconUri=b.essentials.RestHelper.processClientSideTokens(d,a.iconUri)}if(typeof a.includeInLayerList==="boolean")this.includeInLayerList=
a.includeInLayerList;this.drawingBehavior=a.drawingBehavior===void 0?this.drawingBehavior:a.drawingBehavior;this._processConnectionString(a.connectionString);this._processProxyInfo(a.proxyInfo);this._configureLayers(a.layers,c);if(c)this.isInitialized=true;this.properties=b._getProperties(a.properties);this.extensions=b._getExtensions(a.extensions)};a.prototype._updateServiceToken=function(a){this.serviceToken=a;if(this.serviceLayer&&this.serviceLayer._url){var b=this.serviceLayer._url;if(b.query)b.query.token=
a,a=dojo.objectToQuery(b.query),this.serviceLayer.url=b.path+(a?"?"+a:"")}};a.prototype._createServiceLayer=function(){if(this.serviceLayer==null){var a=this.serviceUrl;this.serviceToken!==null&&(a=a+(a.indexOf("?")>-1?"&token=":"?token=")+encodeURIComponent(this.serviceToken));if(this.drawingBehavior==="MapService"){var c=this.configuredVisible,e;switch(this.mapServiceType){case b.essentials.MapServiceType.DYNAMIC:if(this._needsProxy)esri.config.defaults.io.alwaysUseProxy=true;var f=new esri.layers.ArcGISDynamicMapServiceLayer(a,
{id:this.id}),a=this.getConfiguredVisibleLayers();a.length===0?f.setVisibleLayers&&(this.layers.length===0?f.setVisibleLayers(a,false):f.setVisibleLayers(["-1"],false)):f.setVisibleLayers&&f.setVisibleLayers(a,false);this.layerVisibilityEventManager=new d(this,f);f.setOpacity(this.configuredOpacity);f.setImageFormat(this._getAgsDynamicImageFormat(this.imageFormat));dojo.connect(f,"onError",this,this._layerLoadErrorHandler);dojo.connect(f,"onLoad",this,function(){this._handleServiceLayerLoaded(f);
this._handleDynamicLayers(f)});c?f.show():f.hide();this.serviceLayer=f;break;case b.essentials.MapServiceType.TILED:a=new esri.layers.ArcGISTiledMapServiceLayer(a);a.setOpacity(this.configuredOpacity);dojo.connect(a,"onError",dojo.hitch(this,this._layerLoadErrorHandler));dojo.connect(a,"onLoad",dojo.hitch(this,this._handleServiceLayerLoaded));c?a.show():a.hide();this.serviceLayer=a;break;case b.essentials.MapServiceType.IMAGE:a=new esri.layers.ArcGISImageServiceLayer(a,{id:this.id});a.setOpacity(this.configuredOpacity);
a.setImageFormat(this._getAgsImageServiceImageFormat(this.imageFormat));dojo.connect(a,"onError",this,this._layerLoadErrorHandler);dojo.connect(a,"onLoad",dojo.hitch(this,this._handleServiceLayerLoaded));c?a.show():a.hide();this.serviceLayer=a;break;case b.essentials.MapServiceType.BING:a=new esri.virtualearth.VETiledLayer(this.bingProperties);a.setOpacity(this.configuredOpacity);dojo.connect(a,"onError",this,this._layerLoadErrorHandler);dojo.connect(a,"onLoad",dojo.hitch(this,this._handleServiceLayerLoaded));
c?a.show():a.hide();this.serviceLayer=a;break;case b.essentials.MapServiceType.WMS:if(!dojo.isObject(esri.layers.WMSLayer))throw Error("This Javascript application must // dojo.require the esri.layers.wms package in order to use a site with a WMS service.");this._extendWms();e=false;for(var n=0;n<this.layers.length;n++)if(this.layers[n].wmsLayerName){e=true;break}if(e){e={extent:this.essentialsMap.initialExtent,layerInfos:this._constructWmsLayerInfos(),version:this.serverVersion};e=new esri.layers.WMSLayer(a,
{resourceInfo:e,visibleLayers:this._getWmsVisibleLayers()});if(this.operationalSpatialReference!=null)n=parseInt(this.operationalSpatialReference.replace(/^.*:/,"")),e.spatialReferences.push(n),e.preferredSpatialReference=n;dojo.connect(e,"onLoad",dojo.hitch(this,this._handleServiceLayerLoaded))}else e=new esri.layers.WMSLayer(a),dojo.connect(e,"onLoad",dojo.hitch(this,this._finishWmsLayerConfiguration));this.layerVisibilityEventManager=new d(this,e);e.getMapURL=this.mapUrl?this._prefixProxy(this.mapUrl):
this._prefixProxy(a);e.setImageFormat(this._getEsriWmsImageFormat());e.setOpacity(this.configuredOpacity);dojo.connect(e,"onError",this,this._layerLoadErrorHandler);c?e.show():e.hide();this.serviceLayer=e;break;case b.essentials.MapServiceType.WMTS:if(!dojo.isObject(esri.layers.WMTSLayer))throw Error("This JavaScript application must // dojo.require the esri.layers.wmts package in order to use a site with WMTS service.");if(this.layers.length==0)throw Error("You must include at least one layer in your WMTS. Service "+
this.displayName+" has 0 layers.");e=b.essentials.GeometryUtilities.scaleEnvelopeWithoutTranslation(this.layers[0].fullExtent,1.1);e==null&&(e=b.essentials.GeometryUtilities.scaleEnvelopeWithoutTranslation(this.essentialsMap.fullExtent,1.1));n=new esri.layers.WMTSLayerInfo({tileInfo:this.tileInfo,fullExtent:e,initialExtent:e,identifier:this.layers.length>0?this.layers[0].name:null,tileMatrixSet:this.tileMatrixSet,format:this._getEsriOgcImageFormat(),style:this.layers[0].styleName});e={version:this.serverVersion,
layerInfos:[n],getTileUrl:this._prefixProxy(this.mapUrl)};a=new esri.layers.WMTSLayer(a,{serviceMode:"KVP",resourceInfo:e,layerInfo:n});if(a._url){var k=0;a._url=a._url.replace(/\?/g,function(){k++;return k==1?"?":""})}a.setOpacity(this.configuredOpacity);dojo.connect(a,"onError",this,this._layerLoadErrorHandler);dojo.connect(a,"onLoad",dojo.hitch(this,this._handleServiceLayerLoaded));c?a.show():a.hide();this.serviceLayer=a}}}};a.prototype._prefixProxy=function(a){return this.proxyUrl?this.proxyUrl+
"?"+a:a};a.prototype._constructWmsLayerInfos=function(){for(var a=[],b=0;b<this.layers.length;b++){var c=this.layers[b];c.wmsLayerName!=null&&(c=new esri.layers.WMSLayerInfo({name:c.wmsLayerName,title:c.name}),a.push(c))}return a};a.prototype._getWmsVisibleLayers=function(){for(var a=[],b=0;b<this.layers.length;b++){var c=this.layers[b];c.isVisible()&&c.areAllAncestorsVisible()&&c.wmsLayerName!=null&&c.subLayerIds.length==0&&a.push(c.wmsLayerName)}return a};a.prototype._applyWmsLayerVisibility=function(){this.serviceLayer.setVisibleLayers(this._getWmsVisibleLayers())};
a.prototype._getEsriWmsImageFormat=function(){var a=this._getEsriOgcImageFormat();a=="jpeg"&&(a="jpg");return a};a.prototype._getEsriOgcImageFormat=function(){return this.imageFormat!=null?this.imageFormat.replace(/^image\//,""):null};a.prototype._findWMSLayerName=function(a,b){for(var c in a){var d=a[c];if(d.title===b)return d.name;if(d.subLayers!==null&&d.subLayers.length>0&&(d=this._findWMSLayerName(d.subLayers,b),d!==null))return d}return null};a.prototype._finishWmsLayerConfiguration=function(a){for(var b=
[],c=0,d,e=0;e<this.layers.length;e++){var f=this.layers[e];if(f.configuredVisible&&(f.subLayerIds===null||f.subLayerIds.length===0))if(f.parentLayerId!==null){if(this.findLayerById(f.parentLayerId).configuredVisible)d=this._getWMSLayerNameFromTitle(f.name),f.wmsLayerName=d,d!==null&&d!==""&&(b[c]=d,c++)}else d=this._getWMSLayerNameFromTitle(f.name),f.wmsLayerName=d,d!==null&&d!==""&&(b[c]=d,c++)}this.serviceLayer.setVisibleLayers(b);this._handleServiceLayerLoaded(a)};a.prototype._handleServiceLayerLoaded=
function(a){this.isServiceLayerLoaded=true;if(this.essentialsMap!==null&&this.essentialsMap.site!==null&&dojo.isFunction(this.essentialsMap.site.onLayerLoad))this.essentialsMap.site.onLayerLoad(a)};a.prototype._layerLoadErrorHandler=function(a){this.initializationFailure=a;if(this.essentialsMap&&this.essentialsMap.site&&dojo.isFunction(this.essentialsMap.site.onLayerLoadError))this._layerLoadErrorHandler=this.essentialsMap.site.onLayerLoadError};a.prototype._handleDynamicLayers=function(a){if(this.supportsDynamicLayers){var b=
dojo.some(this.layers,function(a){return a.isDynamic}),c=dojo.some(this.layers,function(a){return a.drawIndex!=null});if(b||c){if(b=this.essentialsMap.getMap()){if((!b.spatialReference||(!b.spatialReference.wkid||b.spatialReference.wkid<=0)&&(!b.spatialReference.wkt||!b.spatialReference.wkt.trim()))&&a.spatialReference!=null&&a.spatialReference.wkt&&a.spatialReference.wkt.trim())b.spatialReference=a.spatialReference;if(b.extent&&(!b.extent.spatialReference||(!b.extent.spatialReference.wkid||b.extent.spatialReference.wkid<=
0)&&(!b.extent.spatialReference.wkt||!b.extent.spatialReference.wkt.trim()))&&a.spatialReference!=null&&a.spatialReference.wkt&&a.spatialReference.wkt.trim())b=new esri.geometry.Extent(b.extent),b.spatialReference=a.spatialReference,this.essentialsMap.extentManager.setExtentWithPriority(b,2)}var d=this._createDynamicLayerInfos(a),e=[];a.layerDrawingOptions&&(e=dojo.clone(a.layerDrawingOptions));dojo.forEach(this.layers,function(a,b){if(a.isDynamic){var c,g=parseInt(a.id,10);if(g!=null){c=a._createDynamicLayerInfo();
if(!c.name)c.name=a.name;c!=null&&d.splice(b,0,c);c=a._createLayerDrawingOptions();c!=null&&(e[g]=c)}else throw"Could not convert Layer ID '"+a.id+"' into an integer!";}});if(c){var f=dojo.clone(d),i=[];dojo.forEach(this.layers,function(a){a!=null&&a.drawIndex!=null&&i.push(a)});i.sort(function(a,b){return a.drawIndex-b.drawIndex});dojo.forEach(i,function(a){for(var b=null,c=null,g=0;g<f.length;g++){var d=f[g];if(d.id.toString()==a.id){b=d;c=g;break}}b!=null&&c!=null&&(f.splice(c,1),f.push(b))});
d=[];dojo.forEach(f,function(a){d.push(a)})}e.length>0&&a.setLayerDrawingOptions(e,true);a.setDynamicLayerInfos(d,true);a.setVisibleLayers(this.getConfiguredVisibleLayers())}}};a.prototype._createDynamicLayerInfos=function(a,b){b==void 0&&(b=true);var c=null;if(a!=null&&(c=a.createDynamicLayerInfosFromLayerInfos(),b))for(var d=c.length-1;d>=0;d--){var e=this.findLayerById(c[d].id.toString());(e==null||e.isDynamic)&&c.splice(d,1)}return c};a.prototype._getAgsDynamicImageFormat=function(a){if(typeof a==
"undefined"||a===null||a.length<1)return"png8";a=a.toLowerCase();switch(a){case "png8":case "png24":case "png32":case "jpeg":case "jpg":case "gif":return a;default:return"png8"}};a.prototype._getAgsImageServiceImageFormat=function(a){if(typeof a=="undefined"||a===null||a.length<1)return null;a=a.toLowerCase();switch(a){case "jpgpng":case "png8":case "png24":case "jpeg":case "jpg":case "gif":return a;default:return null}};a.prototype._getVisibleGroupLayersOfType=function(a,b,c,d){if(b[a])for(var e=
0;e<b.subLayerIds.length;e++){var f=this.findLayerById(b.subLayerIds[e]);if(f[a])if(f.subLayerIds!==null&&f.subLayerIds.length>0)d=this._getVisibleGroupLayersOfType(a,f,c,d);else if(dojo.indexOf(c,f.id)<0)c[d]=f.id,d++}return d};a.prototype._getWMSLayerNameFromTitle=function(a){return this.serviceLayer instanceof esri.layers.WMSLayer?this._findWMSLayerName(this.serviceLayer.layerInfos,a):null};a.prototype._processConnectionString=function(a){var c=b.essentials.ServiceHelper.extractConnectionStringValue;
if(this.mapServiceType==b.essentials.MapServiceType.BING){this.bingProperties={};var d;if((d=c(a,"mapStyle"))&&d.length>0)this.bingProperties.mapStyle=d;if((d=c(a,"culture"))&&d.length>0)this.bingProperties.culture=d;if((d=c(a,"key"))&&d.length>0)this.bingProperties.bingMapsKey=d}else{d=c(a,"url");if(d.length>0)this.serviceUrl=d.replace(/%3d/g,"=").replace(/%3D/g,"=");else if((this.mapServiceType===b.essentials.MapServiceType.DYNAMIC||this.mapServiceType===b.essentials.MapServiceType.TILED)&&this.essentialsMap.site._getVersion()>=
3.912)if(this.serviceUrl=this.url+"/MapServer",this.essentialsMap.site.currentVersion==="3.912")this._needsProxy=true;d=c(a,"geometryServiceUrl");if(d.length>0)this.geometryServiceUrl=d;d=c(a,"token");var e=this.essentialsMap.site?this.essentialsMap.site.arcGisPortalSecurityContext:null;if(d.length>0)this.serviceToken=d;else if(e&&e.appliesTo(this.serviceUrl)&&e.tokenResult)this.serviceToken=e.tokenResult.token;else if(this.serviceUrl!=null&&(d=b.essentials.RestHelperHTTPService.getAuthenticationControlBlockStore().find(this.serviceUrl))&&
d.token!=null)this.serviceToken=d.token;d=c(a,"proxy");if(d.length>0)try{this.proxyUrl=esri.config.defaults.io.proxyUrl=d,esri.config.defaults.io.alwaysUseProxy=true}catch(f){}a=c(a,"mapUrl");if(a.length>0)this.mapUrl=a.replace(/%3d/g,"=").replace(/%3D/g,"=")}};a.prototype._isLocalProxyInfo=function(a){return!a?false:a.type!="local-reverse-proxy"?false:!a.address?false:true};a.prototype._processProxyInfo=function(a){if(this._isLocalProxyInfo(a)){for(var a=(this.url+"/../../../../../"+a.address).split("/"),
b=a.indexOf("..");b>0;b=a.indexOf(".."))a.splice(b-1,2);this.serviceUrl=a.join("/")}};a.prototype.supportsLayerVisibility=function(){switch(this.mapServiceType){case b.essentials.MapServiceType.FEATURE:case b.essentials.MapServiceType.GEORSS:case b.essentials.MapServiceType.BING:case b.essentials.MapServiceType.TILED:case b.essentials.MapServiceType.WMTS:case b.essentials.MapServiceType.IMAGE:return false;case b.essentials.MapServiceType.DYNAMIC:return this.serviceLayer!==null&&!!this.serviceLayer.visibleLayers}return true};
a.prototype._setVisibility=function(a,c,d){a={mapServiceId:this.id,layerId:a,visibility:c};d===void 0&&(d=false);var e;switch(this.mapServiceType){case b.essentials.MapServiceType.DYNAMIC:if(this.serviceLayer!==null){if(!this.serviceLayer.visibleLayers){c?this.serviceLayer.show():this.serviceLayer.hide();dojo.publish("LayerVisibilityChange",[Array(a)]);break}c=this.getVisibleLayers();c.InternallyChangedLayer=a;c.length===0&&c.push("-1");this.serviceLayer.setVisibleLayers&&this.serviceLayer.setVisibleLayers(c,
d)}break;case b.essentials.MapServiceType.FEATURE:case b.essentials.MapServiceType.GEORSS:case b.essentials.MapServiceType.BING:case b.essentials.MapServiceType.TILED:case b.essentials.MapServiceType.WMTS:case b.essentials.MapServiceType.IMAGE:if(this.serviceLayer!==null){if(this.layers.length>1)throw Error("Visibility of individual layers cannot be set for this Map Service.");c?this.serviceLayer.show():this.serviceLayer.hide();dojo.publish("LayerVisibilityChange",[Array(a)])}break;case b.essentials.MapServiceType.WMS:if(this.serviceLayer!==
null){d=[];d.InternallyChangedLayer=a;for(c=a=0;c<this.layers.length;c++)if(e=this.layers[c],e.isVisible()&&(e.subLayerIds===null||e.subLayerIds.length===0)&&e.areAllAncestorsVisible())e=e.wmsLayerName,e!==null&&e!==""&&(d[a]=e,a++);this.serviceLayer.setVisibleLayers(d)}}};a.prototype._extendWms=function(){if(!b.essentials.MapService._wmsExtended){var a=esri.layers.WMSLayer._meta.hidden.getImageUrl,c=/.*images\/pixel.png$/;esri.layers.WMSLayer.extend({getImageUrl:function(b,d,e,f){var i=this;a.apply(this,
[b,d,e,function(a){if(!c.test(a)){for(var b={},g=0;g<i.layerInfos.length;g++)b[i.layerInfos[g].name]=i.layerInfos[g].styleName;for(var d=[],g=0;g<i.visibleLayers.length;g++)d.push(b[i.visibleLayers[g]]);b=d.join(",");g=a.substring(a.lastIndexOf("?")+1,a.length);g=dojo.queryToObject(g);g.STYLES=b;i.preferredSpatialReference&&(g[g.CRS?"CRS":"SRS"]="EPSG:"+i.preferredSpatialReference);a=a.substring(0,a.lastIndexOf("?")+1)+dojo.objectToQuery(g)}f(a)}])}});b.essentials.MapService._wmsExtended=true}};a._wmsExtended=
false;return a}(f.AsyncInitializable);f.MapService=e;var d=function(){function c(a,c){this._mapService=null;this._mapService=a;if(this._mapService.mapServiceType!=b.essentials.MapServiceType.WMS&&this._mapService.mapServiceType!=b.essentials.MapServiceType.DYNAMIC)throw Error("LayerVisibilityEventManager: Only Dynamic and WMS Layer types supported.");var d=this;dojo.require("dojo.aspect");dojo.aspect.before(c,"setVisibleLayers",function(a,b){return d.beforeESRIsetVisibleLayers(a,b)});dojo.aspect.after(c,
"setVisibleLayers",function(a,b,c){d.afterESRIsetVisibleLayers(a,b,c)},true)}c.prototype.beforeESRIsetVisibleLayers=function(a,c){var d=[],e=[];c===void 0&&(c=false);if(a.InternallyChangedLayer)return d.push(a.InternallyChangedLayer),d=[a,c,d];if(this._mapService.mapServiceType==b.essentials.MapServiceType.DYNAMIC)e=dojo.clone(a);else if(this._mapService.mapServiceType==b.essentials.MapServiceType.WMS)for(var f=0;a&&f<a.length;f++){var n=this._findWmsLayerIdFromName(a[f]);if(n&&n!==null)e.push(n.toString());
else return d=[a,c,d]}if(a&&this._mapService.mapServiceType==b.essentials.MapServiceType.DYNAMIC&&a.length===1&&a[0]=="-1"){for(e=0;e<this._mapService.layers.length;e++)n=this._mapService.layers[e].id,d.push({mapServiceId:this._mapService.id,layerId:n.toString(),visibility:false}),this._mapService.findLayerById(n)._syncProgramaticallyChangedLayerVisibility(false);return d=[a,c,d]}if(a&&a.length===0||this._mapService.mapServiceType==b.essentials.MapServiceType.DYNAMIC&&a.length===1&&a[0]==="")e=this._mapService.getDefaultVisibleLayers();
for(var k=this._getAllCurrentlyVisibleLayers(),i=0;k&&i<k.length;i++)if(n=k[i],e&&e.indexOf(n.toString())<0&&(f=this._mapService.findLayerById(n)))d.push({mapServiceId:this._mapService.id,layerId:n.toString(),visibility:false}),f._syncProgramaticallyChangedLayerVisibility(false);n=this._mapService.getVisibleLayers();if(e&&e.length>0)for(k=0;k<e.length;k++)if(this._mapService.mapServiceType==b.essentials.MapServiceType.DYNAMIC&&isNaN(parseInt(e[k]))&&(e[k]="0"),n&&n.indexOf(e[k].toString())<0&&(f=
this._mapService.findLayerById(e[k])))f.subLayerIds&&f.subLayerIds.length>0&&(this._deleteItemWithId(e[k],d),this._recursivelyUpdateSublayerVisibility(f,true,d)),d.push({mapServiceId:this._mapService.id,layerId:e[k].toString(),visibility:true}),f._syncProgramaticallyChangedLayerVisibility(true),f.parentLayerId&&f.parentLayerId!==null&&f.parentLayerId!==void 0&&this._recursivelyUpdateAncestorVisibility(f,e,d);return d=[a,c,d]};c.prototype.afterESRIsetVisibleLayers=function(a,b,c){c&&c.length>0&&dojo.publish("LayerVisibilityChange",
Array(c))};c.prototype._recursivelyUpdateAncestorVisibility=function(a,b,c){if(a&&a.parentLayerId&&a.parentLayerId!==null&&a.parentLayerId!==void 0){var d=this._mapService.findLayerById(a.parentLayerId);d.isVisible()||(this._deleteItemWithId(a.parentLayerId,c),d._syncProgramaticallyChangedLayerVisibility(true),c.push({mapServiceId:this._mapService.id,layerId:a.parentLayerId.toString(),visibility:true}));this._recursivelyUpdateAncestorVisibility(d,b,c)}};c.prototype._recursivelyUpdateSublayerVisibility=
function(a,b,c){if(a.subLayerIds&&a.subLayerIds.length>0)for(var d=0;d<a.subLayerIds.length;d++){var e=this._mapService.findLayerById(a.subLayerIds[d]),f=e.id;e._syncProgramaticallyChangedLayerVisibility(b);this._deleteItemWithId(f,c);c.push({mapServiceId:this._mapService.id,layerId:f.toString(),visibility:b});e.subLayerIds&&e.subLayerIds.length>0&&this._recursivelyUpdateSublayerVisibility(e,b,c)}};c.prototype._getAllCurrentlyVisibleLayers=function(){for(var a=[],b=0;b<this._mapService.layers.length;b++){var c=
this._mapService.layers[b];c.isVisible()&&a.push(c.id.toString())}return a};c.prototype._findWmsLayerIdFromName=function(a){for(var b=0;b<this._mapService.layers.length;b++){var c=this._mapService.layers[b];if(a==c.wmsLayerName)return c.id}return null};c.prototype._deleteItemWithId=function(a,b){for(var c=0;c<b.length;c++)b[c].layerId==a&&b.splice(c,1)};return c}()})(b.essentials||(b.essentials={}))})(geocortex||(geocortex={}));
(function(b){b=b.essentials||(b.essentials={});b=b.MapServiceType||(b.MapServiceType={});b.DYNAMIC="Dynamic";b.TILED="Tiled";b.IMAGE="Image";b.BING="Bing";b.FEATURE="Feature";b.WMS="WMS";b.WMTS="WMTS";b.GEORSS="GeoRss"})(geocortex||(geocortex={}));(function(b){b=b.essentials||(b.essentials={});b=b.MapServiceFunction||(b.MapServiceFunction={});b.OPERATIONAL="Operational";b.BASE="Base"})(geocortex||(geocortex={}));
(function(b){b=b.essentials||(b.essentials={});b=b.DrawingBehavior||(b.DrawingBehavior={});b.MAP_SERVICE="MapService";b.FEATURE_LAYER="FeatureLayer";b.GeoRSS_LAYER="GeoRssLayer"})(geocortex||(geocortex={}));(function(b){b=b.essentials||(b.essentials={});b=b.FailureAction||(b.FailureAction={});b.IGNORE="Ignore";b.WARN="Warn";b.ERROR="Error"})(geocortex||(geocortex={}));
(function(b){(function(f){var e=function(d){function c(a){d.call(this,a);this.color=[255,0,0];this.disableClientCaching=false;this.onDemandCacheSize=1E3;this.outFields="";this.queryMode=esri.layers.FeatureLayer.MODE_ONDEMAND;this.selectionColor=[0,255,255];this.canAddAttachments=this.canEdit=this.canDelete=this.canAdd=this.canUpdate=this.where=null;this._colorSet=false;this._serviceLayer=this._initialFeatureCollection=null;this.serviceUrl=a}__extends(c,d);c.prototype.getEmptyFeatureCollection=function(){return dojo.fromJson(this._initialFeatureCollection)};
c.prototype.restoreFeatureLayer=function(){if(!this._serviceLayer._mode)switch(this._serviceLayer.mode){case esri.layers.FeatureLayer.MODE_SNAPSHOT:this._serviceLayer._mode=new esri.layers._SnapshotMode(this._serviceLayer);break;case esri.layers.FeatureLayer.MODE_ONDEMAND:this._serviceLayer._mode=new esri.layers._OnDemandMode(this._serviceLayer);break;case esri.layers.FeatureLayer.MODE_SELECTION:this._serviceLayer._mode=new esri.layers._SelectionMode(this._serviceLayer)}this.replaceFeatureLayer(this._serviceLayer,
true,true,true);this.serviceLayer.resume()};c.prototype.replaceFeatureLayer=function(a,b,c,d){var e=this.serviceLayer;if(!a)throw Error("featureLayer cannot be null in order to replace the feature layer.");var f=this._getEsriMap();if(!f)throw Error("Unable to get access to the Esri map object to perform the Feature Layer replace.");if(!this.serviceLayer)throw Error("ServiceLayer not present. Can't replace the the FeatureLayer");if(b)a.visible=e.visible;if(c)a.opacity=e.opacity;d&&a.setRenderer(e.renderer);
b=dojo.indexOf(f.graphicsLayerIds,e.id);this.serviceLayer=a;e.suspend();f.removeLayer(e);f.addLayer(a,b);e.url||this._cleanUpLayer(e)};c.prototype._cleanUpLayer=function(a){a.clear();if(a._essentialsMetadata)for(var a=a._essentialsMetadata.eventHandlers,b=0,b=0;b<a.length;b++)dojo.disconnect(a[b])};c.prototype.queryCount=function(a,b,c){this.isServiceLayerLoaded&&this.serviceLayer&&this.serviceLayer.queryCount(a,function(a){b&&b(a)},function(a){c&&c(a)})};c.prototype.queryFeatures=function(a,b,c){return this.isServiceLayerLoaded&&
this.serviceLayer?this.serviceLayer.queryFeatures(a,b,c):(a=Error("Esri layer has not finished loading"),c?(c(a),null):(c=new dojo.Deferred,c.reject(a),c))};c.prototype.queryIds=function(a,b,c){if(this.isServiceLayerLoaded&&this.serviceLayer)return this.serviceLayer.queryIds(a,b,c);else if(c)return a=Error("Esri layer has not finished loading"),c(a),c=new dojo.Deferred,c.reject(a),c};c.prototype.queryRelatedFeatures=function(a,b,c){if(this.isServiceLayerLoaded&&this.serviceLayer)return this.serviceLayer.queryRelatedFeatures(a,
b,c);else if(c)return a=Error("Esri layer has not finished loading"),c(a),c=new dojo.Deferred,c.reject(a),c};c.prototype._getEsriMap=function(){var a=null;this.essentialsMap!==null&&this.essentialsMap.site!==null&&(a=this.essentialsMap.site.getMap());return a};c.prototype._configureObject=function(a,b){if(a===void 0||a.outFields===void 0||a.queryMode===void 0||a.where===void 0)throw Error("Incorrect map service object returned from initialization");this.disableClientCaching=!!a.disableClientCaching;
this.onDemandCacheSize=a.onDemandCacheSize===void 0||a.onDemandCacheSize===null?this.onDemandCacheSize:a.onDemandCacheSize;if(!a.outFields)a.outFields="*";this.outFields=a.outFields;this.where=a.where;if(a.queryMode===void 0)this.queryMode=esri.layers.FeatureLayer.MODE_ONDEMAND;else switch(a.queryMode){case "Selection":case "SelectionOnly":this.queryMode=esri.layers.FeatureLayer.MODE_SELECTION;break;case "Snapshot":this.queryMode=esri.layers.FeatureLayer.MODE_SNAPSHOT;break;default:this.queryMode=
esri.layers.FeatureLayer.MODE_ONDEMAND}if(a.selectionColor)this.selectionColor=a.selectionColor;if(a.color)this.color=a.color,this._colorSet=true,this.color.length>3&&(this.color[3]/=255);d.prototype._configureObject.call(this,a,b)};c.prototype._createServiceLayer=function(){d.prototype._createServiceLayer.call(this);var a=this.serviceUrl;this.serviceToken!==null&&(a=a+"?token="+encodeURIComponent(this.serviceToken));var b={};b.id=this.id;b.opacity=this.configuredOpacity;b.visible=this.configuredVisible;
if(this.outFields&&this.outFields.length>0)b.outFields=this.outFields.split(",");if(this.queryMode!==null)b.mode=this.queryMode;this._serviceLayer=this.serviceLayer=new esri.layers.FeatureLayer(a,b);this.where&&this.serviceLayer.setDefinitionExpression(this.where);dojo.connect(this.serviceLayer,"onError",this,this._layerLoadErrorHandler);this.serviceLayer.loaded?this._handleLayerLoadEvent(this.serviceLayer):dojo.connect(this.serviceLayer,"onLoad",dojo.hitch(this,this._handleLayerLoadEvent))};c.prototype._handleLayerLoadEvent=
function(a){if(this.serviceLayer.version<10||this._colorSet){var b=null;if(this.serviceLayer.geometryType=="esriGeometryPoint"){var b=new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_CIRCLE,15,null,new dojo.Color(this.selectionColor)),c=new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_CIRCLE,15,null,new dojo.Color(this.color));this.serviceLayer.setRenderer(new esri.renderer.SimpleRenderer(c))}else this.serviceLayer.geometryType=="esriGeometryPolyline"?
(b=new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new dojo.Color(this.selectionColor),1),c=new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new dojo.Color(this.color),1),this.serviceLayer.setRenderer(new esri.renderer.SimpleRenderer(c))):this.serviceLayer.geometryType=="esriGeometryPolygon"&&(b=new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new dojo.Color([0,
0,0]),1),new dojo.Color(this.selectionColor)),c=new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new dojo.Color([0,0,0]),1),new dojo.Color(this.color)),this.serviceLayer.setRenderer(new esri.renderer.SimpleRenderer(c)));this.serviceLayer.setSelectionSymbol(b)}b=this.serviceLayer.getEditCapabilities();this.canUpdate=b.canUpdate;this.canAdd=b.canCreate;this.canDelete=b.canDelete;this.canEdit=this.serviceLayer.isEditable();
this.canAddAttachments=false;if(this.serviceLayer.capabilities)this.canAddAttachments=this.serviceLayer.capabilities.toLowerCase().indexOf("uploads")>=0;this._initialFeatureCollection=dojo.toJson(this.serviceLayer.toJson());this._handleServiceLayerLoaded(a)};c.prototype.hasOriginRelationships=function(){if(this.serviceLayer&&this.serviceLayer.version>=10.1&&this.serviceLayer.relationships&&this.serviceLayer.relationships.length>0)for(var a=0;a<this.serviceLayer.relationships.length;a++)if(this.serviceLayer.relationships[a].role===
"esriRelRoleOrigin")return true;return false};c.prototype.getRelatedFeatureLayer=function(a,c,d){var e=new dojo.Deferred;if(this.serviceLayer.version<10.1)return a=Error("getRelatedFeatureLayer is only available for feature layer from ArcGIS 10.1 or greater."),e&&e.fired==-1&&e.resolve(a),typeof d=="function"&&d(a),e;var f=this._getEsriRelation(a);if(!f)return a=Error("Relation not found: "+a),e&&e.reject(a),typeof d=="function"&&d(a),e;a=this.serviceUrl.substring(0,this.serviceUrl.lastIndexOf("/")+
1)+f.relatedTableId;this.serviceToken&&(a+=a.indexOf("?")>-1?"&token=":"?token=",a+=encodeURIComponent(this.serviceToken));a=new esri.layers.FeatureLayer(a,{mode:esri.layers.FeatureLayer.MODE_SELECTION,outFields:["*"]});dojo.connect(a,"onLoad",dojo.hitch(this,function(a){b.deferredResolve(e,a);typeof c=="function"&&c(a)}));dojo.connect(a,"onError",dojo.hitch(this,function(a){e&&e.fired==-1&&e.resolve(a);typeof d=="function"&&d(a)}));return e};c.prototype._getEsriRelation=function(a){typeof a=="string"&&
(a=parseInt(a));if(this.serviceLayer.relationships)for(var b=0;b<this.serviceLayer.relationships.length;b++)if(this.serviceLayer.relationships[b].id==a)return this.serviceLayer.relationships[b];return null};c.prototype._getRelation=function(a){return this.layers&&this.layers.length>0?this.layers[0]._getRelation(a):null};return c}(f.MapService);f.FeatureLayerService=e})(b.essentials||(b.essentials={}))})(geocortex||(geocortex={}));
(function(b){(function(f){var e=function(d){function c(a){d.call(this,a);this.displayName=this.description=null;this.extensions=[];this.visible=this.id=null;this.maximumResolution=300;this.site=this.properties=null;this.supportedMapScales=[];this.supportedOutputFormats=[];this.supportedResolutions=[];this.supportsEmailNotification=false;this.textFields=[];this.grids=[];this.type=b.essentials.ReportType.MAP_TEMPLATE_REPORT;this._printing=false;this._onPrintError=this._onPrintComplete=null;this.extensions=
[];this.properties=[];this.supportedMapScales=[];this.supportedOutputFormats=[];this.supportedResolutions=[];this.textFields=[]}__extends(c,d);c.prototype.isPrinting=function(){return this._printing};c.prototype.print=function(a,c,d){if(this.isPrinting())d&&d(Error("Template already printing"));else{this._printing=true;try{this._onPrintComplete=c;this._onPrintError=d;var e=this.url+"/print",c={},f=d=null;if(this.site!==null)d=this.site.getMap(),f=this.site.essentialsMap;a&&a.toJson&&(c=a.toJson(d,
f));c.symbols&&this._adjustTextSymbols(c.symbols);var n=b.encodeJson(dojo.mixin({f:"json"},c));if(n.graphics&&n.symbols)n.graphics='{"layers":'+n.graphics+', "symbols":'+n.symbols+"}",n.symbols=null}catch(k){this._printRestError(k);return}b.request({url:e,content:n,load:dojo.hitch(this,this._printRestComplete),error:dojo.hitch(this,this._printRestError),callbackParamName:"CallBack"})}};c.prototype._adjustTextSymbols=function(a){for(var b in a)a[b].declaredClass==="esri.symbol.TextSymbol"&&(a[b].yoffset+=
parseInt(a[b].font.size,10)*1.2)};c.prototype._configureObject=function(a,c){if(a===void 0||a.id===void 0||a.displayName===void 0)throw Error("Incorrect print template object returned from initialization");this.description=a.description===void 0?this.description:a.description;this.displayName=a.displayName;this.id=a.id;this.visible=a.visible===void 0?true:a.visible;this.maximumResolution=a.maximumResolution===void 0?this.maximumResolution:a.maximumResolution;this.supportedMapScales=a.supportedScales===
void 0?this.supportedMapScales:a.supportedScales;this.supportedOutputFormats=a.supportedOutputFormats===void 0?this.supportedOutputFormats:a.supportedOutputFormats;this.supportedResolutions=a.supportedResolutions===void 0?this.supportedResolutions:a.supportedResolutions;this.supportsEmailNotification=!!a.supportsEmailNotification;this.textFields=a.textFields===void 0?this.textFields:a.textFields;this.grids=a.grids===void 0?this.grids:a.grids;if(c)this.isInitialized=true;this.properties=b._getProperties(a.properties);
this.extensions=b._getExtensions(a.extensions)};c.prototype._printRestComplete=function(a){this._printing=false;var b=null;if(a){if(a.error)b=a.error}else b=Error("Unexpected Error");b?this._onPrintError&&this._onPrintError(b):this._onPrintComplete&&this._onPrintComplete(a)};c.prototype._printRestError=function(a){this._printing=false;this._onPrintError&&this._onPrintError(a)};return c}(f.AsyncInitializable);f.PrintTemplate=e})(b.essentials||(b.essentials={}))})(geocortex||(geocortex={}));
(function(b){(function(f){var e=function(d){function c(a){d.call(this,a);this.displayName=null;this.extensions=[];this.id=this.extent=null;this.properties={};this.site=null}__extends(c,d);c.prototype.navigateTo=function(){if(this.site){var a=this.site.essentialsMap;a&&a.extentManager.setExtentWithPriority(this.extent,8)}};c.prototype._configureObject=function(a){if(a===void 0||a.id===void 0||a.displayName==void 0||a.extent===void 0)throw Error("Incorrect named extent object returned from initialization");
this.id=a.id;this.displayName=a.displayName;this.extent=new esri.geometry.Extent(a.extent);this.properties=b._getProperties(a.properties);this.extensions=b._getExtensions(a.extensions)};return c}(f.AsyncInitializable);f.NamedExtent=e})(b.essentials||(b.essentials={}))})(geocortex||(geocortex={}));
(function(b){(function(f){var e=function(d){function c(a){d.call(this,a);this.displayName=null;this.extensions=[];this.id=null;this.properties={};this.site=this.geoprocessorUrl=this.geoprocessorType=null}__extends(c,d);c.prototype._configureObject=function(a){if(a.id===void 0||a.displayName===void 0||a.connectionString===void 0)throw Error("Incorrect geoprocessing endpoint object returned from initialization");this.id=a.id;this.displayName=a.displayName;this.geoprocessorType=a.geoprocessorType;this._processConnectionString(a.connectionString);
this.properties=b._getProperties(a.properties);this.extensions=b._getExtensions(a.extensions)};c.prototype._processConnectionString=function(a){var c=b.essentials.ServiceHelper.extractConnectionStringValue;if(this.geoprocessorType===b.essentials.GeoprocessingEndpointType.ARCGIS_GEOPROCESSOR){if((a=c(a,"url"))&&a.length>0)this.geoprocessorUrl=a}else throw Error("Unknown geoprocessor type '"+this.geoprocessorType+"'");};return c}(f.AsyncInitializable);f.GeoprocessingEndpoint=e})(b.essentials||(b.essentials=
{}))})(geocortex||(geocortex={}));(function(b){b=b.essentials||(b.essentials={});(b.GeoprocessingEndpointType||(b.GeoprocessingEndpointType={})).ARCGIS_GEOPROCESSOR="ArcGisGeoprocessor"})(geocortex||(geocortex={}));
(function(b){(function(f){var e=function(d){function c(a){d.call(this,a);this.displayName=null;this.extensions=[];this.id=null;this.properties={};this.site=this.geometryServiceUrl=this.geometryServiceType=null}__extends(c,d);c.prototype._configureObject=function(a){if(a.id===void 0||a.displayName===void 0||a.connectionString===void 0)throw Error("Incorrect geometry endpoint object returned from initialization");this.id=a.id;this.displayName=a.displayName;this.geometryServiceType=a.geoprocessorType;
this._processConnectionString(a.connectionString);this.properties=b._getProperties(a.properties);this.extensions=b._getExtensions(a.extensions)};c.prototype._processConnectionString=function(a){var c=b.essentials.ServiceHelper.extractConnectionStringValue;if(this.geometryServiceType===b.essentials.GeometryEndpointType.ARCGIS_GEOMETRY&&(a=c(a,"url"))&&a.length>0)this.geometryServiceUrl=a};return c}(f.AsyncInitializable);f.GeometryEndpoint=e})(b.essentials||(b.essentials={}))})(geocortex||(geocortex=
{}));(function(b){b=b.essentials||(b.essentials={});(b.GeometryEndpointType||(b.GeometryEndpointType={})).ARCGIS_GEOMETRY="ArcGisGeometry"})(geocortex||(geocortex={}));(function(b){(function(b){var e=function(){function b(){}b.extractConnectionStringValue=function(b,a){if(b.length>0){var d=b.match("(^|;)[s]*"+a+"=([^;]*)");if(d!==null)return d[2]}return""};return b}();b.ServiceHelper=e})(b.essentials||(b.essentials={}))})(geocortex||(geocortex={}));
(function(b){(function(f){var e=function(d){function c(a){d.call(this,a);this.displayName=this.bingProperties=null;this.extensions=[];this.id=null;this.properties={};this.site=this.geocoderUrl=this.geocoderType=null}__extends(c,d);c.prototype._configureObject=function(a){if(!a.hasOwnProperty("id")||!a.hasOwnProperty("displayName")||!a.hasOwnProperty("serviceType")||!a.hasOwnProperty("connectionString"))throw Error("Incorrect geocoding endpoint object returned from initialization");this.id=a.id;this.displayName=
a.displayName;this.geocoderType=a.serviceType;this._processConnectionString(a.connectionString);this.properties=b._getProperties(a.properties);this.extensions=b._getExtensions(a.extensions)};c.prototype._processConnectionString=function(a){var c=b.essentials.ServiceHelper.extractConnectionStringValue;if(this.geocoderType===b.essentials.GeocodingEndpointType.BING_GEOCODER){this.bingProperties={};var d=c(a,"key");if(d&&d.length>0)this.bingProperties.bingMapsKey=d;if((d=c(a,"culture"))&&d.length>0)this.bingProperties.culture=
d}else if(this.geocoderType===b.essentials.GeocodingEndpointType.ARCGIS_GEOCODER&&(a=c(a,"url"))&&a.length>0)this.geocoderUrl=a};return c}(f.AsyncInitializable);f.GeocodingEndpoint=e})(b.essentials||(b.essentials={}))})(geocortex||(geocortex={}));(function(b){b=b.essentials||(b.essentials={});b=b.GeocodingEndpointType||(b.GeocodingEndpointType={});b.ARCGIS_GEOCODER="ArcGisGeocoder";b.BING_GEOCODER="BingGeocoder"})(geocortex||(geocortex={}));
(function(b){(function(f){var e=function(d){function c(a,b){d.call(this,a);this.currentVersion=null;this.deepInitialize=false;this.essentialsMap=this.updateInterval=this.displayName=null;this.extensions=[];this.geocodingEndpoints=[];this.geometryEndpoints=[];this.geoprocessingEndpoints=[];this.hasWorkflows=this.hasVirtualDirectory=this.hasViewers=this.hasPrintTemplates=this.hasOverviewMap=this.hasNorthArrow=this.hasNamedExtents=this.hasGeoprocessingEndpoints=this.hasGeometryEndpoints=this.hasGeocodingEndpoints=
false;this.id=null;this.namedExtents=[];this.overviewMap=null;this.printTemplates=[];this.properties={};this.url=null;this.workflows=[];this.onLayerLoadError=this.onLayerLoad=null;this.onServiceLayersLoaded=function(){};this.onUserSignInCancelled=null;this._initializedHandlerCalled=this._workflowsInitialized=this._printTemplatesInitialized=this._overviewMapInitialized=this._namedExtentsInitialized=this._mapInitialized=this._geoprocessingEndpointsInitialized=this._geometryEndpointsInitialized=this._geocodingEndpointsInitialized=
false;this._tokenIntervalHandle=null;this.url=a;this._esriMap=b}__extends(c,d);c.prototype.initialize=function(){this._initialize()};c.prototype.getResourceById=function(a,c){if(a)for(var d=0;d<a.length;d++){var e=a[d];if(b.essentials.utilities.SiteResourceIdComparer.equals(e.id,c))return e}return null};c.prototype.findWorkflowById=function(a){return this.getResourceById(this.workflows,a)};c.prototype.findPrintTemplateById=function(a){return this.getResourceById(this.printTemplates,a)};c.prototype.getFeatureServices=
function(){var a=[];if(!this.essentialsMap)return a;for(var c=0;c<this.essentialsMap.mapServices.length;c++){var d=this.essentialsMap.mapServices[c];d instanceof b.essentials.FeatureLayerService&&a.push(d)}return a};c.prototype.getMap=function(){return this._esriMap};c.prototype._getVersion=function(){var a=3;if(this.currentVersion){var b=this.currentVersion.split(".");b.length>=2&&(a=parseFloat(b[0]+"."+b[1]))}return a};c.prototype._initAsyncCollection=function(a,c,d,e){if(a&&d&&e)for(var f=0;a&&
f<a.length;f++)if(d[f]=new e(this.url+"/"+c+"/"+a[f].id),d[f].site=this,d[f]._configureObject(a[f]),this.deepInitialize===true&&e!==b.essentials.Workflow)d[f].isInitialized=true;this._siteInitializeUpdate()};c.prototype._initAsyncCollectionErrorHandler=function(a,b){a();this._initializationFailedHandler(b);this._siteInitializeUpdate()};c.prototype._initGeocodingEndpointsHandler=function(a){this._geocodingEndpointsInitialized=true;a&&this._initAsyncCollection(a.geocodingEndpoints,"geocoding",this.geocodingEndpoints,
b.essentials.GeocodingEndpoint)};c.prototype._initGeometryEndpointsHandler=function(a){this._geometryEndpointsInitialized=true;a&&this._initAsyncCollection(a.geometryEndpoints,"geometry",this.geometryEndpoints,b.essentials.GeometryEndpoint)};c.prototype._initGeoprocessingEndpointsHandler=function(a){this._geoprocessingEndpointsInitialized=true;a&&this._initAsyncCollection(a.geoprocessingEndpoints,"geoprocessing",this.geoprocessingEndpoints,b.essentials.GeoprocessingEndpoint)};c.prototype._initialize=
function(){if(!this.isInitialized&&!this._initializing)this._initializedHandlerCalled=false,this._initializing=true,b.request({url:this.url,content:{f:"json",deep:this.deepInitialize},load:dojo.hitch(this,this._verifySiteDependencies),error:dojo.hitch(this,this._initSiteErrorHandler),callbackParamName:"CallBack"})};c.prototype._initMapHandler=function(a){this._mapInitialized=true;if(a!==null&&a.site!==null)a.setExtentOnLoad=false,a.loadServiceLayersInMap(a.site.getMap());this._siteInitializeUpdate()};
c.prototype._initMapErrorHandler=function(a){this._mapInitialized=true;this._initializationFailedHandler(a);this._siteInitializeUpdate()};c.prototype._initNamedExtentsHandler=function(a){this._namedExtentsInitialized=true;a&&this._initAsyncCollection(a.namedExtents,"namedextents",this.namedExtents,b.essentials.NamedExtent)};c.prototype._initOverviewMapHandler=function(){this._overviewMapInitialized=true;this._siteInitializeUpdate()};c.prototype._initOverviewMapErrorHandler=function(a){this._overviewMapInitialized=
true;this._initializationFailedHandler(a);this._siteInitializeUpdate()};c.prototype._initPrintTemplatesHandler=function(a){this._printTemplatesInitialized=true;a&&this._initAsyncCollection(a.printTemplates,"printtemplates",this.printTemplates,b.essentials.PrintTemplate)};c.prototype._getUpdatedServiceTokens=function(){b.request({url:this.url+"/update",content:{f:"json"},load:dojo.hitch(this,this._processServiceTokensHandler),error:dojo.hitch(this,this._processServiceTokensErrorHandler),callbackParamName:"CallBack"})};
c.prototype._processServiceTokensHandler=function(a){a&&a.mapServiceTokens&&this._updateServiceTokens(this.essentialsMap,a.mapServiceTokens);a&&a.overviewMapServiceTokens&&this._updateServiceTokens(this.overviewMap,a.overviewMapServiceTokens)};c.prototype._processServiceTokensErrorHandler=function(a){throw a;};c.prototype._updateServiceTokens=function(a,b){if(a&&b)for(var c=0;b&&c<b.length;c++){var d=a.findMapServiceById(b[c].id);d&&d._updateServiceToken(b[c].token)}};c.prototype._initSiteHandler=
function(a){var c=this;if(!a||a.hasNamedExtents===void 0)throw Error("Incorrect site object returned from initialization");if(a.arcGisPortalAuthentication&&a.arcGisPortalAuthentication.clientID){var d=a.arcGisPortalAuthentication;this.arcGisPortalSecurityContext=new f.ArcGisPortalSecurityContext(d.url,d.domains,d.clientID);if(!this.arcGisPortalSecurityContext.initiate()){if(this.arcGisPortalSecurityContext.error)if(this.arcGisPortalSecurityContext.error.code==f.OAuth2Error.ACCESS_DENIED_ERROR_CODE){if(this.onUserSignInCancelled)this.onUserSignInCancelled({tryAgainAction:dojo.hitch(this,
function(){f.OAuth2Client.redirectToLogOnPage(this.arcGisPortalSecurityContext.getLogOnUrl(),this.arcGisPortalSecurityContext.clientId)})})}else a=Error(),a.name=this.arcGisPortalSecurityContext.error.code,a.message=this.arcGisPortalSecurityContext.error.description,this._initializationFailedHandler(a);return}f.RestHelperHTTPService.arcGisPortalToken=this.arcGisPortalSecurityContext.tokenResult}this.hasGeocodingEndpoints=!!a.hasGeocodingEndpoints;this.hasGeometryEndpoints=!!a.hasGeometryEndpoints;
this.hasGeoprocessingEndpoints=!!a.hasGeoprocessingEndpoints;this.hasNamedExtents=!!a.hasNamedExtents;this.hasNorthArrow=!!a.hasNorthArrow;this.hasOverviewMap=!!a.hasOverviewMap;this.hasPrintTemplates=!!a.hasPrintTemplates;this.hasViewers=!!a.hasViewers;this.hasVirtualDirectory=!!a.hasVirtualDirectory;this.hasWorkflows=!!a.hasWorkflows;this.displayName=a.displayName;this.id=a.id;this.currentVersion=a.currentVersion===void 0?"3.0":a.currentVersion;if(a.hasOwnProperty("updateInterval")){if(this.updateInterval=
parseInt(a.updateInterval),isNaN(this.updateInterval))this.updateInterval=0}else this.updateInterval=0;var e=b.essentials.RestHelperHTTPService.getAuthenticationControlBlockStore().find(this.url);e&&setInterval(function(){(new b.essentials.RestHelperHTTPService)._requestToken(e)},Math.max(6E4,b.essentials.RestHelper.tokenDurationMinutes*6E4-12E4));if(this.updateInterval>0)this._tokenIntervalHandle=setInterval(function(){c._getUpdatedServiceTokens()},Math.max(60,this.updateInterval*1E3));this.properties=
b._getProperties(a.properties);this.extensions=b._getExtensions(a.extensions);this.essentialsMap=new b.essentials.Map(this.url+"/map");this.essentialsMap.site=this;dojo.connect(this.essentialsMap,"onInitialized",dojo.hitch(this,this._initMapHandler));dojo.connect(this.essentialsMap,"onInitializationFailed",dojo.hitch(this,this._initMapErrorHandler));if(this.hasOverviewMap)this.overviewMap=new b.essentials.Map(this.url+"/overviewmap"),this.overviewMap.site=this,dojo.connect(this.overviewMap,"onInitialized",
dojo.hitch(this,this._initOverviewMapHandler)),dojo.connect(this.overviewMap,"onInitializationFailed",dojo.hitch(this,this._initOverviewMapErrorHandler));!this.deepInitialize||this._getVersion()<3.3||a.map===void 0?(this.essentialsMap.initialize(),this.hasOverviewMap?this.overviewMap.initialize():this._overviewMapInitialized=true,this.hasGeocodingEndpoints?b.request({url:this.url+"/geocoding",content:{f:"json"},load:dojo.hitch(this,this._initGeocodingEndpointsHandler),error:dojo.hitch(this,this._initAsyncCollectionErrorHandler,
dojo.hitch(this,function(){this._geocodingEndpointsInitialized=true})),callbackParamName:"CallBack"}):this._geocodingEndpointsInitialized=true,this.hasGeometryEndpoints?b.request({url:this.url+"/geometry",content:{f:"json"},load:dojo.hitch(this,this._initGeometryEndpointsHandler),error:dojo.hitch(this,this._initAsyncCollectionErrorHandler,dojo.hitch(this,function(){this._geometryEndpointsInitialized=true})),callbackParamName:"CallBack"}):this._geometryEndpointsInitialized=true,this.hasGeoprocessingEndpoints?
b.request({url:this.url+"/geoprocessing",content:{f:"json"},load:dojo.hitch(this,this._initGeoprocessingEndpointsHandler),error:dojo.hitch(this,this._initAsyncCollectionErrorHandler,dojo.hitch(this,function(){this._geoprocessingEndpointsInitialized=true})),callbackParamName:"CallBack"}):this._geoprocessingEndpointsInitialized=true,this.hasNamedExtents?b.request({url:this.url+"/namedextents",content:{f:"json"},load:dojo.hitch(this,this._initNamedExtentsHandler),error:dojo.hitch(this,this._initAsyncCollectionErrorHandler,
dojo.hitch(this,function(){this._namedExtentsInitialized=true})),callbackParamName:"CallBack"}):this._namedExtentsInitialized=true,this.hasPrintTemplates?b.request({url:this.url+"/printtemplates",content:{f:"json"},load:dojo.hitch(this,this._initPrintTemplatesHandler),error:dojo.hitch(this,this._initAsyncCollectionErrorHandler,dojo.hitch(this,function(){this._printTemplatesInitialized=true})),callbackParamName:"CallBack"}):this._printTemplatesInitialized=true,this.hasWorkflows?b.request({url:this.url+
"/workflows",content:{f:"json"},load:dojo.hitch(this,this._initWorkflowsHandler),error:dojo.hitch(this,this._initAsyncCollectionErrorHandler,dojo.hitch(this,function(){this._workflowsInitialized=true})),callbackParamName:"CallBack"}):this._workflowsInitialized=true):(this._initGeocodingEndpointsHandler(a),this._initGeometryEndpointsHandler(a),this._initGeoprocessingEndpointsHandler(a),this.essentialsMap.initialize(a.map),this._initNamedExtentsHandler(a),a.overviewMap?this.overviewMap.initialize(a.overviewMap):
(this._overviewMapInitialized=true,this._siteInitializeUpdate()),this._initPrintTemplatesHandler(a),this._initWorkflowsHandler(a));this._siteInitializeUpdate()};c.prototype._initSiteErrorHandler=function(a){this._workflowsInitialized=this._printTemplatesInitialized=this._namedExtentsInitialized=this._geoprocessingEndpointsInitialized=this._geometryEndpointsInitialized=this._geocodingEndpointsInitialized=true;this._initializationFailedHandler(a);this._siteInitializeUpdate()};c.prototype._initWorkflowsHandler=
function(a){this._workflowsInitialized=true;a&&this._initAsyncCollection(a.workflows,"workflows",this.workflows,b.essentials.Workflow)};c.prototype._siteInitializeUpdate=function(){if(this._geocodingEndpointsInitialized&&this._geometryEndpointsInitialized&&this._geoprocessingEndpointsInitialized&&this._mapInitialized&&this._namedExtentsInitialized&&this._overviewMapInitialized&&this._printTemplatesInitialized&&this._workflowsInitialized&&!this._initializedHandlerCalled)this._initializedHandlerCalled=
true,this._initializedHandler(this)};c.prototype._verifySiteDependencies=function(a){a&&a.hasFeatureLayers?dojo.addOnLoad(dojo.hitch(this,function(){this._initSiteHandler(a)})):this._initSiteHandler(a)};return c}(f.AsyncInitializable);f.Site=e})(b.essentials||(b.essentials={}))})(geocortex||(geocortex={}));
(function(b){(function(f){var e=function(d){function c(a){d.call(this,a);this.error=this.displayName=null;this.extensions=[];this.externalActivities={};this.id=null;this.properties={};this.site=null;this._inputs=[];this._outputs=[]}__extends(c,d);c.prototype.getInputs=function(){return this._cloneArgumentInfoCollection(this._inputs)};c.prototype.getOutputsMetadata=function(){return this._cloneArgumentInfoCollection(this._outputs)};c.prototype._cloneArgumentInfoCollection=function(a){var b=null;if(a!==
null)for(var b=[],c=0;c<a.length;c++)b.push(a[c]._internalClone());return b};c.prototype._configureObject=function(a){if(a.id===void 0||a.displayName===void 0)throw Error("Incorrect workflow object returned from initialization");var c,d;this.id=a.id;this.displayName=a.displayName;this.error=a.error;this._inputs=[];this._outputs=[];this.externalActivities=[];if(a.inputs)for(var e=0;e<a.inputs.length;e++)c=a.inputs[e],d=new b.workflow.ArgumentInfo,d._configureObject(c),this._inputs[e]=d;if(a.outputs)for(e=
0;e<a.outputs.length;e++)c=a.outputs[e],d=new b.workflow.ArgumentInfo,d._configureObject(c),this._outputs[e]=d;if(a.externalActivities)for(e=0;e<a.externalActivities.length;e++)c=a.externalActivities[e],d=new b.workflow.ExternalActivityInfo,d._configureObject(c),this.externalActivities[e]=d;this.properties=b._getProperties(a.properties);this.extensions=b._getExtensions(a.extensions)};return c}(f.AsyncInitializable);f.Workflow=e})(b.essentials||(b.essentials={}))})(geocortex||(geocortex={}));
(function(b){(function(f){var e=function(){function d(b,a,d,e){this.activityComplete=null;this._dispatcher=b;this._pendingIndex=a;this._workflow=d;this._workflowState=e}d.prototype.dispatcher=function(){return this._dispatcher};d.prototype.workflow=function(){return this._workflow};d.prototype.getDisplayName=function(){return this._workflowState?this._workflowState.pendingExternalActivities[this._pendingIndex].displayName:""};d.prototype.getInputNames=function(){var b=[];if(this._workflowState)for(var a=
this._workflowState.pendingExternalActivities[this._pendingIndex].inputs,d=0;d<a.length;d++)b.push(a[d].name);return b};d.prototype.getInputNamesByType=function(b){var a=[];if(this._workflowState)for(var d=this._workflowState.pendingExternalActivities[this._pendingIndex].inputs,e=0;e<d.length;e++)d[e].typeName.indexOf(b)===0&&a.push(d[e].name);return a};d.prototype.getOutputNames=function(){var b=[];if(this._workflowState)for(var a=this._workflowState.pendingExternalActivities[this._pendingIndex].outputs,
d=0;d<a.length;d++)b.push(a[d].name);return b};d.prototype.getOutputNamesByType=function(b){var a=[];if(this._workflowState)for(var d=this._workflowState.pendingExternalActivities[this._pendingIndex].outputs,e=0;e<d.length;e++)d[e].typeName.indexOf(b)===0&&a.push(d[e].name);return a};d.prototype.getSite=function(){return this._workflow!=null?this._workflow.site:null};d.prototype.getEsriMap=function(){return this._workflow!=null&&this._workflow.site!=null?this._workflow.site.getMap():null};d.prototype.getValue=
function(b){if(this._workflowState)for(var a=this._workflowState.pendingExternalActivities[this._pendingIndex].inputs,d=0;d<a.length;d++)if(a[d].name==b)return a[d].value;return null};d.prototype.getOutputValue=function(b){if(this._workflowState)for(var a=this._workflowState.pendingExternalActivities[this._pendingIndex].outputs,d=0;d<a.length;d++)if(a[d].name==b)return a[d].value;return null};d.prototype.getJsonValue=function(b){for(var a=this._workflowState.pendingExternalActivities[this._pendingIndex].inputs,
d=0;d<a.length;d++)if(a[d].name==b)return dojo.toJson(a[d].value);return null};d.prototype.getOutputJsonValue=function(b){if(this._workflowState)for(var a=this._workflowState.pendingExternalActivities[this._pendingIndex].outputs,d=0;d<a.length;d++)if(a[d].name==b)return(b=a[d].value)&&b.length===1&&(b=b[0]),dojo.toJson(b);return null};d.prototype.setValue=function(c,a,d){if(this._workflowState){var e=false,f=this._workflowState.pendingExternalActivities[this._pendingIndex].outputs,p=this._getRuntimeType(a);
if(a&&a instanceof b.workflow.ArgumentValueWrapper)p=a.runtimeTypeName,a=a.value;for(var n=0;n<f.length;n++)if(f[n].name==c){e=true;if(f=f[n])if(f.value=a,p!=null)f.runtimeTypeName=p;break}if(!e&&d)p||(p="System.Object"),f=new b.workflow.ArgumentInfo,f.isRequired=false,f.name=c,f.value=a,f.typeName=p,f.runtimeTypeName=p,this._workflowState.pendingExternalActivities[this._pendingIndex].outputs.push(f)}};d.prototype.getActivityTypeName=function(){var b="";if(this._workflowState&&(b=this._workflowState.pendingExternalActivities[this._pendingIndex].typeName)){var a=
b.indexOf("`");a>=0&&(b=b.substring(0,a))}return b};d.prototype.getActivityExternalId=function(){return this._workflowState?this._workflowState.pendingExternalActivities[this._pendingIndex].externalId:""};d.prototype.getInputArgumentTypeName=function(b){if(this._workflowState)for(var a=this._workflowState.pendingExternalActivities[this._pendingIndex].inputs,d=0;d<a.length;d++)if(a[d].name==b)return a[d].typeName;return""};d.prototype.getInputArgumentRuntimeTypeName=function(b){for(var a=this._workflowState.pendingExternalActivities[this._pendingIndex].inputs,
d=0;d<a.length;d++)if(a[d].name==b)return a[d].runtimeTypeName;return""};d.prototype.completeActivity=function(){if(this._workflowState){var c=this._workflowState.pendingExternalActivities[this._pendingIndex];if(!c.isComplete){var a=this;this.getActivityExternalId()=="debugger"||c&&c.debug?b.workflow.DefaultActivityHandlers.showDebug(this,false,function(){a._completeActivityInternal()}):this._completeActivityInternal()}}};d.prototype._completeActivityInternal=function(){if(this._workflowState){var c=
this._workflowState.pendingExternalActivities[this._pendingIndex];c.isComplete=true;this._dispatcher!=null&&this._dispatcher.activityComplete(this);c.inputs=null;var c=this._workflowState.pendingExternalActivities[this._pendingIndex].syncToken,a=true;if(c!="")for(var d=this._workflowState.pendingExternalActivities,e=0;e<d.length;e++)if(d[e].syncToken==c&&!d[e].isComplete){a=false;break}a&&(b.workflow.WorkflowControllerProxy._executeWorkflow(this._workflow,this._dispatcher,this._workflowState,null,
this),dojo.isFunction(this.activityComplete)&&this.activityComplete(this))}};d.prototype._getRuntimeType=function(b){var a="System.Object";b&&(typeof b.isInstanceOf=="function"?b.isInstanceOf(esri.geometry.Extent)?a="ESRI.ArcGIS.Client.Geometry.Envelope":b.isInstanceOf(esri.geometry.Extent)?a="ESRI.ArcGIS.Client.Geometry.Envelope":b.isInstanceOf(esri.geometry.Point)?a="ESRI.ArcGIS.Client.Geometry.MapPoint":b.isInstanceOf(esri.geometry.Multipoint)?a="ESRI.ArcGIS.Client.Geometry.MultiPoint":b.isInstanceOf(esri.geometry.Polygon)?
a="ESRI.ArcGIS.Client.Geometry.Polygon":b.isInstanceOf(esri.geometry.Polyline)?a="ESRI.ArcGIS.Client.Geometry.Polyline":b.isInstanceOf(esri.geometry.Geometry)?a="ESRI.ArcGIS.Client.Geometry.Geometry":b.isInstanceOf(esri.layers.LayerDataSource)?a="ESRI.ArcGIS.Client.LayerDataSource":b.isInstanceOf(esri.layers.LayerMapSource)&&(a="ESRI.ArcGIS.Client.LayerMapSource"):typeof b=="string"?a="System.String":typeof b=="number"?a="System.Double":typeof b=="boolean"?a="System.Boolean":typeof b=="object"&&(a=
typeof b.getMonth=="function"?"System.DateTime":"System.Object"));return a};return d}();f.ActivityContext=e})(b.workflow||(b.workflow={}))})(geocortex||(geocortex={}));
(function(b){(function(f){(function(e){e.startWorkflow=function(b,c,a){e._executeWorkflow(b,c,null,a,null)};e._executeWorkflow=function(d,c,a,g,e){var f={};if(d==null)if(a=Error("workflow cannot be null"),c!=null){c.handleError(a,null);return}else throw a;var p=d.url+"/run";if(g)b.workflow.WorkflowControllerProxy._preProcessArguments(g),f.inargs=dojo.toJson(g);if(a!=null){for(var g=a.pendingExternalActivities,n=0;n<g.length;n++)b.workflow.WorkflowControllerProxy._preProcessArguments(g[n].outputs);
f.workflow=dojo.toJson(a)}f=b.encodeJson(dojo.mixin({f:"json"},f));if(c!=null)c.isBusy=true;b.request({url:p,content:f,load:dojo.hitch(this,function(a){b.workflow.WorkflowControllerProxy._processWorkflowResults(a,d,c)}),error:dojo.hitch(this,function(a){if(c!=null)c.isBusy=false,c.handleError(a,e);else throw a;}),callbackParamName:"CallBack"})};e._processWorkflowResults=function(d,c,a){if(a!=null)a.isBusy=false;if(d)if(d.error)b.workflow.WorkflowControllerProxy._handleErrorInternal(a,Error("Error running workflow: "+
d.error.message));else if(d=new b.workflow._WorkflowState(d.instanceId,d.status,b.workflow.WorkflowControllerProxy._getExternalActivities(d.pendingExternalActivities),b.workflow.WorkflowControllerProxy._getArguments(d.outputs),d.workflowData,d.instanceData),d.status=="Completed")a!=null&&a.workflowComplete(d.outputs,c);else if(d.status=="WaitingForExternalActivities"){var g=d.pendingExternalActivities;if(g!=null)for(var e=0;e<g.length;e++){var f=new b.workflow.ActivityContext(a,e,c,d);a!=null&&a.activityBegin(f);
var p=g[e];b.workflow.WorkflowControllerProxy._preProcessArguments(p.inputs);try{f.getActivityExternalId()=="debugger"||p&&p.debug?b.workflow.DefaultActivityHandlers.showDebug(f,true,function(){b.workflow.WorkflowControllerProxy._dispatch(f)}):b.workflow.WorkflowControllerProxy._dispatch(f)}catch(n){b.workflow.WorkflowControllerProxy._handleErrorInternal(a,n,f)}}}};e._handleErrorInternal=function(b,c,a){if(b!=null)b.handleError(c,a||null);else throw c;};e._preProcessArguments=function(d){if(d!=null)for(var c=
0;c<d.length;c++){var a=function(a){var b=a,c=a.indexOf(",");c>0&&(b=a.substring(0,c));return b},g=a(d[c].runtimeTypeName);d[c].value=b.workflow.WorkflowControllerProxy._getObjectFromJsonWithType(d[c].value,g);if(d[c].value==null)a=a(d[c].typeName),d[c].value=b.workflow.WorkflowControllerProxy._getObjectFromJsonWithType(d[c].value,a)}};e._getObjectFromJsonWithType=function(b,c){var a=b;switch(c){case "ESRI.ArcGIS.Client.Tasks.FeatureSet":b!=null&&(a=new esri.tasks.FeatureSet(b));break;case "ESRI.ArcGIS.Client.Geometry.Geometry":case "ESRI.ArcGIS.Client.Geometry.Envelope":case "ESRI.ArcGIS.Client.Geometry.MapPoint":case "ESRI.ArcGIS.Client.Geometry.MultiPoint":case "ESRI.ArcGIS.Client.Geometry.Polygon":case "ESRI.ArcGIS.Client.Geometry.Polyline":if(b!=
null&&(a=esri.geometry.fromJson(b))&&a.spatialReference&&!b.spatialReference)a.spatialReference=null;break;case "ESRI.ArcGIS.Client.Geometry.SpatialReference":b!=null&&(a=new esri.SpatialReference(b));break;case "ESRI.ArcGIS.Client.LayerMapSource":var g=b;g&&(a=new esri.layers.LayerMapSource(g));break;case "ESRI.ArcGIS.Client.LayerDataSource":(g=b)&&(a=new esri.layers.LayerDataSource(g));break;case "System.DateTime":b instanceof Date&&(a="/Date("+b.getTime()+")/")}return a};e._getExternalActivities=
function(d){var c=[];if(d!=null)for(var a=0;a<d.length;a++){var g=d[a],e=new b.workflow.ExternalActivityInfo;e._configureObject(g);c[a]=e}return c};e._getArguments=function(d){arguments=[];if(d!=null)for(var c=0;c<d.length;c++){var a=d[c],g=new b.workflow.ArgumentInfo;g._configureObject(a);arguments[c]=g}return arguments};e._dispatch=function(b){if(b.dispatcher()!=null)b.dispatcher().dispatch(b);else throw Error("Unhandled activity: "+b.getActivityTypeName());}})(f.WorkflowControllerProxy||(f.WorkflowControllerProxy=
{}))})(b.workflow||(b.workflow={}))})(geocortex||(geocortex={}));(function(b){(function(f){var e=function(){function d(b,a,d){this.display=b;this.value=a;this.typeName=d}d.prototype.getValue=function(){var c=this.value;this.typeName!=null&&(c=b.workflow.WorkflowControllerProxy._getObjectFromJsonWithType(c,this.typeName));this.value!=null&&typeof this.value.__type!="undefined"&&delete c.__type;return c};return d}();f.DataItem=e})(b.forms||(b.forms={}))})(geocortex||(geocortex={}));
(function(b){(function(f){(function(e){e.initDataItemsFormItem=function(d,c,a){d.dataItems=new ObservableCollection;if(c&&(c=b.forms.getElement(c,"DataItems"),c!=null))for(var g=0;g<c.childNodes.length;g++){var e=c.childNodes[g],e=new b.forms.DataItem(b.forms.getElementText(e,"Display"),b.forms.getElementText(e,"Value"),b.forms.getElementText(e,"TypeName"));e!=null&&d.dataItems.addItem(e)}if(a&&(a=a.inputData)&&a.hasOwnProperty(d.itemID.get()))a=a[d.itemID.get()],d.dataItems.addItems(a)}})(f.items||
(f.items={}))})(b.forms||(b.forms={}))})(geocortex||(geocortex={}));
(function(b){(function(f){(function(e){var d=function(){function c(a,c){this.cascadingEvent=new b.framework.events.Event("cascadingEvent");this.isBusy=new Observable(false);this._queryId=0;if(!a.queryTaskRunner)a.queryTaskRunner=this;if(a.queryTaskRunner!==this)throw Error("FormItem in the constructor must be the QueryTaskFormItem containing the QueryTaskRunner");this.formItem=a;c?(this.queryDisplayOutputField=new Observable(b.forms.getElementText(c,"QueryDisplayOutputField")),this.queryValueOutputField=
new Observable(b.forms.getElementText(c,"QueryValueOutputField")),this.queryServiceUrl=new Observable(b.forms.getElementText(c,"QueryServiceUrl")),this.queryWhereClause=new Observable(b.forms.getElementText(c,"QueryWhereClause")),this.filterByInputGeometry=new Observable(b.forms._parseBoolean(b.forms.getElementText(c,"FilterByInputGeometry"))),this.queryCascadingID=new Observable(b.forms.getElementText(c,"QueryCascadingID")),this.proxyUrl=new Observable(b.forms.getElementText(c,"ProxyUrl")),this.token=
new Observable(b.forms.getElementText(c,"Token"))):(this.queryDisplayOutputField=new Observable(null),this.queryValueOutputField=new Observable(null),this.queryServiceUrl=new Observable(null),this.queryWhereClause=new Observable(null),this.filterByInputGeometry=new Observable(false),this.queryCascadingID=new Observable(null),this.proxyUrl=new Observable(null),this.token=new Observable(null));a.formDefinition.map(a);var d=this.queryCascadingID.get();d!=null&&d!=""&&a.formDefinition.addCascading(d,
a,function(a){a?this.queryTaskRunner.performQuery(a):(this.clearDataItems(),this.triggerCascading(null))});if(!a.isBusy)a.isBusy=new Observable(false);a.isBusy.sync(this.isBusy)}c.prototype.triggerCascading=function(a){this.cascadingEvent.publish(a)};c.prototype.isQueryable=function(){return this.queryServiceUrl.get()==null||dojo.trim(this.queryServiceUrl.get())===""||this.queryWhereClause.get()==null||dojo.trim(this.queryWhereClause.get())===""||this.queryDisplayOutputField.get()==null||dojo.trim(this.queryDisplayOutputField.get())===
""?false:true};c.prototype.performQuery=function(a,c){var d=this;if(this.isQueryable()&&(this.formItem.dataItems.clear(),a!=null)){var e=null;if(d.filterByInputGeometry.get()&&d.formItem.formDefinition!=null&&d.formItem.formDefinition.inputGeometry)e=d.formItem.formDefinition.inputGeometry;var f=d.queryServiceUrl.get();this.token&&this.token.get()&&(f+=(dojo.indexOf(f,"?")>=0?"&":"?")+"token="+this.token.get());var n=new esri.tasks.QueryTask(f);a&&typeof a==="number"&&(a=a.toString());var f=(a||"").replace(/\'/g,
"''"),k=new esri.tasks.Query;k.returnGeometry=false;k.geometry=e;k.outFields=[];k.where=d.queryWhereClause.get().format(f);k.outFields.push(d.queryDisplayOutputField.get());d.queryValueOutputField.get()!=null&&dojo.trim(d.queryValueOutputField.get())!=""&&d.queryValueOutputField.get()!=d.queryDisplayOutputField.get()&&k.outFields.push(d.queryValueOutputField.get());this.isBusy.set(true);++this._queryId;(function(){var a=d._queryId;n.execute(k,function(e){var f=[];if(a==d._queryId){for(var o=0;o<e.features.length;++o){var k=
e.features[o].attributes,p=k[d.queryDisplayOutputField.get()],k=d.queryValueOutputField.get()!=null&&dojo.trim(d.queryValueOutputField.get())!=""&&d.queryValueOutputField.get()!=d.queryDisplayOutputField.get()?k[d.queryValueOutputField.get()]:p;f.push(new b.forms.DataItem(p,k,null))}f.sort(function(a,b){return a.display<b.display?-1:1});d.formItem.prepareForResults&&d.formItem.prepareForResults();e={};p=[];for(o=0;o<f.length;++o){var k=f[o],n=k.display+"-"+k.value;e.hasOwnProperty(n)||(e[n]=true,
p.push(k))}d.formItem.dataItems.addItems(p);d.isBusy.set(false);f=null;d.formItem.dataItems.getLength()>0&&(f=d.formItem.dataItems.getAt(0));c===true&&d.triggerCascading(f==null?null:f.value);d.formItem.handleResultsComplete&&d.formItem.handleResultsComplete()}})})()}};return c}();e.QueryTaskRunner=d})(f.items||(f.items={}))})(b.forms||(b.forms={}))})(geocortex||(geocortex={}));
(function(b){(function(f){(function(e){var d=function(c){function a(a,d){c.call(this,a,d);this.isBusy=new Observable(false);this.formItemType="AutoCompleteBoxFormItem";a?(this.minimumPrefixLength=new Observable(parseInt(b.forms.getElementText(a,"MinimumPrefixLength"))),this.minimumPopulateDelay=new Observable(parseInt(b.forms.getElementText(a,"MinimumPopulateDelay")))):(this.minimumPrefixLength=new Observable(3),this.minimumPopulateDelay=new Observable(200));e.initDataItemsFormItem(this,a,d);this.queryTaskRunner=
new e.QueryTaskRunner(this,a,d)}__extends(a,c);a.prototype.clearDataItems=function(){this.dataItems.clear()};return a}(e.TextBoxFormItem);e.AutoCompleteBoxFormItem=d})(f.items||(f.items={}))})(b.forms||(b.forms={}))})(geocortex||(geocortex={}));
(function(b){(function(f){(function(e){var d=function(c){function a(a,d){c.call(this,a,d);this.formItemType="CheckBoxFormItem";a?(this.text=new Observable(b.forms.getElementText(a,"Text")),this.checked=new Observable(b.forms._parseBoolean(b.forms.getElementText(a,"Checked"))),this.textLocation=new Observable(b.forms.getElementText(a,"TextLocation"))):(this.text=new Observable(""),this.checked=new Observable(false),this.textLocation=new Observable("Right"))}__extends(a,c);a.prototype.getResult=function(){return new b.forms.items.FormItemResult(this.argumentName.get(),
this.checked.get())};a.prototype._render=function(){return b.forms.renderFormItem(this)};return a}(e.AbstractFormItem);e.CheckBoxFormItem=d})(f.items||(f.items={}))})(b.forms||(b.forms={}))})(geocortex||(geocortex={}));
(function(b){(function(f){(function(e){var d=function(c){function a(a,d){c.call(this,a,d);this._defaultSet=false;this.selectText=new Observable(null);this.selected=new Observable;this.defaultSelectedValue=new Observable(null);this.isBusy=new Observable(false);this.formItemType="ComboBoxFormItem";e.initLabelContainer(this,a,d);if(a){var f=b.forms.getElementText(a,"SelectText");f&&this.selectText.set(f);(f=b.forms.getElementText(a,"SelectedValue"))&&this.defaultSelectedValue.set(f)}e.initDataItemsFormItem(this,
a,d);this.prepareForResults();this.queryTaskRunner=new e.QueryTaskRunner(this,a,d);f=this.queryTaskRunner.queryCascadingID.get();(f==null||f=="")&&this.queryTaskRunner.performQuery("")}__extends(a,c);a.prototype.clearDataItems=function(){this.dataItems.clear()};a.prototype._hasRealDataItem=function(){return this.selected.get()!=null};a.prototype.triggerCascading=function(a){(this.selected.get()==null||!a)&&this.queryTaskRunner.cascadingEvent.publish(null);var b=this.selected.get();b===null&&(b=a);
b===null||b===void 0?this.queryTaskRunner.cascadingEvent.publish(null):this.queryTaskRunner.cascadingEvent.publish(b.value)};a.prototype.prepareForResults=function(){if(this.selectText.get()){var a=this.selectText.get();this.dataItems.insertItem(0,new b.forms.DataItem(a,"",null));this.selected.set(this.dataItems.getAt(0))}};a.prototype.handleResultsComplete=function(){if(this.defaultSelectedValue.get()&&!this._defaultSet){var a=dojo.filter(this.dataItems.getItems(),dojo.hitch(this,function(a){return a.value+
""===this.defaultSelectedValue.get()+""}));a.length>0?this.selected.set(a[0]):this.dataItems.length()>0&&this.selected.set(this.dataItems.getAt(0));this._defaultSet=true}};a.prototype.getResult=function(){if(this.selected.get()==null)return new b.forms.items.FormItemResult(this.argumentName.get(),null);var a=this.selected.get();return!a?new b.forms.items.FormItemResult(this.argumentName.get(),null):new b.forms.items.FormItemResult(this.argumentName.get(),a.getValue())};a.prototype._addOption=function(a,
c){this.dataItems.addItem(new b.forms.DataItem(a,c))};a.prototype._render=function(){return b.forms.renderFormItem(this)};return a}(e.AbstractFormItem);e.ComboBoxFormItem=d})(f.items||(f.items={}))})(b.forms||(b.forms={}))})(geocortex||(geocortex={}));
(function(b){(function(f){(function(e){var d=function(c){function a(a,d){c.call(this,a,d);this.initialTime=new Observable;this.timeFormat=new Observable;this._timeFormatStr=new Observable;this.formItemType="TimePickerFormItem";e.initLabelContainer(this,a,d);if(a){var f=b.forms.getElementText(a,"InitialTime");f?(b.framework.utils.DateUtils.containsTimezone(f)||(f+=b.framework.utils.DateUtils.getTimezoneString()),this.initialTime.set(Date.fromISO(f)),this.timeFormat.set(b.forms.getElementText(a,"TimeFormat"))):
this.initialTime.set(new Date)}this.time=this.initialTime.get()?new Observable(this.initialTime.get()):new Observable(new Date);this.timeFormat.bind(this,function(a){a==="LongTime"?this._timeFormatStr.set("hh:mm:ss tt"):this._timeFormatStr.set("hh:mm tt")});this.timeFormat.pulse()}__extends(a,c);a.prototype.getResult=function(){var a=this.time.get(),a=new Date(a.toString()),a="/Date({0})/".format(a.getTime());return new b.forms.items.FormItemResult(this.argumentName.get(),a)};a.prototype._render=
function(){return b.forms.renderFormItem(this)};return a}(e.AbstractFormItem);e.TimePickerFormItem=d})(f.items||(f.items={}))})(b.forms||(b.forms={}))})(geocortex||(geocortex={}));
(function(b){(function(f){(function(e){var d=function(c){function a(a,d){c.call(this,a,d);this.nullable=new Observable(false);this._dateFormatStr=new Observable;this.formItemType="DatePickerFormItem";e.initLabelContainer(this,a,d);if(a){this.dateFormat=new Observable(b.forms.getElementText(a,"DateFormat"));this.includeTimePicker=new Observable(b.forms.getElementText(a,"IncludeTimePicker")==="true");var f=null;if(this.includeTimePicker.get())this.timePickerItem=new e.TimePickerFormItem(b.forms.getElement(a,
"TimePickerItem")),f=this.timePickerItem.initialTime.get();var p=b.forms.getElementText(a,"InitialDate");if(p){if(b.framework.utils.DateUtils.containsTimezone(p)){var n=Math.max(p.lastIndexOf("Z"),p.lastIndexOf("+"),p.lastIndexOf("-"));n>0&&(p=p.substring(0,n))}p+=b.framework.utils.DateUtils.getTimezoneString()}p=new Date(p);isNaN(p.getTime())?this.initialDate=new Observable(f):(p.getTimezoneOffset()!=b.framework.utils.DateUtils.getTimezoneOffset()&&p.setTime(p.getTime()-(b.framework.utils.DateUtils.getTimezoneOffset()-
p.getTimezoneOffset())*6E4),f&&(p.setHours(f.getHours()),p.setMinutes(f.getMinutes()),p.setSeconds(f.getSeconds())),this.initialDate=new Observable(p))}else this.dateFormat=new Observable("Long"),this.initialDate=new Observable(null),this.includeTimePicker=new Observable(false);this.initialDate.get()?this.date=new Observable(this.initialDate.get()):(f=new Date,this.includeTimePicker.get()||(f.setHours(0),f.setMinutes(0),f.setSeconds(0)),this.date=new Observable(f));this.dateFormat.bind(this,function(a){a===
"Long"?this._dateFormatStr.set("DD MM dd, yy"):this._dateFormatStr.set("mm/dd/yy")});this.dateFormat.pulse()}__extends(a,c);a.prototype.getResult=function(){var a=this.date.get(),c=new Date(a.toString()),d=0;!(a instanceof Date)&&!this.includeTimePicker.get()&&(d=c.getTimezoneOffset()*6E4);c="/Date({0})/".format(c.getTime()+d);return new b.forms.items.FormItemResult(this.argumentName.get(),c)};a.prototype._render=function(){return b.forms.renderFormItem(this)};return a}(e.AbstractFormItem);e.DatePickerFormItem=
d})(f.items||(f.items={}))})(b.forms||(b.forms={}))})(geocortex||(geocortex={}));
(function(b){(function(f){(function(e){var d=function(c){function a(a,d){c.call(this,a,d);this.files=new ObservableCollection;this.formItemType="FilePickerFormItem";this.isSupported=new Observable(typeof FileReader!=="undefined"&&this._isFileInputSupported());a?(this.acceptFileTypes=new Observable(b.forms.getElementText(a,"AcceptFileTypes")),this.allowMultiple=new Observable(b.forms._parseBoolean(b.forms.getElementText(a,"AllowMultiple")))):(this.acceptFileTypes=new Observable(null),this.allowMultiple=
new Observable(false));e.initLabelContainer(this,a,d)}__extends(a,c);a.prototype.clear=function(){this.files.clear();this.refresh()};a.prototype.getResult=function(){for(var a=[],c=0;c<this.files.getLength();++c){var d=this.files.getAt(c);d&&a.push(d)}a=new b.workflow.ArgumentValueWrapper("System.Collections.Generic.List`1[[Geocortex.Forms.Client.FileItem, Geocortex.EssentialsWpfApi]]",a);return new e.FormItemResult(this.argumentName.get(),a,true)};a.prototype._render=function(){return b.forms.renderFormItem(this)};
a.prototype._isFileInputSupported=function(){if(navigator.userAgent.match(/(Android (1.0|1.1|1.5|1.6|2.0|2.1))|(Windows Phone (OS 7|8.0))|(XBLWP)|(ZuneWP)|(w(eb)?OSBrowser)|(webOS)|(Kindle\/(1.0|2.0|2.5|3.0))/))return false;var a=document.createElement("input");a.type="file";return!a.disabled};return a}(e.AbstractFormItem);e.FilePickerFormItem=d})(f.items||(f.items={}))})(b.forms||(b.forms={}))})(geocortex||(geocortex={}));
(function(b){(function(f){(function(e){var d=function(c){function a(a,d){c.call(this,a,d);this.formItems=new ObservableCollection;this.formItemType="ContainerFormItem";if(a){this.orientation=new Observable(b.forms.getElementText(a,"Orientation"));this.description=new Observable(b.forms.getElementText(a,"Description"));this.maxWidth=new Observable(parseInt(b.forms.getElementText(a,"MaxWidth")));var e=b.forms.getElement(a,"FormItems");if(e!=null)for(var f=0;f<e.childNodes.length;f++){var n=b.forms.items._processFormItem(e.childNodes[f],
this.formDefinition);if(n!=null){this.formItems.addItem(n);var k=this;n.refresh=function(){var a=k.formItems.indexOf(this);a>=0&&(k.formItems.removeAt(a),k.formItems.insertItem(a,this))}}}}else this.orientation=new Observable("Vertical"),this.description=new Observable(""),this.maxWidth=new Observable(NaN)}__extends(a,c);a.prototype.validate=function(){var a=[];if(this.formItems!=null)for(var b=0;b<this.formItems.getLength();++b)for(var c=this.formItems.getAt(b).validate(),d=0;d<c.length;++d)a.push(c[d]);
return a};a.prototype._getResults=function(){for(var b=[],c=0;c<this.formItems.getLength();++c){var d=this.formItems.getAt(c);if(d instanceof a){if(d=d._getResults(),d!=null)for(var e=0;e<d.length;++e)b.push(d[e])}else d=d.getResult(),d!=null&&b.push(d)}return b};a.prototype._destroy=function(){for(var a=this.formItems.length()-1;a>=0;a--)this.formItems.getAt(a)._destroy();this.formItems.clear()};a.prototype._render=function(){return b.forms.renderFormItem(this)};return a}(e.AbstractFormItem);e.ContainerFormItem=
d})(f.items||(f.items={}))})(b.forms||(b.forms={}))})(geocortex||(geocortex={}));
(function(b){(function(f){(function(e){var d=function(c){function a(a,d){c.call(this,a,d);this.formItemType="GroupBoxFormItem";a?(this.header=new Observable(b.forms.getElementText(a,"Header")),this.orientation=new Observable(b.forms.getElementText(a,"Orientation"))):(this.header=new Observable(null),this.orientation=new Observable("Vertical"))}__extends(a,c);a.prototype._render=function(){return b.forms.renderFormItem(this)};return a}(e.ContainerFormItem);e.GroupBoxFormItem=d})(f.items||(f.items=
{}))})(b.forms||(b.forms={}))})(geocortex||(geocortex={}));
(function(b){(function(f){(function(e){var d=function(c){function a(a,d){c.call(this,a,d);this.wasClicked=new Observable(false);this.formItemType="HyperlinkFormItem";a?(this.hyperlinkText=new Observable(b.forms.getElementText(a,"HyperlinkText")),this.target=new Observable(b.forms.getElementText(a,"Target")),this.uri=new Observable(b.forms.getElementText(a,"Uri"))):(this.hyperlinkText=new Observable("Hyperlink"),this.target=new Observable("_blank"),this.uri=new Observable(""))}__extends(a,c);a.prototype.getResult=
function(){return new b.forms.items.FormItemResult(this.argumentName.get(),this.wasClicked.get(),this.wasClicked.get())};a.prototype._render=function(){return b.forms.renderFormItem(this)};return a}(e.AbstractFormItem);e.HyperlinkFormItem=d})(f.items||(f.items={}))})(b.forms||(b.forms={}))})(geocortex||(geocortex={}));
(function(b){(function(f){(function(e){var d=function(c){function a(a,d){c.call(this,a,d);this.formItemType="ImageFormItem";if(a){this.source=new Observable(b.forms.getElementText(a,"Source"));this.width=new Observable(b.forms.getElementText(a,"Width"));this.height=new Observable(b.forms.getElementText(a,"Height"));var e=this.width.get(),f=this.height.get();e&&f?parseInt(e)>parseInt(f)?this.height.set("auto"):this.width.set("auto"):(this.width=new Observable("auto"),this.height=new Observable("auto"))}else this.source=
new Observable(""),this.width=new Observable("auto"),this.height=new Observable("auto")}__extends(a,c);a.prototype._render=function(){return b.forms.renderFormItem(this)};return a}(e.AbstractFormItem);e.ImageFormItem=d})(f.items||(f.items={}))})(b.forms||(b.forms={}))})(geocortex||(geocortex={}));
(function(b){(function(f){(function(e){var d=function(c){function a(a,d){c.call(this,a,d);this.selection=new ObservableCollection;this.selectedValues=new ObservableCollection;this._selectedValuesLookup=null;this.isBusy=new Observable(false);this.formItemType="ListBoxFormItem";e.initLabelContainer(this,a,d);e.initDataItemsFormItem(this,a,d);if(a){this.maxHeight=new Observable(parseInt(b.forms.getElementText(a,"MaxHeight")));this.selectionMode=new Observable(b.forms.getElementText(a,"SelectionMode"));
var f=b.forms.getElement(a,"SelectedValues");if(f){this._selectedValuesLookup={};var p;for(p=0;p<f.childNodes.length;p++){var n=f.childNodes[p].textContent;this.selectedValues.addItem(n);this._selectedValuesLookup[n+""]=true}this._setDefaults()}}else this.label=new b.forms.items.LabelFormItem(null,this.formDefinition),this.maxHeight=new Observable(NaN),this.selectionMode=new Observable("Single");this.queryTaskRunner=new e.QueryTaskRunner(this,a,d);this.queryTaskRunner.queryCascadingID.get()||this.queryTaskRunner.performQuery("")}
__extends(a,c);a.prototype.clearDataItems=function(){this.dataItems.clear()};a.prototype._setDefaults=function(){for(var a=0;a<this.dataItems.getItems().length;a++){var b=this.dataItems.getAt(a);this._selectedValuesLookup[b.value.toString()]&&this.selection.addItem(b)}};a.prototype.handleResultsComplete=function(){this._setDefaults()};a.prototype.triggerCascading=function(a){(this.selection==null||!a)&&this.queryTaskRunner.cascadingEvent.publish(null);var b=null;this.selection!=null&&(b=this.selection.getAt(0));
b==null&&a!=null&&(b=a);b==null?this.queryTaskRunner.cascadingEvent.publish(null):this.queryTaskRunner.cascadingEvent.publish(b.value)};a.prototype.getResult=function(){var a=null;if(this.selectionMode.get().toLowerCase()=="single")return this.selection.getLength()>0&&(a=(a=this.selection.getAt(0))?a.getValue():null),new e.FormItemResult(this.argumentName.get(),a,true);else{for(var b=[],c=0;c<this.selection.getLength();++c)(a=(a=this.selection.getAt(c))?a.getValue():null)&&b.push(a);a=new e.FormItemResult(this.argumentName.get(),
b,true);a.isList=true;return a}};a.prototype._render=function(){return b.forms.renderFormItem(this)};return a}(e.AbstractFormItem);e.ListBoxFormItem=d})(f.items||(f.items={}))})(b.forms||(b.forms={}))})(geocortex||(geocortex={}));
(function(b){(function(f){(function(e){var d=function(c){function a(a,d){c.call(this,a,d);this.formItemType="RadioButtonFormItem";a?(this.text=new Observable(b.forms.getElementText(a,"Text")),this.checked=new Observable(b.forms._parseBoolean(b.forms.getElementText(a,"Checked"))),this.textLocation=new Observable(b.forms.getElementText(a,"TextLocation")),this.groupName=new Observable(b.forms.getElementText(a,"GroupName"))):(this.text=new Observable(null),this.checked=new Observable(false),this.textLocation=
new Observable("Right"),this.groupName=new Observable(null))}__extends(a,c);a.prototype.getResult=function(){var a=this.__getRadioValueClosure,a=a?a():false;return new b.forms.items.FormItemResult(this.argumentName.get(),a)};a.prototype._render=function(){return b.forms.renderFormItem(this)};return a}(e.AbstractFormItem);e.RadioButtonFormItem=d})(f.items||(f.items={}))})(b.forms||(b.forms={}))})(geocortex||(geocortex={}));
(function(b){(function(b){var e=function(){return function(){this.fileDataBase64=this.fileName=null;this.fileSize=0;this.fileType=null}}();b.FileItem=e})(b.forms||(b.forms={}))})(geocortex||(geocortex={}));
(function(b){(function(f){(function(e){(function(d){var c=function(a){function c(d){a.call(this,d);this.totalFileSize=parseInt(b.forms.getElementText(d,"TotalFileSize"))}__extends(c,a);c.prototype.validate=function(a){if(a instanceof b.workflow.ArgumentValueWrapper&&a.value&&a.value instanceof Array){for(var c=0,d=0;d<a.value.length;++d){var e=a.value[d];e&&e instanceof b.forms.FileItem&&(c+=e.fileSize)}if(c>this.totalFileSize)return new b.forms.items.validation.ValidationResult(false,this.message)}return new b.forms.items.validation.ValidationResult(true,
null)};return c}(d.ValidationItem);d.FileSizeValidationItem=c})(e.validation||(e.validation={}))})(f.items||(f.items={}))})(b.forms||(b.forms={}))})(geocortex||(geocortex={}));
(function(b){(function(f){(function(e){(function(d){var c=function(a){function c(d){a.call(this,d);this.minimumValue=parseFloat(b.forms.getElementText(d,"MinimumValue"));this.maximumValue=parseFloat(b.forms.getElementText(d,"MaximumValue"))}__extends(c,a);c.prototype.validate=function(a){if(a===null||a===void 0||a==="")return new b.forms.items.validation.ValidationResult(true,null);a=parseFloat(a);return a==null||isNaN(a)||a<this.minimumValue||a>this.maximumValue?new b.forms.items.validation.ValidationResult(false,
this.message):new b.forms.items.validation.ValidationResult(true,null)};return c}(d.ValidationItem);d.NumericRangeValidationItem=c})(e.validation||(e.validation={}))})(f.items||(f.items={}))})(b.forms||(b.forms={}))})(geocortex||(geocortex={}));
(function(b){(function(f){(function(e){(function(d){var c=function(a){function c(d){a.call(this,d);this.expression=b.forms.getElementText(d,"Expression");this.ignoreCase=b.forms._parseBoolean(b.forms.getElementText(d,"IgnoreCase"))}__extends(c,a);c.prototype.validate=function(a){if(a===null||a===void 0||a==="")return new b.forms.items.validation.ValidationResult(true,null);var c="",d=this.expression;this.ignoreCase&&(c+="i");this.expression=='^(?(")(".+?"@)|(([0-9a-zA-Z]((\\.(?!\\.))|[-!#\\$%&\'\\*\\+/=\\?\\^`\\{\\}\\|~\\w])*)(?<=[0-9a-zA-Z])@))(?(\\[)(\\[(\\d{1,3}\\.){3}\\d{1,3}\\])|(([0-9a-zA-Z][-\\w]*[0-9a-zA-Z]\\.)+[a-zA-Z]{2,6}))$'&&
(d="^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,4}$");var e=null;try{e=RegExp(d,c)}catch(f){}return e!=null&&!e.test(a)?new b.forms.items.validation.ValidationResult(false,this.message):new b.forms.items.validation.ValidationResult(true,null)};return c}(d.ValidationItem);d.RegexValidationItem=c})(e.validation||(e.validation={}))})(f.items||(f.items={}))})(b.forms||(b.forms={}))})(geocortex||(geocortex={}));
(function(b){(function(f){(function(e){(function(d){var c=function(a){function c(b){a.call(this,b)}__extends(c,a);c.prototype.validate=function(a){var c=true,d=null;if(a===null||typeof a==="string"&&dojo.trim(a)===""||a.length!==void 0&&a.length<=0)c=false,d=this.message;return new b.forms.items.validation.ValidationResult(c,d)};return c}(d.ValidationItem);d.RequiredValidationItem=c})(e.validation||(e.validation={}))})(f.items||(f.items={}))})(b.forms||(b.forms={}))})(geocortex||(geocortex={}));
(function(b){(function(b){function e(b,c){var a=b.getElementsByTagName(c);if(a.length>=1)for(var e=0;e<a.length;e++){if(a[e].parentNode===b)return a[e]}else if(b.childNodes.length>0&&(a=b.childNodes[0].prefix,a!=""&&(a=b.getElementsByTagName(a+":"+c),a.length>=1)))for(e=0;e<a.length;e++)if(a[e].parentNode===b)return a[e];return null}b.getElement=e;b.getElementText=function(b,c){var a=e(b,c);return a?dojox.xml.parser.textContent(a):null};b.getAttributeValue=function(b,c){if(b!=null)for(var a=0;a<b.attributes.length;a++)if(b.attributes[a].name==
c)return b.attributes[a].value;return null};b._parseBoolean=function(b){if(b!=null)switch(b.toLowerCase()){case "true":case "yes":case "1":return true;case "false":case "no":case "0":case null:break;default:return Boolean(b)}return false};b.renderFormItem=function(){throw Error("This abstract function must be implemented by your UI system");}})(b.forms||(b.forms={}))})(geocortex||(geocortex={}));
(function(b){(function(f){(function(e){function d(b){var a="";if(b!=null&&b.attributes!=null)for(var d=0;d<b.attributes.length;d++)if(String(b.attributes[d].nodeName).indexOf("type")>=0){b=b.attributes[d].nodeValue;a=b.indexOf(":");a>=0&&a+1<b.length&&(b=b.substr(a+1));a=b;break}return a}e._processFormItem=function(c,a){var e=null;switch(d(c)){case "AutoCompleteBoxFormItem":e=new b.forms.items.AutoCompleteBoxFormItem(c,a);break;case "CheckBoxFormItem":e=new b.forms.items.CheckBoxFormItem(c,a);break;
case "ContainerFormItem":e=new b.forms.items.ContainerFormItem(c,a);break;case "ComboBoxFormItem":e=new b.forms.items.ComboBoxFormItem(c,a);break;case "DatePickerFormItem":e=new b.forms.items.DatePickerFormItem(c,a);break;case "FilePickerFormItem":e=new b.forms.items.FilePickerFormItem(c,a);break;case "GroupBoxFormItem":e=new b.forms.items.GroupBoxFormItem(c,a);break;case "HyperlinkFormItem":e=new b.forms.items.HyperlinkFormItem(c,a);break;case "ImageFormItem":e=new b.forms.items.ImageFormItem(c,
a);break;case "ListBoxFormItem":e=new b.forms.items.ListBoxFormItem(c,a);break;case "RadioButtonFormItem":e=new b.forms.items.RadioButtonFormItem(c,a);break;case "TextAreaFormItem":e=new b.forms.items.TextAreaFormItem(c,a);break;case "TextBoxFormItem":e=new b.forms.items.TextBoxFormItem(c,a);break;case "TimePickerFormItem":e=new b.forms.items.TimePickerFormItem(c,a)}e.dataItems&&a!=null&&a.inputData!=null&&a.inputData.hasOwnProperty(e.itemID)&&e.dataItems.addItems(a.inputData.item(e.itemID));return e};
e._processValidationItem=function(c){var a=null;switch(d(c)){case "NumericRangeValidationItem":a=new b.forms.items.validation.NumericRangeValidationItem(c);break;case "RequiredValidationItem":a=new b.forms.items.validation.RequiredValidationItem(c);break;case "RegexValidationItem":a=new b.forms.items.validation.RegexValidationItem(c);break;case "FileSizeValidationItem":a=new b.forms.items.validation.FileSizeValidationItem(c)}return a};e._getType=d})(f.items||(f.items={}))})(b.forms||(b.forms={}))})(geocortex||
(geocortex={}));
(function(b){(function(f){var e=function(){function d(b,a,d,e){this.isBusy=false;this._registeredActivityHandlers={};this._registeredExternalIdHandlers={};this.handleOpenReportUrlFunction=this.handleUnhandledActivityErrorFunction=null;this.defaultFormContainerId="form-container-outer";this.defaultFormContentId="form-container";this._handleErrorFunction=b||null;this._activityBeginFunction=a||null;this._activityCompleteFunction=d||null;this._workflowCompleteFunction=e||null;this.registerDefaultHandlers()}d.prototype.registerDefaultHandlers=
function(){this.registerActivityHandler("Geocortex.Workflow.Activities.Alert",b.workflow.DefaultActivityHandlers.handleAlert);this.registerActivityHandler("Geocortex.Workflow.Activities.CaptureGeometry",b.workflow.DefaultActivityHandlers.handleCaptureGeometry);this.registerActivityHandler("Geocortex.Workflow.Activities.Confirm",b.workflow.DefaultActivityHandlers.handleConfirm);this.registerActivityHandler("Geocortex.Workflow.Activities.ExportMap",b.workflow.DefaultActivityHandlers.handleExportMap);
this.registerActivityHandler("Geocortex.Workflow.Activities.ExternalDelay",b.workflow.DefaultActivityHandlers.handleExternalDelay);this.registerActivityHandler("Geocortex.Workflow.Activities.GetBrowserUrl",b.workflow.DefaultActivityHandlers.handleGetBrowserUrl);this.registerActivityHandler("Geocortex.Workflow.Activities.GetCurrentPosition",b.workflow.DefaultActivityHandlers.handleGetCurrentPosition);this.registerActivityHandler("Geocortex.Workflow.Activities.GetLayerProperty",b.workflow.DefaultActivityHandlers.handleGetLayerProperty);
this.registerActivityHandler("Geocortex.Workflow.Activities.GetLayerVisibility",b.workflow.DefaultActivityHandlers.handleGetLayerVisibility);this.registerActivityHandler("Geocortex.Workflow.Activities.GetMapExtent",b.workflow.DefaultActivityHandlers.handleGetMapExtent);this.registerActivityHandler("Geocortex.Workflow.Activities.GetMapInfo",b.workflow.DefaultActivityHandlers.handleGetMapInfo);this.registerActivityHandler("Geocortex.Workflow.Activities.GetMapServiceInfo",b.workflow.DefaultActivityHandlers.handleGetMapServiceInfo);
this.registerActivityHandler("Geocortex.Workflow.Activities.GetPhoto",b.workflow.DefaultActivityHandlers.handleGetPhoto);this.registerActivityHandler("Geocortex.Workflow.Activities.PrintMap",b.workflow.DefaultActivityHandlers.handlePrintMap);this.registerActivityHandler("Geocortex.Workflow.Activities.Prompt",b.workflow.DefaultActivityHandlers.handlePrompt);this.registerActivityHandler("Geocortex.Workflow.Activities.RefreshMap",b.workflow.DefaultActivityHandlers.handleRefreshMap);this.registerActivityHandler("Geocortex.Workflow.Activities.RemoveMapService",
b.workflow.DefaultActivityHandlers.handleRemoveMapService);this.registerActivityHandler("Geocortex.Workflow.Activities.Report",b.workflow.DefaultActivityHandlers.handleReport);this.registerActivityHandler("Geocortex.Workflow.Activities.SetLayerDefinition",b.workflow.DefaultActivityHandlers.handleSetLayerDefinition);this.registerActivityHandler("Geocortex.Workflow.Activities.SetLayerProperty",b.workflow.DefaultActivityHandlers.handleSetLayerProperty);this.registerActivityHandler("Geocortex.Workflow.Activities.SetLayerVisibility",
b.workflow.DefaultActivityHandlers.handleSetLayerVisibility);this.registerActivityHandler("Geocortex.Workflow.Activities.SetMapExtent",b.workflow.DefaultActivityHandlers.handleSetMapExtent);this.registerActivityHandler("Geocortex.Workflow.Activities.SetMapServiceVisibility",b.workflow.DefaultActivityHandlers.handleSetMapServiceVisibility);this.registerActivityHandler("Geocortex.Workflow.Activities.WaitForGeoprocessorJobComplete",b.workflow.DefaultActivityHandlers.handleWaitForGeoprocessorJobComplete);
this.registerActivityHandler("Geocortex.Workflow.Activities.UpdateGraphicsLayer",b.workflow.DefaultActivityHandlers.handleUpdateGraphicsLayer);this.registerExternalIdHandler("IntersectLayers",b.workflow.DefaultActivityHandlers.handleIntersectLayers);this.registerExternalIdHandler("GetPhoto",b.workflow.DefaultActivityHandlers.handleGetPhoto)};d.prototype.canHandleActivity=function(b){b||this.handleError(Error("Null ActivityContext passed to canHandleActivity."),b);if(b.getActivityExternalId()!=null&&
this._registeredExternalIdHandlers[b.getActivityExternalId()]!=null)return true;b=b.getActivityTypeName();return b!=null&&this._registeredActivityHandlers[b]?true:false};d.prototype.registerExternalIdHandler=function(b,a){b==null||a==null?this.handleError(Error("Null externalId or handler passed to registerExternalIdHandler."),null):this._registeredExternalIdHandlers[b]=a};d.prototype.registerActivityHandler=function(b,a){b==null||a==null?this.handleError(Error("Null activityTypeName or handler passed to registerActivityHandler."),
null):this._registeredActivityHandlers[b]=a};d.prototype.dispatch=function(b){if(b==null)this.handleError(Error("Null ActivityContext passed to dispatch."),b);else{var a=b.getActivityTypeName(),d=b.getActivityExternalId();this.canHandleActivity(b)?(d!=null&&this._registeredExternalIdHandlers[d]!=null&&(d=this._registeredExternalIdHandlers[d],d(b,this)),a!=null&&this._registeredActivityHandlers[a]&&(d=this._registeredActivityHandlers[a],d(b,this))):this.handleUnhandledActivityErrorFunction(Error("Unknown activity type '"+
a+"' or external ID '"+d+"' encountered."),b)}};d.prototype.handleError=function(b,a){this._handleErrorFunction!=null&&this._handleErrorFunction(b,a)};d.prototype.handleUnhandledActivityError=function(b,a){this.handleUnhandledActivityErrorFunction!=null?this.handleUnhandledActivityErrorFunction(b,a):this.handleError(b,a)};d.prototype.handleOpenReportUrl=function(b,a){this.handleOpenReportUrlFunction!=null?this.handleOpenReportUrlFunction(b,a):window.open(b)};d.prototype.activityBegin=function(b){this._activityBeginFunction!=
null&&this._activityBeginFunction(b)};d.prototype.activityComplete=function(b){this._activityCompleteFunction!=null&&this._activityCompleteFunction(b)};d.prototype.workflowComplete=function(b,a){this._workflowCompleteFunction!=null&&this._workflowCompleteFunction(b,a)};return d}();f.DefaultActivityDispatcher=e})(b.workflow||(b.workflow={}))})(geocortex||(geocortex={}));
(function(b){(function(f){var e=function(){function d(c,a,d,e,f){this._defaultActivityDispatcher=new b.workflow.DefaultActivityDispatcher;this.isBusy=null;this._dispatchFunction=c||null;this._handleErrorFunction=a||null;this._activityBeginFunction=d||null;this._activityCompleteFunction=e||null;this._workflowCompleteFunction=f||null}d.prototype.dispatch=function(b){this._defaultActivityDispatcher.canHandleActivity(b)?this._defaultActivityDispatcher.dispatch(b):this._dispatchFunction!=null&&this._dispatchFunction(b)};
d.prototype.handleError=function(b,a){this._handleErrorFunction!=null&&this._handleErrorFunction(b,a)};d.prototype.activityBegin=function(b){this._activityBeginFunction!=null&&this._activityBeginFunction(b)};d.prototype.activityComplete=function(b){this._activityCompleteFunction!=null&&this._activityCompleteFunction(b)};d.prototype.workflowComplete=function(b,a){this._workflowCompleteFunction!=null&&this._workflowCompleteFunction(b,a)};d.prototype.handleOpenReportUrl=function(b){window.open(b)};return d}();
f.SimpleActivityDispatcher=e})(b.workflow||(b.workflow={}))})(geocortex||(geocortex={}));
(function(b){(function(f){(function(e){e.parseObject=function(d){if(d)try{if(d.nodeType===3||d.nodeType===4){var c=String.prototype.trim?d.nodeValue.trim():dojo.string.trim(d.nodeValue);return c.length===0?null:c}else if(d.nodeType===1){var a={},e=0;dojo.forEach(d.attributes,function(b){a[b.nodeName]=b.nodeValue});dojo.forEach(d.childNodes,function(c){var d=b.essentials.xmlUtils.parseObject(c);d&&(e++,a[c.nodeName]?(dojo.isArray(a[c.nodeName])===false&&(a[c.nodeName]=[a[c.nodeName]]),a[c.nodeName].push(d)):
a[c.nodeName]=d)});return e===1&&a["#text"]?a["#text"]:e===1&&a["#cdata-section"]?a["#cdata-section"]:a}}catch(f){throw Error("Unable to parse XML object: "+f.toString());}return null};e.getAllNodes=function(b){var c=new dojo.NodeList;if(dojo.isIE)for(var b=b.childNodes,a=0;a<b.length;a++)c.push(b[a]);else c=dojo.query("*",b);return c};e.getNodes=function(b,c,a){var e=new dojo.NodeList;dojo.isIE?(b=a.getElementsByTagName(b),dojo.forEach(b,function(a){a=a.getElementsByTagName(c);dojo.forEach(a,function(a){e.push(a)})})):
e=dojo.query(b+" > "+c,a);return e};e.getValue=function(b,c){if(b){var a=b;dojo.isString(b)&&(a=b.split(" > "),a=this.getNodes(a[0],a[1],c)[0]);return a.firstChild&&a.firstChild.nodeValue?a.firstChild.nodeValue:"Node not valid"}return"No Value"};e.getAttribute=function(b,c){if(b)if(dojo.isIE){for(var a=0;a<b.attributes.length;a++)if(b.attributes[a].nodeName==c)return b.attributes[a].nodeValue;return null}else return b.getAttribute(c);return"No Value"}})(f.xmlUtils||(f.xmlUtils={}))})(b.essentials||
(b.essentials={}))})(geocortex||(geocortex={}));(function(b){(function(f){var e=function(){return function(d,c){this.error=c;if(this.resultObject=d)this.rawJson=b.encodeJson(d)}}();f.RestEndpointResult=e})(b.essentials||(b.essentials={}))})(geocortex||(geocortex={}));
(function(b){(function(f){var e=function(){function d(){this._activeEndpointRequest=false;this._onRequestError=this._onRequestComplete=null}d.prototype.getCustomRestEndpoint=function(c,a,d,e,f){this._activeEndpointRequest?this._onEndpointRequestError(Error("An operation is already in progress.")):(this._activeEndpointRequest=true,this._onRequestComplete=d,this._onRequestError=e,b.request({url:c,content:a,load:dojo.hitch(this,this._onEndpointRequestComplete),error:dojo.hitch(this,this._onEndpointRequestError),
callbackParamName:"CallBack"},f))};d.prototype._onEndpointRequestComplete=function(c){this._activeEndpointRequest=false;try{c||(c={error:Error("Expected results")}),c.error&&this._onRequestError&&this._onRequestError(c.error)}finally{this._onRequestComplete&&this._onRequestComplete(new b.essentials.RestEndpointResult(c,c.error))}};d.prototype._onEndpointRequestError=function(c){this._activeEndpointRequest=false;try{this._onRequestError&&this._onRequestError(c)}finally{this._onRequestComplete&&this._onRequestComplete(new b.essentials.RestEndpointResult(null,
c))}};return d}();f.RestUtility=e})(b.essentials||(b.essentials={}))})(geocortex||(geocortex={}));
(function(b){(function(f){var e=function(d){function c(a){d.call(this,a);this.geometryService=this.mapSpatialReference=this.geoRssLayer=this.markerSymbol=this.pictureSymbol=this.updateInterval=this.feedImageUri=this.feedUrl=this.color=null;this._colorSet=false;this._layerLoadCompleted=null}__extends(c,d);c.prototype._configureObject=function(a,b){if(a===void 0)throw Error("Incorrect map service object returned from initialization");c.webMercatorSref=new esri.SpatialReference({wkid:102100});c.wgs84Sref=
new esri.SpatialReference({wkid:4326});this.feedImageUri=a.feedImageUri;this.updateInterval=a.updateInterval;this.geoRssLayer=new esri.layers.GraphicsLayer({opacity:a.opacity,id:a.id,visible:a.visible});dojo.connect(this.geoRssLayer,"onError",this,this._layerLoadErrorHandler);if(a.color)this.color=a.color,this._colorSet=true,this.color.length>3&&(this.color[3]/=255);d.prototype._configureObject.call(this,a,b)};c.prototype._createServiceLayer=function(){var a=null;if(this.essentialsMap)a=this.essentialsMap.site;
this.feedImageUri?(this.feedImageUri=b.essentials.RestHelper.processClientSideTokens(a,this.feedImageUri),this.pictureSymbol=new esri.symbol.PictureMarkerSymbol(this.feedImageUri,25,25)):this.markerSymbol=new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_CIRCLE,15,new esri.symbol.SimpleLineSymbol,new dojo.Color(this.color));this.mapSpatialReference=this.essentialsMap.initialExtent.spatialReference;this.feedUrl=this.serviceUrl;this._loadFeed();if(this.updateInterval&&!isNaN(this.updateInterval)){var c=
this;this._layerLoadCompleted=false;var d=setInterval(function(){c._layerLoadCompleted&&c._loadFeed();c._layerLoadCompleted=false},this.updateInterval*1E3);dojo.connect(window,"onunload",function(){clearInterval(d)})}this.serviceLayer=this.geoRssLayer};c.prototype._loadFeed=function(){esri.config.defaults.io.proxyUrl&&b.request({url:this.serviceUrl,content:{},handleAs:"xml",load:dojo.hitch(this,this._handleFeed),error:function(a){alert(a.message)}})};c.prototype._handleFeed=function(a){var c=this._getFeedRoot(a);
if(c){var d=c.nodeName,e=b.essentials.xmlUtils.getAttribute(c,"xmlns:georss"),e=e||b.essentials.xmlUtils.getAttribute(c,"xmlns:geo"),f=b.essentials.xmlUtils.getAttribute(c,"xmlns:gml"),n=b.essentials.xmlUtils.getAttribute(c,"xml:base"),k=[],c=null;d==="feed"?c=b.essentials.xmlUtils.getNodes("feed","entry",a):d==="rdf"?c=b.essentials.xmlUtils.getNodes("rdf","item",a):d==="rss"&&(c=b.essentials.xmlUtils.getNodes("channel","item",a));if(c){var i=this.pictureSymbol||this.markerSymbol;c.forEach(dojo.hitch(this,
function(a){var c,g,q,r=null;b.essentials.xmlUtils.getAllNodes(a).forEach(dojo.hitch(this,function(a){if(a.nodeName){if(a.nodeName==="title")c=a.firstChild.nodeValue;if(d==="feed"){if(a.nodeName==="summary")q=a.firstChild.nodeValue}else if(a.nodeName==="description")q=a.firstChild.nodeValue;a.nodeName==="link"&&(g=d==="feed"?(n||"")+b.essentials.xmlUtils.getAttribute(a,"href"):(n||"")+a.firstChild.nodeValue);f==="http://www.opengis.net/gml"?a.nodeName==="georss:where"&&(r=this._getGMLGRSSPoint(a)):
e==="http://www.georss.org/georss"?a.nodeName==="georss:point"&&(r=this._getSimpleGRSSPoint(a)):e==="http://www.w3.org/2003/01/geo/wgs84_pos#"&&a.nodeName==="geo:lat"&&(r=this._getW3CGRSSPoint(a))}}));if(r){var a={title:c,content:q,link:g},s=new esri.InfoTemplate;k.push(new esri.Graphic(r,i,a,s))}}));this.mapSpatialReference&&this._projectShapes(k,this.mapSpatialReference)}}};c.prototype._projectShapes=function(a,b){if(a&&b){for(var d=false,e=c.webMercatorSref.wkid,f=c.wgs84Sref.wkid,n=0;n<a.length;n++){var k=
a[n],i=null;if(k.geometry&&k.geometry.spatialReference.wkid!==b.wkid)b.wkid===e&&k.geometry.spatialReference.wkid===f?i=esri.geometry.geographicToWebMercator(k.geometry):b.wkid===f&&k.geometry.spatialReference.wkid===e?i=esri.geometry.webMercatorToGeographic(k.geometry):(i=esri.geometry.geographicToWebMercator(k.geometry),d=true),k.geometry=i}if(d){var j=[];this.geometryServiceUrl=this.geometryServiceUrl||"http://sampleserver3.arcgisonline.com/ArcGIS/rest/services/Geometry/GeometryServer";this.geometryService=
new esri.tasks.GeometryService(this.geometryServiceUrl);dojo.forEach(a,function(a){j.push(a.geometry)});d=new esri.tasks.ProjectParameters;d.geometries=j;d.outSR=b;this.geometryService.project(d,dojo.hitch(this,function(b){for(var c=0;c<b.length;c++)a[c].geometry=b[c];this._publishLayer(a)}),this._projectionError);return}}this._publishLayer(a)};c.prototype._publishLayer=function(a){if(this.geoRssLayer)this.geoRssLayer.clear(),dojo.forEach(a,dojo.hitch(this,function(a){this.geoRssLayer.add(a)})),this.geoRssLayer.redraw(),
dojo.publish("geoRssLayerLoaded",[{esriLayer:this.geoRssLayer}]),this._layerLoadCompleted=true};c.prototype._projectionError=function(){};c.prototype._getSimpleGRSSPoint=function(a){a=a.firstChild.nodeValue.split(" ");return new esri.geometry.Point(parseFloat(a[1]),parseFloat(a[0]),c.wgs84Sref)};c.prototype._getGMLGRSSPoint=function(a){a=this._getNonTextNodeChild(this._getNonTextNodeChild(a)).firstChild.nodeValue.split(" ");return new esri.geometry.Point(parseFloat(a[1]),parseFloat(a[0]),c.wgs84Sref)};
c.prototype._getNonTextNodeChild=function(a){for(var a=a.childNodes,b=0;b<a.length;b++)if(a[b].nodeType!==3)return a[b]};c.prototype._getW3CGRSSPoint=function(a){if(!a.nextSibling)return null;var b=a.nextSibling;if(a.nextSibling.nodeName==="#text")b=a.nextSibling.nextSibling;a=a.firstChild.nodeValue;return new esri.geometry.Point(parseFloat(b.firstChild.nodeValue),parseFloat(a),c.wgs84Sref)};c.prototype._getFeedRoot=function(a){for(var a=a.childNodes,b=0;b<a.length;b++)if(a[b]&&a[b].nodeName.substring(0,
3)!=="xml")return a[b];return null};c.webMercatorSref=null;c.wgs84Sref=null;return c}(f.MapService);f.GeoRssLayerService=e})(b.essentials||(b.essentials={}))})(geocortex||(geocortex={}));
